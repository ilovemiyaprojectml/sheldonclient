import * as tslib_1 from "tslib";
import { Component, ViewEncapsulation, ElementRef, Renderer2, EventEmitter, Input, Inject, Output, ViewChild, ViewChildren, QueryList } from '@angular/core';
import { MediaObserver } from '@angular/flex-layout';
import { MatMenuTrigger } from '@angular/material/menu';
import { DOCUMENT } from '@angular/common';
import { ENTER, SPACE } from '@angular/cdk/keycodes';
var RufDynamicSideMenuComponent = /** @class */ (function () {
    function RufDynamicSideMenuComponent(document, _renderer, _mediaObserver, _elementRef) {
        this.document = document;
        this._renderer = _renderer;
        this._mediaObserver = _mediaObserver;
        this._elementRef = _elementRef;
        this.items = [];
        this._inkbarPosition = this._inkbarPosition || 'start';
        this.multi = true;
        this._select = new EventEmitter();
        // @HostBinding('class.ruf-dynamic-sidemenu-minimized')
        this.minimized = false;
        this.minimizedXs = false;
        this.minimizedSm = false;
        this.minimizedMd = false;
        this.minimizedLg = false;
        this.minimizedXl = false;
        this.minimizedGtXs = false;
        this.minimizedGtSm = false;
        this.minimizedGtMd = false;
        this.minimizedGtLg = false;
    }
    RufDynamicSideMenuComponent.prototype.isMinimized = function () {
        return [
            this.minimized,
            this.minimizedXs && this._mediaObserver.isActive('xs'),
            this.minimizedSm && this._mediaObserver.isActive('sm'),
            this.minimizedMd && this._mediaObserver.isActive('md'),
            this.minimizedLg && this._mediaObserver.isActive('lg'),
            this.minimizedXl && this._mediaObserver.isActive('xl'),
            this.minimizedGtXs && this._mediaObserver.isActive('gt-xs'),
            this.minimizedGtSm && this._mediaObserver.isActive('gt-sm'),
            this.minimizedGtMd && this._mediaObserver.isActive('gt-md'),
            this.minimizedGtLg && this._mediaObserver.isActive('gt-lg')
        ].some(function (x) { return x === true; });
    };
    RufDynamicSideMenuComponent.prototype.onSelect = function ($event) {
        if (!($event.data && $event.data.children)) {
            this._selectedPath = $event.path;
            this._select.emit($event.data);
        }
        else if ($event && $event.event) {
            $event.event.preventDefault();
            $event.event.stopPropagation();
        }
    };
    RufDynamicSideMenuComponent.prototype.getRufId = function (item) {
        return 'dynamic_sidemenu_' + item.label.toLowerCase().replace(/ /g, '_');
    };
    RufDynamicSideMenuComponent.prototype.closeMenu = function () {
        this.menuTrigger.closeMenu();
    };
    RufDynamicSideMenuComponent.prototype.setPopupData = function (event, data) {
        var _this = this;
        this.sideMenuPopupData = data;
        event.currentTarget.classList.add('ruf-active');
        // focus on the first menu item
        setTimeout(function () {
            var cdkOverlayClass = ".ruf-sidemenu-popup-backdrop + .cdk-overlay-connected-position-bounding-box";
            var cdkOverlayElement = _this.document.querySelector(cdkOverlayClass);
            if (cdkOverlayElement) {
                // set left position for cdkOverlay based on the position of menuitem.
                // so we need to get left and width value from BoundingClientRect;
                var rufMenuItem = _this._elementRef.nativeElement.querySelector('.ruf-menu-item');
                var rufMenuItemClientTect = rufMenuItem.getBoundingClientRect();
                cdkOverlayElement.style.left = rufMenuItemClientTect.left + rufMenuItemClientTect.width + 'px';
                var firstMenuItem = _this.document.querySelector(cdkOverlayClass + " .ruf-menu-item");
                if (firstMenuItem) {
                    firstMenuItem.focus();
                }
            }
        });
    };
    RufDynamicSideMenuComponent.prototype.onPopupClose = function () {
        // remove active class when popop is closed
        var currentActiveItem = this._elementRef.nativeElement.querySelector('.ruf-menu-item.ruf-active');
        if (currentActiveItem) {
            currentActiveItem.focus();
            this._renderer.removeClass(currentActiveItem, 'ruf-active');
        }
    };
    RufDynamicSideMenuComponent.prototype.keyHandler = function (event) {
        switch (event.keyCode) {
            case ENTER:
            case SPACE:
                event.currentTarget.click();
                break;
            default:
        }
    };
    RufDynamicSideMenuComponent.prototype.getOverlayClasses = function () {
        var colorClass = this._activeColor ? "ruf-" + this._activeColor : "";
        return this.popupBackgroundClass + " " + colorClass + " ruf-menubar-inkbar-" + this._inkbarPosition;
    };
    RufDynamicSideMenuComponent.prototype.toggleChildItems = function (currentTrigger) {
        if (this.multi === false) {
            this._triggers.toArray()
                .filter(function (element) { return element.value === true && element !== currentTrigger; })
                .forEach(function (element) {
                element.value = false;
            });
        }
    };
    tslib_1.__decorate([
        Input(),
        tslib_1.__metadata("design:type", Array)
    ], RufDynamicSideMenuComponent.prototype, "items", void 0);
    tslib_1.__decorate([
        Input(),
        tslib_1.__metadata("design:type", String)
    ], RufDynamicSideMenuComponent.prototype, "popupBackgroundClass", void 0);
    tslib_1.__decorate([
        ViewChild(MatMenuTrigger, { static: false }),
        tslib_1.__metadata("design:type", MatMenuTrigger)
    ], RufDynamicSideMenuComponent.prototype, "menuTrigger", void 0);
    tslib_1.__decorate([
        ViewChild('menuTrigger', { static: false }),
        tslib_1.__metadata("design:type", ElementRef)
    ], RufDynamicSideMenuComponent.prototype, "trigger", void 0);
    tslib_1.__decorate([
        Input('selectedPath'),
        tslib_1.__metadata("design:type", String)
    ], RufDynamicSideMenuComponent.prototype, "_selectedPath", void 0);
    tslib_1.__decorate([
        Input('activeColor'),
        tslib_1.__metadata("design:type", String)
    ], RufDynamicSideMenuComponent.prototype, "_activeColor", void 0);
    tslib_1.__decorate([
        Input('inkbarPosition'),
        tslib_1.__metadata("design:type", Object)
    ], RufDynamicSideMenuComponent.prototype, "_inkbarPosition", void 0);
    tslib_1.__decorate([
        Input('multi'),
        tslib_1.__metadata("design:type", Object)
    ], RufDynamicSideMenuComponent.prototype, "multi", void 0);
    tslib_1.__decorate([
        Output('select'),
        tslib_1.__metadata("design:type", Object)
    ], RufDynamicSideMenuComponent.prototype, "_select", void 0);
    tslib_1.__decorate([
        ViewChildren('trigger'),
        tslib_1.__metadata("design:type", QueryList)
    ], RufDynamicSideMenuComponent.prototype, "_triggers", void 0);
    tslib_1.__decorate([
        Input(),
        tslib_1.__metadata("design:type", Object)
    ], RufDynamicSideMenuComponent.prototype, "minimized", void 0);
    tslib_1.__decorate([
        Input('minimized.xs'),
        tslib_1.__metadata("design:type", Object)
    ], RufDynamicSideMenuComponent.prototype, "minimizedXs", void 0);
    tslib_1.__decorate([
        Input('minimized.sm'),
        tslib_1.__metadata("design:type", Object)
    ], RufDynamicSideMenuComponent.prototype, "minimizedSm", void 0);
    tslib_1.__decorate([
        Input('minimized.md'),
        tslib_1.__metadata("design:type", Object)
    ], RufDynamicSideMenuComponent.prototype, "minimizedMd", void 0);
    tslib_1.__decorate([
        Input('minimized.lg'),
        tslib_1.__metadata("design:type", Object)
    ], RufDynamicSideMenuComponent.prototype, "minimizedLg", void 0);
    tslib_1.__decorate([
        Input('minimized.xl'),
        tslib_1.__metadata("design:type", Object)
    ], RufDynamicSideMenuComponent.prototype, "minimizedXl", void 0);
    tslib_1.__decorate([
        Input('minimized.gt-xs'),
        tslib_1.__metadata("design:type", Object)
    ], RufDynamicSideMenuComponent.prototype, "minimizedGtXs", void 0);
    tslib_1.__decorate([
        Input('minimized.gt-sm'),
        tslib_1.__metadata("design:type", Object)
    ], RufDynamicSideMenuComponent.prototype, "minimizedGtSm", void 0);
    tslib_1.__decorate([
        Input('minimized.gt-md'),
        tslib_1.__metadata("design:type", Object)
    ], RufDynamicSideMenuComponent.prototype, "minimizedGtMd", void 0);
    tslib_1.__decorate([
        Input('minimized.gt-lg'),
        tslib_1.__metadata("design:type", Object)
    ], RufDynamicSideMenuComponent.prototype, "minimizedGtLg", void 0);
    RufDynamicSideMenuComponent = tslib_1.__decorate([
        Component({
            selector: 'ruf-dynamic-sidemenu',
            template: "<ruf-sidemenu rufId=\"dynamic_sidemenu\" [activeColor]=\"_activeColor\"\n   [inkbarPosition]=\"_inkbarPosition\"\n   [selectedPath]=\"_selectedPath\"\n   [ngClass]=\"{'ruf-dynamic-sidemenu-minimized': isMinimized()}\"\n   (select)=\"onSelect($event)\">\n\n  <ng-container *ngFor=\"let item of items\">\n    <a [rufId]=\"getRufId(item)\" [data]=\"item\" *ngIf=\"!item.children || item.children.length === 0 \" [path]=\"item.path\"\n      rufSidemenuItem>\n      <mat-icon *ngIf=\"isMinimized()\" [fontIcon]=\"item.icon\"></mat-icon>\n      <ruf-labeled-icon *ngIf=\"!isMinimized()\" [fontIcon]=\"item.icon\" [ngClass]=\"{'sidemenu-item-with-no-icon': !item.icon}\">{{item.label}}\n      </ruf-labeled-icon>\n    </a>\n    <ng-container *ngIf=\"item.children && item.children.length > 0\">\n      <ng-container *ngIf=\"!isMinimized(); else minimizedTemplate\">\n        <a [rufId]=\"getRufId(item)\" [data]=\"item\" [path]=\"item.path\" rufSidemenuItem rufToggleChevron\n         #trigger=\"rufToggle\" (toggleChange)=\"toggleChildItems(trigger)\">\n          <ruf-labeled-icon [fontIcon]=\"item.icon\" [ngClass]=\"{'sidemenu-item-with-no-icon': !item.icon}\">{{item.label}}\n          </ruf-labeled-icon>\n        </a>\n        <ruf-sidemenu-children [rufId]=\"getRufId(item)+'_children'\" [visible]=\"trigger.value\"\n          [menuTrigger]=\"trigger\">\n          <a rufId *ngFor=\"let child of item.children\" [data]=\"child\" [path]=\"child.path\" rufSidemenuItem>\n            <ruf-labeled-icon [fontIcon]=\"child.icon\" [ngClass]=\"{'sidemenu-item-with-no-icon': !child.icon}\">{{child.label}}\n            </ruf-labeled-icon>\n          </a>\n        </ruf-sidemenu-children>\n      </ng-container>\n\n      <ng-template #minimizedTemplate>\n        <a [rufId]=\"getRufId(item)\"\n           [data]=\"item\"\n           [path]=\"item.path\"\n           rufSidemenuItem\n           #menuTrigger\n           [matMenuTriggerFor]=\"sideMenuPopup\"\n           (click)=\"setPopupData($event, item)\"\n           (keydown)=\"keyHandler($event)\">\n          <mat-icon [fontIcon]=\"item.icon\"></mat-icon>\n          <mat-icon fisIcon=\"arrow-down\" rufIconStyle=\"xs\" class=\"ruf-expand-sidemenu-popup-icon\"></mat-icon>\n      </a>\n      </ng-template>\n    </ng-container>\n\n  </ng-container>\n\n  <mat-menu #sideMenuPopup=\"matMenu\" overlapTrigger=\"true\" [class]=\"getOverlayClasses()\" (closed)=\"onPopupClose()\"\n    backdropClass=\"ruf-sidemenu-popup-backdrop\">\n    <ruf-sidemenu-children *ngIf=\"sideMenuPopupData\" rufId=\"ruf-sidemenu-children-items-popup\">\n      <p class=\"ruf-side-menu-popup-title\">{{sideMenuPopupData?.label}}</p>\n      <a rufId *ngFor=\"let child of sideMenuPopupData?.children\" [data]=\"child\" [path]=\"child.path\" (keydown.enter)=\"closeMenu()\"\n        rufSidemenuItem>\n        <span>{{child.label}}</span>\n    </a>\n    </ruf-sidemenu-children>\n  </mat-menu>\n</ruf-sidemenu>\n",
            encapsulation: ViewEncapsulation.None,
            styles: ["ruf-dynamic-sidemenu .sidemenu-item-with-no-icon .mat-icon{visibility:hidden;width:0}ruf-dynamic-sidemenu .sidemenu-item-with-no-icon span{margin-left:0}ruf-dynamic-sidemenu ruf-labeled-icon{white-space:normal}ruf-dynamic-sidemenu ruf-sidemenu.ruf-dynamic-sidemenu-minimized{box-shadow:none;min-width:auto}ruf-dynamic-sidemenu ruf-sidemenu.ruf-dynamic-sidemenu-minimized .ruf-menubar-layout.ruf-layout-column .ruf-menu-item{padding-right:0}.ruf-sidemenu-popup-backdrop+* .mat-menu-panel{border-radius:0;box-shadow:none}.ruf-sidemenu-popup-backdrop+* .mat-menu-panel.ruf-menubar-inkbar-start .ruf-menu-item{border-left-width:.25rem;border-left-style:solid}.ruf-sidemenu-popup-backdrop+* .mat-menu-panel.ruf-menubar-inkbar-end .ruf-menu-item{border-right-width:.25rem;border-right-style:solid}.ruf-sidemenu-popup-backdrop+* .mat-menu-panel .ruf-menu-item{padding-left:.9375rem;padding-right:.9375rem}.ruf-expand-sidemenu-popup-icon{-webkit-box-align:center;align-items:center;display:-webkit-box;display:flex}.ruf-side-menu-popup-title{padding-left:1.1875rem}"]
        }),
        tslib_1.__param(0, Inject(DOCUMENT)),
        tslib_1.__metadata("design:paramtypes", [Object, Renderer2,
            MediaObserver,
            ElementRef])
    ], RufDynamicSideMenuComponent);
    return RufDynamicSideMenuComponent;
}());
export { RufDynamicSideMenuComponent };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZHluYW1pYy1zaWRlbWVudS5jb21wb25lbnQuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9AcnVmL3NoZWxsLyIsInNvdXJjZXMiOlsic3JjL2R5bmFtaWMtc2lkZW1lbnUvZHluYW1pYy1zaWRlbWVudS5jb21wb25lbnQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IjtBQUFBLE9BQU8sRUFDTCxTQUFTLEVBQ1QsaUJBQWlCLEVBRWpCLFVBQVUsRUFDVixTQUFTLEVBQ1QsWUFBWSxFQUNaLEtBQUssRUFDTCxNQUFNLEVBQ04sTUFBTSxFQUNOLFNBQVMsRUFFVCxZQUFZLEVBQ1osU0FBUyxFQUNWLE1BQU0sZUFBZSxDQUFDO0FBQ3ZCLE9BQU8sRUFBRSxhQUFhLEVBQUUsTUFBTSxzQkFBc0IsQ0FBQztBQUdyRCxPQUFPLEVBQUUsY0FBYyxFQUFFLE1BQU0sd0JBQXdCLENBQUM7QUFDeEQsT0FBTyxFQUFDLFFBQVEsRUFBQyxNQUFNLGlCQUFpQixDQUFDO0FBQ3pDLE9BQU8sRUFBRSxLQUFLLEVBQUUsS0FBSyxFQUFFLE1BQU0sdUJBQXVCLENBQUM7QUFVckQ7SUFvQ0UscUNBQzJCLFFBQVEsRUFDMUIsU0FBb0IsRUFDcEIsY0FBNkIsRUFDN0IsV0FBdUI7UUFITCxhQUFRLEdBQVIsUUFBUSxDQUFBO1FBQzFCLGNBQVMsR0FBVCxTQUFTLENBQVc7UUFDcEIsbUJBQWMsR0FBZCxjQUFjLENBQWU7UUFDN0IsZ0JBQVcsR0FBWCxXQUFXLENBQVk7UUF2Q3ZCLFVBQUssR0FBNkIsRUFBRSxDQUFDO1FBY3JCLG9CQUFlLEdBQUcsSUFBSSxDQUFDLGVBQWUsSUFBSSxPQUFPLENBQUM7UUFFM0QsVUFBSyxHQUFHLElBQUksQ0FBQztRQUVYLFlBQU8sR0FBRyxJQUFJLFlBQVksRUFBMEIsQ0FBQztRQUd2RSx1REFBdUQ7UUFDOUMsY0FBUyxHQUFHLEtBQUssQ0FBQztRQUNKLGdCQUFXLEdBQUcsS0FBSyxDQUFDO1FBQ3BCLGdCQUFXLEdBQUcsS0FBSyxDQUFDO1FBQ3BCLGdC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SjtRQUF0QixLQUFLLENBQUMsY0FBYyxDQUFDOztvRUFBcUI7SUFDcEI7UUFBdEIsS0FBSyxDQUFDLGNBQWMsQ0FBQzs7b0VBQXFCO0lBQ3BCO1FBQXRCLEtBQUssQ0FBQyxjQUFjLENBQUM7O29FQUFxQjtJQUNwQjtRQUF0QixLQUFLLENBQUMsY0FBYyxDQUFDOztvRUFBcUI7SUFDcEI7UUFBdEIsS0FBSyxDQUFDLGNBQWMsQ0FBQzs7b0VBQXFCO0lBRWpCO1FBQXpCLEtBQUssQ0FBQyxpQkFBaUIsQ0FBQzs7c0VBQXVCO0lBQ3RCO1FBQXpCLEtBQUssQ0FBQyxpQkFBaUIsQ0FBQzs7c0VBQXVCO0lBQ3RCO1FBQXpCLEtBQUssQ0FBQyxpQkFBaUIsQ0FBQzs7c0VBQXVCO0lBQ3RCO1FBQXpCLEtBQUssQ0FBQyxpQkFBaUIsQ0FBQzs7c0VBQXVCO0lBakNyQywyQkFBMkI7UUFOdkMsU0FBUyxDQUFDO1lBQ1QsUUFBUSxFQUFFLHNCQUFzQjtZQUNoQyxpNEZBQWdEO1lBRWhELGFBQWEsRUFBRSxpQkFBaUIsQ0FBQyxJQUFJOztTQUN0QyxDQUFDO1FBc0NFLG1CQUFBLE1BQU0sQ0FBQyxRQUFRLENBQUMsQ0FBQTt5REFDRSxTQUFTO1lBQ0osYUFBYTtZQUNoQixVQUFVO09BeENyQiwyQkFBMkIsQ0FxSXZDO0lBQUQsa0NBQUM7Q0FBQSxBQXJJRCxJQXFJQztTQXJJWSwyQkFBMkIiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQge1xuICBDb21wb25lbnQsXG4gIFZpZXdFbmNhcHN1bGF0aW9uLFxuICBDaGFuZ2VEZXRlY3Rpb25TdHJhdGVneSxcbiAgRWxlbWVudFJlZixcbiAgUmVuZGVyZXIyLFxuICBFdmVudEVtaXR0ZXIsXG4gIElucHV0LFxuICBJbmplY3QsXG4gIE91dHB1dCxcbiAgVmlld0NoaWxkLFxuICBIb3N0QmluZGluZyxcbiAgVmlld0NoaWxkcmVuLFxuICBRdWVyeUxpc3Rcbn0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5pbXBvcnQgeyBNZWRpYU9ic2VydmVyIH0gZnJvbSAnQGFuZ3VsYXIvZmxleC1sYXlvdXQnO1xuXG5pbXBvcnQgeyBSdWZEeW5hbWljU2lkZW1lbnVJdGVtIH0gZnJvbSAnLi9keW5hbWljLXNpZGVtZW51LWl0ZW0nO1xuaW1wb3J0IHsgTWF0TWVudVRyaWdnZXIgfSBmcm9tICdAYW5ndWxhci9tYXRlcmlhbC9tZW51JztcbmltcG9ydCB7RE9DVU1FTlR9IGZyb20gJ0Bhbmd1bGFyL2NvbW1vbic7XG5pbXBvcnQgeyBFTlRFUiwgU1BBQ0UgfSBmcm9tICdAYW5ndWxhci9jZGsva2V5Y29kZXMnO1xuaW1wb3J0IHsgUnVmTWVudWJhckl0ZW0gfSBmcm9tICcuLi9tZW51YmFyLy9tZW51YmFyLWl0ZW0uY29tcG9uZW50JztcbmltcG9ydCB7IFJ1ZlRvZ2dsZURpcmVjdGl2ZSB9IGZyb20gJy4uL3RvZ2dsZS90b2dnbGUuZGlyZWN0aXZlJztcblxuQENvbXBvbmVudCh7XG4gIHNlbGVjdG9yOiAncnVmLWR5bmFtaWMtc2lkZW1lbnUnLFxuICB0ZW1wbGF0ZVVybDogJy4vZHluYW1pYy1zaWRlbWVudS5jb21wb25lbnQuaHRtbCcsXG4gIHN0eWxlVXJsczogWycuL2R5bmFtaWMtc2lkZW1lbnUuY29tcG9uZW50LnNjc3MnXSxcbiAgZW5jYXBzdWxhdGlvbjogVmlld0VuY2Fwc3VsYXRpb24uTm9uZVxufSlcbmV4cG9ydCBjbGFzcyBSdWZEeW5hbWljU2lkZU1lbnVDb21wb25lbnQge1xuICBASW5wdXQoKSBpdGVtczogUnVmRHluYW1pY1NpZGVtZW51SXRlbVtdID0gW107XG4gIEBJbnB1dCgpIHBvcHVwQmFja2dyb3VuZENsYXNzOiBzdHJpbmdcbiAgc2lkZU1lbnVQb3B1cERhdGE6IFJ1ZkR5bmFtaWNTaWRlbWVudUl0ZW07XG5cbiAgQFZpZXdDaGlsZChNYXRNZW51VHJpZ2dlciwge3N0YXRpYzogZmFsc2V9KSBwdWJsaWMgbWVudVRyaWdnZXI6IE1hdE1lbnVUcmlnZ2VyO1xuICBAVmlld0NoaWxkKCdtZW51VHJpZ2dlcicsIHtzdGF0aWM6IGZhbHNlfSkgcHVibGljIHRyaWdnZXI6IEVsZW1lbnRSZWY7XG5cbiAgLyogdHNsaW50OmRpc2FibGU6bm8taW5wdXQtcmVuYW1lICovXG4gIC8qIHRzbGludDpkaXNhYmxlOm5vLW91dHB1dC1yZW5hbWUgKi9cblxuICBASW5wdXQoJ3NlbGVjdGVkUGF0aCcpIF9zZWxlY3RlZFBhdGg6IHN0cmluZztcblxuICBASW5wdXQoJ2FjdGl2ZUNvbG9yJykgX2FjdGl2ZUNvbG9yOiBzdHJpbmc7XG5cbiAgQElucHV0KCdpbmtiYXJQb3NpdGlvbicpIF9pbmtiYXJQb3NpdGlvbiA9IHRoaXMuX2lua2JhclBvc2l0aW9uIHx8ICdzdGFydCc7XG5cbiAgQElucHV0KCdtdWx0aScpIG11bHRpID0gdHJ1ZTtcblxuICBAT3V0cHV0KCdzZWxlY3QnKSBfc2VsZWN0ID0gbmV3IEV2ZW50RW1pdHRlcjxSdWZEeW5hbWljU2lkZW1lbnVJdGVtPigpO1xuICBAVmlld0NoaWxkcmVuKCd0cmlnZ2VyJykgcHJpdmF0ZSBfdHJpZ2dlcnM6IFF1ZXJ5TGlzdDxSdWZUb2dnbGVEaXJlY3RpdmU+O1xuXG4gIC8vIEBIb3N0QmluZGluZygnY2xhc3MucnVmLWR5bmFtaWMtc2lkZW1lbnUtbWluaW1pemVkJylcbiAgQElucHV0KCkgbWluaW1pemVkID0gZmFsc2U7XG4gIEBJbnB1dCgnbWluaW1pemVkLnhzJykgbWluaW1pemVkWHMgPSBmYWxzZTtcbiAgQElucHV0KCdtaW5pbWl6ZWQuc20nKSBtaW5pbWl6ZWRTbSA9IGZhbHNlO1xuICBASW5wdXQoJ21pbmltaXplZC5tZCcpIG1pbmltaXplZE1kID0gZmFsc2U7XG4gIEBJbnB1dCgnbWluaW1pemVkLmxnJykgbWluaW1pemVkTGcgPSBmYWxzZTtcbiAgQElucHV0KCdtaW5pbWl6ZWQueGwnKSBtaW5pbWl6ZWRYbCA9IGZhbHNlO1xuXG4gIEBJbnB1dCgnbWluaW1pemVkLmd0LXhzJykgbWluaW1pemVkR3RYcyA9IGZhbHNlO1xuICBASW5wdXQoJ21pbmltaXplZC5ndC1zbScpIG1pbmltaXplZEd0U20gPSBmYWxzZTtcbiAgQElucHV0KCdtaW5pbWl6ZWQuZ3QtbWQnKSBtaW5pbWl6ZWRHdE1kID0gZmFsc2U7XG4gIEBJbnB1dCgnbWluaW1pemVkLmd0LWxnJykgbWluaW1pemVkR3RMZyA9IGZhbHNlO1xuXG5cbiAgY29uc3RydWN0b3IoXG4gICBASW5qZWN0KERPQ1VNRU5UKSBwcml2YXRlIGRvY3VtZW50LFxuICAgcHJpdmF0ZSBfcmVuZGVyZXI6IFJlbmRlcmVyMixcbiAgIHByaXZhdGUgX21lZGlhT2JzZXJ2ZXI6IE1lZGlhT2JzZXJ2ZXIsXG4gICBwcml2YXRlIF9lbGVtZW50UmVmOiBFbGVtZW50UmVmKSB7XG5cbiAgfVxuXG5cbiAgaXNNaW5pbWl6ZWQoKSB7XG4gICAgcmV0dXJuIFtcbiAgICAgICB0aGlzLm1pbmltaXplZCxcbiAgICAgICB0aGlzLm1pbmltaXplZFhzICYmIHRoaXMuX21lZGlhT2JzZXJ2ZXIuaXNBY3RpdmUoJ3hzJyksXG4gICAgICAgdGhpcy5taW5pbWl6ZWRTbSAmJiB0aGlzLl9tZWRpYU9ic2VydmVyLmlzQWN0aXZlKCdzbScpLFxuICAgICAgIHRoaXMubWluaW1pemVkTWQgJiYgdGhpcy5fbWVkaWFPYnNlcnZlci5pc0FjdGl2ZSgnbWQnKSxcbiAgICAgICB0aGlzLm1pbmltaXplZExnICYmIHRoaXMuX21lZGlhT2JzZXJ2ZXIuaXNBY3RpdmUoJ2xnJyksXG4gICAgICAgdGhpcy5taW5pbWl6ZWRYbCAmJiB0aGlzLl9tZWRpYU9ic2VydmVyLmlzQWN0aXZlKCd4bCcpLFxuICAgICAgIHRoaXMubWluaW1pemVkR3RYcyAmJiB0aGlzLl9tZWRpYU9ic2VydmVyLmlzQWN0aXZlKCdndC14cycpLFxuICAgICAgIHRoaXMubWluaW1pemVkR3RTbSAmJiB0aGlzLl9tZWRpYU9ic2VydmVyLmlzQWN0aXZlKCdndC1zbScpLFxuICAgICAgIHRoaXMubWluaW1pemVkR3RNZCAmJiB0aGlzLl9tZWRpYU9ic2VydmVyLmlzQWN0aXZlKCdndC1tZCcpLFxuICAgICAgIHRoaXMubWluaW1pemVkR3RMZyAmJiB0aGlzLl9tZWRpYU9ic2VydmVyLmlzQWN0aXZlKCdndC1sZycpXG4gICAgICBdLnNvbWUoeCA9PiB4ID09PSB0cnVlKTtcbiAgfVxuXG5cbiAgb25TZWxlY3QoJGV2ZW50OiBSdWZNZW51YmFySXRlbSkge1xuICAgIGlmICghKCRldmVudC5kYXRhICYmICRldmVudC5kYXRhLmNoaWxkcmVuKSkge1xuICAgICAgdGhpcy5fc2VsZWN0ZWRQYXRoID0gJGV2ZW50LnBhdGg7XG4gICAgICB0aGlzLl9zZWxlY3QuZW1pdCgkZXZlbnQuZGF0YSk7XG4gICAgfSBlbHNlIGlmICgkZXZlbnQgJiYgJGV2ZW50LmV2ZW50KSB7XG4gICAgICAkZXZlbnQuZXZlbnQucHJldmVudERlZmF1bHQoKTtcbiAgICAgICRldmVudC5ldmVudC5zdG9wUHJvcGFnYXRpb24oKTtcbiAgICB9XG4gIH1cblxuICBnZXRSdWZJZChpdGVtKTogc3RyaW5nIHsgLy8gcmV0dXJuIGlkIGZvciBzaWRlbWVudSBpdGVtcy5cbiAgIHJldHVybiAnZHluYW1pY19zaWRlbWVudV8nICsgaXRlbS5sYWJlbC50b0xvd2VyQ2FzZSgpLnJlcGxhY2UoLyAvZywgJ18nKTtcbiAgfVxuXG4gIGNsb3NlTWVudSgpIHtcbiAgICB0aGlzLm1lbnVUcmlnZ2VyLmNsb3NlTWVudSgpO1xuICB9XG5cbiAgc2V0UG9wdXBEYXRhKGV2ZW50LCBkYXRhKSB7XG4gICAgdGhpcy5zaWRlTWVudVBvcHVwRGF0YSA9IGRhdGFcbiAgICBldmVudC5jdXJyZW50VGFyZ2V0LmNsYXNzTGlzdC5hZGQoJ3J1Zi1hY3RpdmUnKVxuICAgIC8vIGZvY3VzIG9uIHRoZSBmaXJzdCBtZW51IGl0ZW1cbiAgICBzZXRUaW1lb3V0KCgpID0+IHtcbiAgICAgIGNvbnN0IGNka092ZXJsYXlDbGFzcyA9IGAucnVmLXNpZGVtZW51LXBvcHVwLWJhY2tkcm9wICsgLmNkay1vdmVybGF5LWNvbm5lY3RlZC1wb3NpdGlvbi1ib3VuZGluZy1ib3hgO1xuICAgICAgY29uc3QgY2RrT3ZlcmxheUVsZW1lbnQ6IEhUTUxFbGVtZW50ID0gdGhpcy5kb2N1bWVudC5xdWVyeVNlbGVjdG9yKGNka092ZXJsYXlDbGFzcyk7XG4gICAgICBpZiAoY2RrT3ZlcmxheUVsZW1lbnQpIHtcbiAgICAgICAgLy8gc2V0IGxlZnQgcG9zaXRpb24gZm9yIGNka092ZXJsYXkgYmFzZWQgb24gdGhlIHBvc2l0aW9uIG9mIG1lbnVpdGVtLlxuICAgICAgICAvLyBzbyB3ZSBuZWVkIHRvIGdldCBsZWZ0IGFuZCB3aWR0aCB2YWx1ZSBmcm9tIEJvdW5kaW5nQ2xpZW50UmVjdDtcbiAgICAgICAgY29uc3QgcnVmTWVudUl0ZW0gPSB0aGlzLl9lbGVtZW50UmVmLm5hdGl2ZUVsZW1lbnQucXVlcnlTZWxlY3RvcignLnJ1Zi1tZW51LWl0ZW0nKTtcbiAgICAgICAgY29uc3QgcnVmTWVudUl0ZW1DbGllbnRUZWN0ID0gICBydWZNZW51SXRlbS5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKTtcbiAgICAgICAgY2RrT3ZlcmxheUVsZW1lbnQuc3R5bGUubGVmdCA9IHJ1Zk1lbnVJdGVtQ2xpZW50VGVjdC5sZWZ0ICsgcnVmTWVudUl0ZW1DbGllbnRUZWN0LndpZHRoICsgJ3B4JztcbiAgICAgICAgY29uc3QgZmlyc3RNZW51SXRlbTogSFRNTEVsZW1lbnQgPSB0aGlzLmRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoYCR7Y2RrT3ZlcmxheUNsYXNzfSAucnVmLW1lbnUtaXRlbWApO1xuICAgICAgICBpZiAoZmlyc3RNZW51SXRlbSkge1xuICAgICAgICAgIGZpcnN0TWVudUl0ZW0uZm9jdXMoKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH0pO1xuICB9XG5cbiAgb25Qb3B1cENsb3NlKCkge1xuICAgIC8vIHJlbW92ZSBhY3RpdmUgY2xhc3Mgd2hlbiBwb3BvcCBpcyBjbG9zZWRcbiAgICBjb25zdCBjdXJyZW50QWN0aXZlSXRlbSAgPSB0aGlzLl9lbGVtZW50UmVmLm5hdGl2ZUVsZW1lbnQucXVlcnlTZWxlY3RvcignLnJ1Zi1tZW51LWl0ZW0ucnVmLWFjdGl2ZScpO1xuICAgIGlmIChjdXJyZW50QWN0aXZlSXRlbSkge1xuICAgICAgY3VycmVudEFjdGl2ZUl0ZW0uZm9jdXMoKTtcbiAgICAgIHRoaXMuX3JlbmRlcmVyLnJlbW92ZUNsYXNzKGN1cnJlbnRBY3RpdmVJdGVtLCAncnVmLWFjdGl2ZScpO1xuICAgIH1cbiAgfVxuXG4gIGtleUhhbmRsZXIoZXZlbnQpIHtcbiAgICBzd2l0Y2ggKGV2ZW50LmtleUNvZGUpIHtcbiAgICAgIGNhc2UgRU5URVI6XG4gICAgICBjYXNlIFNQQUNFOlxuICAgICAgICBldmVudC5jdXJyZW50VGFyZ2V0LmNsaWNrKCk7XG4gICAgICAgIGJyZWFrO1xuICAgICAgZGVmYXVsdDpcbiAgICB9XG4gIH1cblxuICBnZXRPdmVybGF5Q2xhc3NlcygpIHtcbiAgICBjb25zdCBjb2xvckNsYXNzID0gIHRoaXMuX2FjdGl2ZUNvbG9yID8gYHJ1Zi0ke3RoaXMuX2FjdGl2ZUNvbG9yfWAgOiBgYDtcbiAgICByZXR1cm4gYCR7dGhpcy5wb3B1cEJhY2tncm91bmRDbGFzc30gJHtjb2xvckNsYXNzfSBydWYtbWVudWJhci1pbmtiYXItJHt0aGlzLl9pbmtiYXJQb3NpdGlvbn1gO1xuICB9XG5cbiAgdG9nZ2xlQ2hpbGRJdGVtcyhjdXJyZW50VHJpZ2dlcjogUnVmVG9nZ2xlRGlyZWN0aXZlKTogdm9pZCB7XG4gICAgaWYgKHRoaXMubXVsdGkgPT09IGZhbHNlKSB7XG4gICAgICB0aGlzLl90cmlnZ2Vycy50b0FycmF5KClcbiAgICAgIC5maWx0ZXIoKGVsZW1lbnQ6IFJ1ZlRvZ2dsZURpcmVjdGl2ZSkgPT4gZWxlbWVudC52YWx1ZSA9PT0gdHJ1ZSAmJiBlbGVtZW50ICE9PSBjdXJyZW50VHJpZ2dlcilcbiAgICAgIC5mb3JFYWNoKChlbGVtZW50OiBhbnkpID0+IHtcbiAgICAgICAgZWxlbWVudC52YWx1ZSA9IGZhbHNlO1xuICAgICAgfSk7XG4gICAgfVxuICB9XG59XG4iXX0=