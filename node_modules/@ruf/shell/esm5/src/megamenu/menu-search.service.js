import * as tslib_1 from "tslib";
import { Injectable } from '@angular/core';
// the object we reduce into during search preparation
var RufCart = /** @class */ (function () {
    function RufCart() {
    }
    return RufCart;
}());
export { RufCart };
var RufSearchService = /** @class */ (function () {
    function RufSearchService() {
        this.SPLITTER = String.fromCharCode(167);
    }
    RufSearchService.prototype.recursiveReduce = function (items, context) {
        var _this = this;
        return items.reduce(function (cart, item) {
            if (item.children && item.children.length > 0) {
                // this is a parent
                var newContext = context.concat([item.label]);
                var childCart = _this.recursiveReduce(item.children, newContext);
                // we need to add a parent object with this objects children
                var parent_1 = {
                    label: item.label,
                    path: item.path,
                    context: context.join(', '),
                    children: childCart.children,
                    searchKey: childCart.searchKeys.join(_this.SPLITTER) // only searchkeys of non-parent nodes
                };
                // only add this parent, if it has children
                if (childCart.children && childCart.children.length > 0) {
                    cart.parents.push(parent_1);
                }
                // we get the parent nodes from the children of this item and only pass these up
                cart.parents = cart.parents.concat(childCart.parents); // the reduced items are basically pushed up to the highest level
                // we also append the childcart keys to the parent (for searching purposes)
                // This isn't necessary anymore as we only have one level cart.searchKeys = cart.searchKeys.concat(childCart.searchKeys);
            }
            else {
                // this is a child, so we add it to this carts children
                item.searchKey = item.label.toLowerCase(); // we make the search key lowercase here for all children
                cart.children.push(item);
                cart.searchKeys.push(item.searchKey);
            }
            return cart;
        }, {
            // start with an empty cart
            parents: [],
            children: [],
            searchKeys: []
        });
    };
    // prepares the search items
    RufSearchService.prototype.prepareSearch = function (items) {
        var _this = this;
        // the goal is to recursively parse the tree structure for parents of children
        // children are nodes with no children, parents are nodes with children
        var preparedItems = this.recursiveReduce(items, []);
        // we return a function here that performs the search on the prepared items
        return function (term) {
            return _this.performSearch(preparedItems.parents, term);
        };
    };
    // used to create a reduced version of what gets displayed, and also
    // detaches from the original object
    RufSearchService.prototype.copySearchItem = function (item, newChildren) {
        return {
            label: item.label,
            path: item.path,
            context: item.context,
            children: newChildren
        };
    };
    // The search assumes that there each item in the array only has one level of children
    // this explicit structure is created in the prepare search
    RufSearchService.prototype.performSearch = function (items, term) {
        var _this = this;
        var searchTerm = term.toLowerCase(); // lowercase search term vs lowercase search key
        // call the reduce to omit non matching items
        return items.reduce(
        // newItems is the returned value from the prev function call
        function (newItems, item) {
            // first we check if the parent item will be added (checking this here prevents unnecessary looping)
            if (item.searchKey && item.searchKey.indexOf(searchTerm) > -1) {
                // filter the children
                // (we know there are children as the searchkey collates only child keys)
                var reducedChildren = item.children.filter(function (child) {
                    return child.searchKey.indexOf(searchTerm) > -1;
                });
                // there will always be atleast one child that matches
                // (as have already we checked the collated search key)
                newItems.push(_this.copySearchItem(item, reducedChildren));
            }
            return newItems;
        }, [] // initial empty array
        );
    };
    RufSearchService = tslib_1.__decorate([
        Injectable()
    ], RufSearchService);
    return RufSearchService;
}());
export { RufSearchService };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibWVudS1zZWFyY2guc2VydmljZS5qcyIsInNvdXJjZVJvb3QiOiJuZzovL0BydWYvc2hlbGwvIiwic291cmNlcyI6WyJzcmMvbWVnYW1lbnUvbWVudS1zZWFyY2guc2VydmljZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiO0FBQUEsT0FBTyxFQUFFLFVBQVUsRUFBRSxNQUFNLGVBQWUsQ0FBQztBQUkzQyxzREFBc0Q7QUFDdEQ7SUFBQTtJQUlBLENBQUM7SUFBRCxjQUFDO0FBQUQsQ0FBQyxBQUpELElBSUM7O0FBR0Q7SUFEQTtRQUVVLGFBQVEsR0FBRyxNQUFNLENBQUMsWUFBWSxDQUFDLEdBQUcsQ0FBQyxDQUFDO0lBd0Y5QyxDQUFDO0lBdEZDLDBDQUFlLEdBQWYsVUFBZ0IsS0FBc0IsRUFBRSxPQUFpQjtRQUF6RCxpQkFzQ0M7UUFyQ0MsT0FBTyxLQUFLLENBQUMsTUFBTSxDQUNqQixVQUFDLElBQWEsRUFBRSxJQUFtQjtZQUNqQyxJQUFJLElBQUksQ0FBQyxRQUFRLElBQUksSUFBSSxDQUFDLFFBQVEsQ0FBQyxNQUFNLEdBQUcsQ0FBQyxFQUFFO2dCQUM3QyxtQkFBbUI7Z0JBQ25CLElBQU0sVUFBVSxHQUFHLE9BQU8sQ0FBQyxNQUFNLENBQUMsQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQztnQkFDaEQsSUFBTSxTQUFTLEdBQUcsS0FBSSxDQUFDLGVBQWUsQ0FBQyxJQUFJLENBQUMsUUFBUSxFQUFFLFVBQVUsQ0FBQyxDQUFDO2dCQUNsRSw0REFBNEQ7Z0JBQzVELElBQU0sUUFBTSxHQUFHO29CQUNiLEtBQUssRUFBRSxJQUFJLENBQUMsS0FBSztvQkFDakIsSUFBSSxFQUFFLElBQUksQ0FBQyxJQUFJO29CQUNmLE9BQU8sRUFBRSxPQUFPLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQztvQkFDM0IsUUFBUSxFQUFFLFNBQVMsQ0FBQyxRQUFRO29CQUM1QixTQUFTLEVBQUUsU0FBUyxDQUFDLFVBQVUsQ0FBQyxJQUFJLENBQUMsS0FBSSxDQUFDLFFBQVEsQ0FBQyxDQUFDLHNDQUFzQztpQkFDM0YsQ0FBQztnQkFDRiwyQ0FBMkM7Z0JBQzNDLElBQUksU0FBUyxDQUFDLFFBQVEsSUFBSSxTQUFTLENBQUMsUUFBUSxDQUFDLE1BQU0sR0FBRyxDQUFDLEVBQUU7b0JBQ3ZELElBQUksQ0FBQyxPQUFPLENBQUMsSUFBSSxDQUFDLFFBQU0sQ0FBQyxDQUFDO2lCQUMzQjtnQkFDRCxnRkFBZ0Y7Z0JBQ2hGLElBQUksQ0FBQyxPQUFPLEdBQUcsSUFBSSxDQUFDLE9BQU8sQ0FBQyxNQUFNLENBQUMsU0FBUyxDQUFDLE9BQU8sQ0FBQyxDQUFDLENBQUMsaUVBQWlFO2dCQUN4SCwyRUFBMkU7Z0JBQzNFLHlIQUF5SDthQUMxSDtpQkFBTTtnQkFDTCx1REFBdUQ7Z0JBQ3ZELElBQUksQ0FBQyxTQUFTLEdBQUcsSUFBSSxDQUFDLEtBQUssQ0FBQyxXQUFXLEVBQUUsQ0FBQyxDQUFDLHlEQUF5RDtnQkFDcEcsSUFBSSxDQUFDLFFBQVEsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUM7Z0JBQ3pCLElBQUksQ0FBQyxVQUFVLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxTQUFTLENBQUMsQ0FBQzthQUN0QztZQUNELE9BQU8sSUFBSSxDQUFDO1FBQ2QsQ0FBQyxFQUNEO1lBQ0UsMkJBQTJCO1lBQzNCLE9BQU8sRUFBRSxFQUFFO1lBQ1gsUUFBUSxFQUFFLEVBQUU7WUFDWixVQUFVLEVBQUUsRUFBRTtTQUNmLENBQ0YsQ0FBQztJQUNKLENBQUM7SUFFRCw0QkFBNEI7SUFDNUIsd0NBQWEsR0FBYixVQUFjLEtBQXNCO1FBQXBDLGlCQVFDO1FBUEMsOEVBQThFO1FBQzlFLHVFQUF1RTtRQUN2RSxJQUFNLGFBQWEsR0FBRyxJQUFJLENBQUMsZUFBZSxDQUFDLEtBQUssRUFBRSxFQUFFLENBQUMsQ0FBQztRQUN0RCwyRUFBMkU7UUFDM0UsT0FBTyxVQUFBLElBQUk7WUFDVCxPQUFPLEtBQUksQ0FBQyxhQUFhLENBQUMsYUFBYSxDQUFDLE9BQU8sRUFBRSxJQUFJLENBQUMsQ0FBQztRQUN6RCxDQUFDLENBQUM7SUFDSixDQUFDO0lBRUQsb0VBQW9FO0lBQ3BFLG9DQUFvQztJQUNwQyx5Q0FBYyxHQUFkLFVBQWUsSUFBbUIsRUFBRSxXQUE0QjtRQUM5RCxPQUFPO1lBQ0wsS0FBSyxFQUFFLElBQUksQ0FBQyxLQUFLO1lBQ2pCLElBQUksRUFBRSxJQUFJLENBQUMsSUFBSTtZQUNmLE9BQU8sRUFBRSxJQUFJLENBQUMsT0FBTztZQUNyQixRQUFRLEVBQUUsV0FBVztTQUN0QixDQUFDO0lBQ0osQ0FBQztJQUVELHNGQUFzRjtJQUN0RiwyREFBMkQ7SUFDM0Qsd0NBQWEsR0FBYixVQUFjLEtBQXNCLEVBQUUsSUFBWTtRQUFsRCxpQkFxQkM7UUFwQkMsSUFBTSxVQUFVLEdBQUcsSUFBSSxDQUFDLFdBQVcsRUFBRSxDQUFDLENBQUMsZ0RBQWdEO1FBQ3ZGLDZDQUE2QztRQUM3QyxPQUFPLEtBQUssQ0FBQyxNQUFNO1FBQ2pCLDZEQUE2RDtRQUM3RCxVQUFDLFFBQVEsRUFBRSxJQUFJO1lBQ2Isb0dBQW9HO1lBQ3BHLElBQUksSUFBSSxDQUFDLFNBQVMsSUFBSSxJQUFJLENBQUMsU0FBUyxDQUFDLE9BQU8sQ0FBQyxVQUFVLENBQUMsR0FBRyxDQUFDLENBQUMsRUFBRTtnQkFDN0Qsc0JBQXNCO2dCQUN0Qix5RUFBeUU7Z0JBQ3pFLElBQU0sZUFBZSxHQUFHLElBQUksQ0FBQyxRQUFRLENBQUMsTUFBTSxDQUFDLFVBQUEsS0FBSztvQkFDaEQsT0FBTyxLQUFLLENBQUMsU0FBUyxDQUFDLE9BQU8sQ0FBQyxVQUFVLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQztnQkFDbEQsQ0FBQyxDQUFDLENBQUM7Z0JBQ0gsc0RBQXNEO2dCQUN0RCx1REFBdUQ7Z0JBQ3ZELFFBQVEsQ0FBQyxJQUFJLENBQUMsS0FBSSxDQUFDLGNBQWMsQ0FBQyxJQUFJLEVBQUUsZUFBZSxDQUFDLENBQUMsQ0FBQzthQUMzRDtZQUNELE9BQU8sUUFBUSxDQUFDO1FBQ2xCLENBQUMsRUFDRCxFQUFFLENBQUMsc0JBQXNCO1NBQzFCLENBQUM7SUFDSixDQUFDO0lBeEZVLGdCQUFnQjtRQUQ1QixVQUFVLEVBQUU7T0FDQSxnQkFBZ0IsQ0F5RjVCO0lBQUQsdUJBQUM7Q0FBQSxBQXpGRCxJQXlGQztTQXpGWSxnQkFBZ0IiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBJbmplY3RhYmxlIH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5pbXBvcnQgeyBPYnNlcnZhYmxlIH0gZnJvbSAncnhqcyc7XG5pbXBvcnQgeyBSdWZTZWFyY2hJdGVtIH0gZnJvbSAnLi9zZWFyY2gvc2VhcmNoaXRlbS5pbnRlcmZhY2UnO1xuXG4vLyB0aGUgb2JqZWN0IHdlIHJlZHVjZSBpbnRvIGR1cmluZyBzZWFyY2ggcHJlcGFyYXRpb25cbmV4cG9ydCBjbGFzcyBSdWZDYXJ0IHtcbiAgcGFyZW50czogUnVmU2VhcmNoSXRlbVtdO1xuICBjaGlsZHJlbjogUnVmU2VhcmNoSXRlbVtdO1xuICBzZWFyY2hLZXlzOiBzdHJpbmdbXTtcbn1cblxuQEluamVjdGFibGUoKVxuZXhwb3J0IGNsYXNzIFJ1ZlNlYXJjaFNlcnZpY2Uge1xuICBwcml2YXRlIFNQTElUVEVSID0gU3RyaW5nLmZyb21DaGFyQ29kZSgxNjcpO1xuXG4gIHJlY3Vyc2l2ZVJlZHVjZShpdGVtczogUnVmU2VhcmNoSXRlbVtdLCBjb250ZXh0OiBzdHJpbmdbXSk6IFJ1ZkNhcnQge1xuICAgIHJldHVybiBpdGVtcy5yZWR1Y2U8UnVmQ2FydD4oXG4gICAgICAoY2FydDogUnVmQ2FydCwgaXRlbTogUnVmU2VhcmNoSXRlbSkgPT4ge1xuICAgICAgICBpZiAoaXRlbS5jaGlsZHJlbiAmJiBpdGVtLmNoaWxkcmVuLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAvLyB0aGlzIGlzIGEgcGFyZW50XG4gICAgICAgICAgY29uc3QgbmV3Q29udGV4dCA9IGNvbnRleHQuY29uY2F0KFtpdGVtLmxhYmVsXSk7XG4gICAgICAgICAgY29uc3QgY2hpbGRDYXJ0ID0gdGhpcy5yZWN1cnNpdmVSZWR1Y2UoaXRlbS5jaGlsZHJlbiwgbmV3Q29udGV4dCk7XG4gICAgICAgICAgLy8gd2UgbmVlZCB0byBhZGQgYSBwYXJlbnQgb2JqZWN0IHdpdGggdGhpcyBvYmplY3RzIGNoaWxkcmVuXG4gICAgICAgICAgY29uc3QgcGFyZW50ID0ge1xuICAgICAgICAgICAgbGFiZWw6IGl0ZW0ubGFiZWwsXG4gICAgICAgICAgICBwYXRoOiBpdGVtLnBhdGgsXG4gICAgICAgICAgICBjb250ZXh0OiBjb250ZXh0LmpvaW4oJywgJyksXG4gICAgICAgICAgICBjaGlsZHJlbjogY2hpbGRDYXJ0LmNoaWxkcmVuLCAvLyB0aGlzIGlzIHRoZSByZWR1Y2luZyBwYXJ0IG9mIHRoaW5nc1xuICAgICAgICAgICAgc2VhcmNoS2V5OiBjaGlsZENhcnQuc2VhcmNoS2V5cy5qb2luKHRoaXMuU1BMSVRURVIpIC8vIG9ubHkgc2VhcmNoa2V5cyBvZiBub24tcGFyZW50IG5vZGVzXG4gICAgICAgICAgfTtcbiAgICAgICAgICAvLyBvbmx5IGFkZCB0aGlzIHBhcmVudCwgaWYgaXQgaGFzIGNoaWxkcmVuXG4gICAgICAgICAgaWYgKGNoaWxkQ2FydC5jaGlsZHJlbiAmJiBjaGlsZENhcnQuY2hpbGRyZW4ubGVuZ3RoID4gMCkge1xuICAgICAgICAgICAgY2FydC5wYXJlbnRzLnB1c2gocGFyZW50KTtcbiAgICAgICAgICB9XG4gICAgICAgICAgLy8gd2UgZ2V0IHRoZSBwYXJlbnQgbm9kZXMgZnJvbSB0aGUgY2hpbGRyZW4gb2YgdGhpcyBpdGVtIGFuZCBvbmx5IHBhc3MgdGhlc2UgdXBcbiAgICAgICAgICBjYXJ0LnBhcmVudHMgPSBjYXJ0LnBhcmVudHMuY29uY2F0KGNoaWxkQ2FydC5wYXJlbnRzKTsgLy8gdGhlIHJlZHVjZWQgaXRlbXMgYXJlIGJhc2ljYWxseSBwdXNoZWQgdXAgdG8gdGhlIGhpZ2hlc3QgbGV2ZWxcbiAgICAgICAgICAvLyB3ZSBhbHNvIGFwcGVuZCB0aGUgY2hpbGRjYXJ0IGtleXMgdG8gdGhlIHBhcmVudCAoZm9yIHNlYXJjaGluZyBwdXJwb3NlcylcbiAgICAgICAgICAvLyBUaGlzIGlzbid0IG5lY2Vzc2FyeSBhbnltb3JlIGFzIHdlIG9ubHkgaGF2ZSBvbmUgbGV2ZWwgY2FydC5zZWFyY2hLZXlzID0gY2FydC5zZWFyY2hLZXlzLmNvbmNhdChjaGlsZENhcnQuc2VhcmNoS2V5cyk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgLy8gdGhpcyBpcyBhIGNoaWxkLCBzbyB3ZSBhZGQgaXQgdG8gdGhpcyBjYXJ0cyBjaGlsZHJlblxuICAgICAgICAgIGl0ZW0uc2VhcmNoS2V5ID0gaXRlbS5sYWJlbC50b0xvd2VyQ2FzZSgpOyAvLyB3ZSBtYWtlIHRoZSBzZWFyY2gga2V5IGxvd2VyY2FzZSBoZXJlIGZvciBhbGwgY2hpbGRyZW5cbiAgICAgICAgICBjYXJ0LmNoaWxkcmVuLnB1c2goaXRlbSk7XG4gICAgICAgICAgY2FydC5zZWFyY2hLZXlzLnB1c2goaXRlbS5zZWFyY2hLZXkpO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBjYXJ0O1xuICAgICAgfSxcbiAgICAgIHtcbiAgICAgICAgLy8gc3RhcnQgd2l0aCBhbiBlbXB0eSBjYXJ0XG4gICAgICAgIHBhcmVudHM6IFtdLFxuICAgICAgICBjaGlsZHJlbjogW10sXG4gICAgICAgIHNlYXJjaEtleXM6IFtdXG4gICAgICB9XG4gICAgKTtcbiAgfVxuXG4gIC8vIHByZXBhcmVzIHRoZSBzZWFyY2ggaXRlbXNcbiAgcHJlcGFyZVNlYXJjaChpdGVtczogUnVmU2VhcmNoSXRlbVtdKTogKHRlcm06IHN0cmluZykgPT4gUnVmU2VhcmNoSXRlbVtdIHtcbiAgICAvLyB0aGUgZ29hbCBpcyB0byByZWN1cnNpdmVseSBwYXJzZSB0aGUgdHJlZSBzdHJ1Y3R1cmUgZm9yIHBhcmVudHMgb2YgY2hpbGRyZW5cbiAgICAvLyBjaGlsZHJlbiBhcmUgbm9kZXMgd2l0aCBubyBjaGlsZHJlbiwgcGFyZW50cyBhcmUgbm9kZXMgd2l0aCBjaGlsZHJlblxuICAgIGNvbnN0IHByZXBhcmVkSXRlbXMgPSB0aGlzLnJlY3Vyc2l2ZVJlZHVjZShpdGVtcywgW10pO1xuICAgIC8vIHdlIHJldHVybiBhIGZ1bmN0aW9uIGhlcmUgdGhhdCBwZXJmb3JtcyB0aGUgc2VhcmNoIG9uIHRoZSBwcmVwYXJlZCBpdGVtc1xuICAgIHJldHVybiB0ZXJtID0+IHtcbiAgICAgIHJldHVybiB0aGlzLnBlcmZvcm1TZWFyY2gocHJlcGFyZWRJdGVtcy5wYXJlbnRzLCB0ZXJtKTtcbiAgICB9O1xuICB9XG5cbiAgLy8gdXNlZCB0byBjcmVhdGUgYSByZWR1Y2VkIHZlcnNpb24gb2Ygd2hhdCBnZXRzIGRpc3BsYXllZCwgYW5kIGFsc29cbiAgLy8gZGV0YWNoZXMgZnJvbSB0aGUgb3JpZ2luYWwgb2JqZWN0XG4gIGNvcHlTZWFyY2hJdGVtKGl0ZW06IFJ1ZlNlYXJjaEl0ZW0sIG5ld0NoaWxkcmVuOiBSdWZTZWFyY2hJdGVtW10pOiBSdWZTZWFyY2hJdGVtIHtcbiAgICByZXR1cm4ge1xuICAgICAgbGFiZWw6IGl0ZW0ubGFiZWwsXG4gICAgICBwYXRoOiBpdGVtLnBhdGgsXG4gICAgICBjb250ZXh0OiBpdGVtLmNvbnRleHQsXG4gICAgICBjaGlsZHJlbjogbmV3Q2hpbGRyZW5cbiAgICB9O1xuICB9XG5cbiAgLy8gVGhlIHNlYXJjaCBhc3N1bWVzIHRoYXQgdGhlcmUgZWFjaCBpdGVtIGluIHRoZSBhcnJheSBvbmx5IGhhcyBvbmUgbGV2ZWwgb2YgY2hpbGRyZW5cbiAgLy8gdGhpcyBleHBsaWNpdCBzdHJ1Y3R1cmUgaXMgY3JlYXRlZCBpbiB0aGUgcHJlcGFyZSBzZWFyY2hcbiAgcGVyZm9ybVNlYXJjaChpdGVtczogUnVmU2VhcmNoSXRlbVtdLCB0ZXJtOiBzdHJpbmcpIHtcbiAgICBjb25zdCBzZWFyY2hUZXJtID0gdGVybS50b0xvd2VyQ2FzZSgpOyAvLyBsb3dlcmNhc2Ugc2VhcmNoIHRlcm0gdnMgbG93ZXJjYXNlIHNlYXJjaCBrZXlcbiAgICAvLyBjYWxsIHRoZSByZWR1Y2UgdG8gb21pdCBub24gbWF0Y2hpbmcgaXRlbXNcbiAgICByZXR1cm4gaXRlbXMucmVkdWNlKFxuICAgICAgLy8gbmV3SXRlbXMgaXMgdGhlIHJldHVybmVkIHZhbHVlIGZyb20gdGhlIHByZXYgZnVuY3Rpb24gY2FsbFxuICAgICAgKG5ld0l0ZW1zLCBpdGVtKSA9PiB7XG4gICAgICAgIC8vIGZpcnN0IHdlIGNoZWNrIGlmIHRoZSBwYXJlbnQgaXRlbSB3aWxsIGJlIGFkZGVkIChjaGVja2luZyB0aGlzIGhlcmUgcHJldmVudHMgdW5uZWNlc3NhcnkgbG9vcGluZylcbiAgICAgICAgaWYgKGl0ZW0uc2VhcmNoS2V5ICYmIGl0ZW0uc2VhcmNoS2V5LmluZGV4T2Yoc2VhcmNoVGVybSkgPiAtMSkge1xuICAgICAgICAgIC8vIGZpbHRlciB0aGUgY2hpbGRyZW5cbiAgICAgICAgICAvLyAod2Uga25vdyB0aGVyZSBhcmUgY2hpbGRyZW4gYXMgdGhlIHNlYXJjaGtleSBjb2xsYXRlcyBvbmx5IGNoaWxkIGtleXMpXG4gICAgICAgICAgY29uc3QgcmVkdWNlZENoaWxkcmVuID0gaXRlbS5jaGlsZHJlbi5maWx0ZXIoY2hpbGQgPT4ge1xuICAgICAgICAgICAgcmV0dXJuIGNoaWxkLnNlYXJjaEtleS5pbmRleE9mKHNlYXJjaFRlcm0pID4gLTE7XG4gICAgICAgICAgfSk7XG4gICAgICAgICAgLy8gdGhlcmUgd2lsbCBhbHdheXMgYmUgYXRsZWFzdCBvbmUgY2hpbGQgdGhhdCBtYXRjaGVzXG4gICAgICAgICAgLy8gKGFzIGhhdmUgYWxyZWFkeSB3ZSBjaGVja2VkIHRoZSBjb2xsYXRlZCBzZWFyY2gga2V5KVxuICAgICAgICAgIG5ld0l0ZW1zLnB1c2godGhpcy5jb3B5U2VhcmNoSXRlbShpdGVtLCByZWR1Y2VkQ2hpbGRyZW4pKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gbmV3SXRlbXM7XG4gICAgICB9LFxuICAgICAgW10gLy8gaW5pdGlhbCBlbXB0eSBhcnJheVxuICAgICk7XG4gIH1cbn1cbiJdfQ==