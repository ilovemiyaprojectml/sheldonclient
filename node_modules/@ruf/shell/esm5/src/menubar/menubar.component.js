import * as tslib_1 from "tslib";
import { Input, Output, EventEmitter, Component, ViewEncapsulation, ChangeDetectionStrategy, ElementRef, Renderer2, HostListener, ContentChildren, QueryList, forwardRef } from '@angular/core';
import { RufMenubarItemComponent } from './menubar-item.component';
import { RufKeyboardNavigation } from '../input/keyboard';
import { BehaviorSubject, from, Subject } from 'rxjs';
import { RufMixinBase } from '../common/color/color';
var RufMenubarComponent = /** @class */ (function (_super) {
    tslib_1.__extends(RufMenubarComponent, _super);
    function RufMenubarComponent(_elementRef, _renderer) {
        var _this = _super.call(this, _elementRef) || this;
        _this._elementRef = _elementRef;
        _this._renderer = _renderer;
        _this._selectedPathSubject = new BehaviorSubject(_this._selectedPath);
        _this._selectedPath$ = from(_this._selectedPathSubject);
        _this._activatedPathSubject = new Subject();
        _this._activatedPath$ = from(_this._activatedPathSubject);
        // if true, selecting automatically activates the item
        _this.autoActivate = true;
        _this.direction = 'row';
        /* tslint:disable:no-output-rename */
        // Renaming output to avoid duplicate `select` identifiers
        _this.selectEmitter = new EventEmitter();
        return _this;
    }
    RufMenubarComponent.prototype.ngAfterViewInit = function () {
        var _this = this;
        this.addNewKeyboardNav();
        setTimeout(function () { return _this.addTabIndex(); });
    };
    RufMenubarComponent.prototype.ngAfterContentInit = function () {
        var _this = this;
        this.menuItems.changes.subscribe(function () {
            _this.addNewKeyboardNav();
            if (_this._keyboardNav) {
                _this._keyboardNav.setActiveItemWithoutFocus(_this.selectedIndex(_this.selectedPath));
            }
        });
    };
    RufMenubarComponent.prototype.addNewKeyboardNav = function () {
        var _this = this;
        this._keyboardNav = new RufKeyboardNavigation();
        this._keyboardNav.setDirection(this.direction);
        this._keyboardNav.init(this._elementRef, this.menuItems).subscribe(function (item) { return _this.select(item.path, item.data); });
    };
    RufMenubarComponent.prototype.setActiveItem = function (path) {
        this._keyboardNav.setActiveItemWithoutFocus(this.selectedIndex(path));
        // if path is null, set tabindex to 0 for first menuitem
        if (!path) {
            this.addTabIndex();
        }
    };
    RufMenubarComponent.prototype.firstChild = function () {
        return this.menuItems ? this.menuItems.toArray()[0] : null;
    };
    RufMenubarComponent.prototype.addTabIndex = function () {
        if (this.firstChild()) {
            this.firstChild().tabindex = 0;
        }
    };
    RufMenubarComponent.prototype.selectedIndex = function (path) {
        var index = 0;
        if (path && this.menuItems) {
            index = this.menuItems.toArray().findIndex(function (menuItem) {
                return menuItem.matches(path);
            });
        }
        return index;
    };
    RufMenubarComponent.prototype.select = function (path, data, event) {
        if (!path) {
            this._selectedPath = null;
            return;
        }
        this.selectEmitter.emit({
            path: path,
            data: data,
            event: event
        });
        if (this.autoActivate) {
            this.activate(path);
        }
        this._keyboardNav.focus(path);
        this._activatedPathSubject.next(path);
    };
    RufMenubarComponent.prototype.activate = function (path) {
        this._selectedPath = path;
        this._selectedPathSubject.next(path);
    };
    Object.defineProperty(RufMenubarComponent.prototype, "selectedPath", {
        get: function () {
            return this._selectedPath;
        },
        // Selection of an item is driven by this input if it is used.
        // Otherwise, the select method (which is invoked on click of an item) changes the selectedPath automatically.
        // If this property setter is invoked, it turns off automatic selection.
        // Normally, this should only happen when a selectedPath property binding is used.
        set: function (path) {
            this.autoActivate = false;
            this.activate(path);
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(RufMenubarComponent.prototype, "selectedPath$", {
        get: function () {
            return this._selectedPath$;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(RufMenubarComponent.prototype, "activatedPath$", {
        get: function () {
            return this._activatedPath$;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(RufMenubarComponent.prototype, "inkbarPosition", {
        get: function () {
            return this._inkbarPosition;
        },
        set: function (position) {
            this._updateInkbarPosition(position === 'start' ? position : 'end');
        },
        enumerable: true,
        configurable: true
    });
    RufMenubarComponent.prototype.getLayoutClass = function () {
        return {
            'ruf-menubar-layout': true,
            'ruf-layout-row': this.direction !== 'column',
            'ruf-layout-column': this.direction === 'column',
            'ruf-layout-row-xs': this.directionXs === 'row',
            'ruf-layout-column-xs': this.directionXs === 'column',
            'ruf-layout-row-sm': this.directionSm === 'row',
            'ruf-layout-column-sm': this.directionSm === 'column',
            'ruf-layout-row-md': this.directionMd === 'row',
            'ruf-layout-column-md': this.directionMd === 'column',
            'ruf-layout-row-lg': this.directionLg === 'row',
            'ruf-layout-column-lg': this.directionLg === 'column',
            'ruf-layout-row-xl': this.directionXl === 'row',
            'ruf-layout-column-xl': this.directionXl === 'column',
            'ruf-layout-row-gt-xs': this.directionGtXs === 'row',
            'ruf-layout-column-gt-xs': this.directionGtXs === 'column',
            'ruf-layout-row-gt-sm': this.directionGtSm === 'row',
            'ruf-layout-column-gt-sm': this.directionGtSm === 'column',
            'ruf-layout-row-gt-md': this.directionGtMd === 'row',
            'ruf-layout-column-gt-md': this.directionGtMd === 'column',
            'ruf-layout-row-gt-lg': this.directionGtLg === 'row',
            'ruf-layout-column-gt-lg': this.directionGtLg === 'column',
            'ruf-layout-row-lt-sm': this.directionLtSm === 'row',
            'ruf-layout-column-lt-sm': this.directionLtSm === 'column',
            'ruf-layout-row-lt-md': this.directionLtMd === 'row',
            'ruf-layout-column-lt-md': this.directionLtMd === 'column',
            'ruf-layout-row-lt-lg': this.directionLtLg === 'row',
            'ruf-layout-column-lt-lg': this.directionLtLg === 'column',
            'ruf-layout-row-lt-xl': this.directionLtXl === 'row',
            'ruf-layout-column-lt-xl': this.directionLtXl === 'column'
        };
    };
    RufMenubarComponent.prototype._updateInkbarPosition = function (position) {
        this._renderer.removeClass(this._elementRef.nativeElement, "ruf-menubar-inkbar-" + this._inkbarPosition);
        this._renderer.addClass(this._elementRef.nativeElement, "ruf-menubar-inkbar-" + position);
        this._inkbarPosition = position;
    };
    RufMenubarComponent.prototype.onKey = function (event) {
        if (this._keyboardNav && this._keyboardNav.isActive()) {
            this._keyboardNav.onKeyDown(event);
        }
    };
    tslib_1.__decorate([
        Input('activeColor'),
        tslib_1.__metadata("design:type", Object)
    ], RufMenubarComponent.prototype, "color", void 0);
    tslib_1.__decorate([
        Input(),
        tslib_1.__metadata("design:type", Object)
    ], RufMenubarComponent.prototype, "direction", void 0);
    tslib_1.__decorate([
        Input('direction.xs'),
        tslib_1.__metadata("design:type", Object)
    ], RufMenubarComponent.prototype, "directionXs", void 0);
    tslib_1.__decorate([
        Input('direction.sm'),
        tslib_1.__metadata("design:type", Object)
    ], RufMenubarComponent.prototype, "directionSm", void 0);
    tslib_1.__decorate([
        Input('direction.md'),
        tslib_1.__metadata("design:type", Object)
    ], RufMenubarComponent.prototype, "directionMd", void 0);
    tslib_1.__decorate([
        Input('direction.lg'),
        tslib_1.__metadata("design:type", Object)
    ], RufMenubarComponent.prototype, "directionLg", void 0);
    tslib_1.__decorate([
        Input('direction.xl'),
        tslib_1.__metadata("design:type", Object)
    ], RufMenubarComponent.prototype, "directionXl", void 0);
    tslib_1.__decorate([
        Input('direction.gt-xs'),
        tslib_1.__metadata("design:type", Object)
    ], RufMenubarComponent.prototype, "directionGtXs", void 0);
    tslib_1.__decorate([
        Input('direction.gt-sm'),
        tslib_1.__metadata("design:type", Object)
    ], RufMenubarComponent.prototype, "directionGtSm", void 0);
    tslib_1.__decorate([
        Input('direction.gt-md'),
        tslib_1.__metadata("design:type", Object)
    ], RufMenubarComponent.prototype, "directionGtMd", void 0);
    tslib_1.__decorate([
        Input('direction.gt-lg'),
        tslib_1.__metadata("design:type", Object)
    ], RufMenubarComponent.prototype, "directionGtLg", void 0);
    tslib_1.__decorate([
        Input('direction.lt-sm'),
        tslib_1.__metadata("design:type", Object)
    ], RufMenubarComponent.prototype, "directionLtSm", void 0);
    tslib_1.__decorate([
        Input('direction.lt-md'),
        tslib_1.__metadata("design:type", Object)
    ], RufMenubarComponent.prototype, "directionLtMd", void 0);
    tslib_1.__decorate([
        Input('direction.lt-lg'),
        tslib_1.__metadata("design:type", Object)
    ], RufMenubarComponent.prototype, "directionLtLg", void 0);
    tslib_1.__decorate([
        Input('direction.lt-xl'),
        tslib_1.__metadata("design:type", Object)
    ], RufMenubarComponent.prototype, "directionLtXl", void 0);
    tslib_1.__decorate([
        Output('select'),
        tslib_1.__metadata("design:type", Object)
    ], RufMenubarComponent.prototype, "selectEmitter", void 0);
    tslib_1.__decorate([
        ContentChildren(forwardRef(function () { return RufMenubarItemComponent; })),
        tslib_1.__metadata("design:type", QueryList)
    ], RufMenubarComponent.prototype, "menuItems", void 0);
    tslib_1.__decorate([
        Input(),
        tslib_1.__metadata("design:type", String),
        tslib_1.__metadata("design:paramtypes", [String])
    ], RufMenubarComponent.prototype, "selectedPath", null);
    tslib_1.__decorate([
        Input(),
        tslib_1.__metadata("design:type", String),
        tslib_1.__metadata("design:paramtypes", [String])
    ], RufMenubarComponent.prototype, "inkbarPosition", null);
    tslib_1.__decorate([
        HostListener('keydown', ['$event']),
        tslib_1.__metadata("design:type", Function),
        tslib_1.__metadata("design:paramtypes", [KeyboardEvent]),
        tslib_1.__metadata("design:returntype", void 0)
    ], RufMenubarComponent.prototype, "onKey", null);
    RufMenubarComponent = tslib_1.__decorate([
        Component({
            selector: 'ruf-menubar',
            template: "<div [ngClass]=\"getLayoutClass()\" role=\"menubar\">\n  <ng-content></ng-content>\n</div>\n",
            encapsulation: ViewEncapsulation.None,
            changeDetection: ChangeDetectionStrategy.OnPush,
            styles: ["ruf-menubar{-ms-grid-row-align:stretch;align-self:stretch;display:block}.ruf-menubar-layout{-webkit-box-align:stretch;align-items:stretch;height:100%}.ruf-menu-item{-webkit-box-align:center;align-items:center;border-color:transparent;cursor:pointer;display:-webkit-box;display:flex;-webkit-box-flex:1;flex:1 auto;-webkit-transition:background-color .2s;transition:background-color .2s}.ruf-menu-item:focus{outline:0}.ruf-layout-row{display:-webkit-box;display:flex;-webkit-box-orient:horizontal;-webkit-box-direction:normal;flex-direction:row}.ruf-layout-row>ul{padding-left:0;display:-webkit-box;display:flex;-webkit-box-orient:horizontal;-webkit-box-direction:normal;flex-direction:row;flex-wrap:wrap;width:100%}.ruf-layout-row .ruf-menu-item{border-bottom-width:.125rem;border-top-width:.125rem;-webkit-box-pack:center;justify-content:center;border-style:solid none;padding:.125rem .9375rem}.ruf-menubar-layout.ruf-layout-column{display:-webkit-box;display:flex;-webkit-box-orient:vertical;-webkit-box-direction:normal;flex-direction:column}.ruf-menubar-layout.ruf-layout-column>ul{padding-left:0}.ruf-menubar-layout.ruf-layout-column .ruf-menu-item{border-left-width:.125rem;border-right-width:.125rem;-webkit-box-pack:start;justify-content:flex-start;border-style:none solid;padding:.5rem .9375rem}@media (min-width:0) and (max-width:599px){.ruf-layout-row-xs{display:-webkit-box;display:flex;-webkit-box-orient:horizontal;-webkit-box-direction:normal;flex-direction:row}.ruf-layout-row-xs>ul{padding-left:0;display:-webkit-box;display:flex;-webkit-box-orient:horizontal;-webkit-box-direction:normal;flex-direction:row;flex-wrap:wrap;width:100%}.ruf-layout-row-xs .ruf-menu-item{border-bottom-width:.125rem;border-top-width:.125rem;-webkit-box-pack:center;justify-content:center;border-style:solid none;padding:.125rem .9375rem}.ruf-layout-column-xs{display:-webkit-box;display:flex;-webkit-box-orient:vertical;-webkit-box-direction:normal;flex-direction:column}.ruf-layout-column-xs>ul{padding-left:0}.ruf-layout-column-xs .ruf-menu-item{border-left-width:.125rem;border-right-width:.125rem;-webkit-box-pack:start;justify-content:flex-start;border-style:none solid;padding:.5rem .9375rem}}@media (min-width:600px) and (max-width:959px){.ruf-layout-row-sm{display:-webkit-box;display:flex;-webkit-box-orient:horizontal;-webkit-box-direction:normal;flex-direction:row}.ruf-layout-row-sm>ul{padding-left:0;display:-webkit-box;display:flex;-webkit-box-orient:horizontal;-webkit-box-direction:normal;flex-direction:row;flex-wrap:wrap;width:100%}.ruf-layout-row-sm .ruf-menu-item{border-bottom-width:.125rem;border-top-width:.125rem;-webkit-box-pack:center;justify-content:center;border-style:solid none;padding:.125rem .9375rem}.ruf-layout-column-sm{display:-webkit-box;display:flex;-webkit-box-orient:vertical;-webkit-box-direction:normal;flex-direction:column}.ruf-layout-column-sm>ul{padding-left:0}.ruf-layout-column-sm .ruf-menu-item{border-left-width:.125rem;border-right-width:.125rem;-webkit-box-pack:start;justify-content:flex-start;border-style:none solid;padding:.5rem .9375rem}}@media (min-width:960px) and (max-width:1279px){.ruf-layout-row-md{display:-webkit-box;display:flex;-webkit-box-orient:horizontal;-webkit-box-direction:normal;flex-direction:row}.ruf-layout-row-md>ul{padding-left:0;display:-webkit-box;display:flex;-webkit-box-orient:horizontal;-webkit-box-direction:normal;flex-direction:row;flex-wrap:wrap;width:100%}.ruf-layout-row-md .ruf-menu-item{border-bottom-width:.125rem;border-top-width:.125rem;-webkit-box-pack:center;justify-content:center;border-style:solid none;padding:.125rem .9375rem}.ruf-layout-column-md{display:-webkit-box;display:flex;-webkit-box-orient:vertical;-webkit-box-direction:normal;flex-direction:column}.ruf-layout-column-md>ul{padding-left:0}.ruf-layout-column-md .ruf-menu-item{border-left-width:.125rem;border-right-width:.125rem;-webkit-box-pack:start;justify-content:flex-start;border-style:none solid;padding:.5rem .9375rem}}@media (min-width:1280px) and (max-width:1919px){.ruf-layout-row-lg{display:-webkit-box;display:flex;-webkit-box-orient:horizontal;-webkit-box-direction:normal;flex-direction:row}.ruf-layout-row-lg>ul{padding-left:0;display:-webkit-box;display:flex;-webkit-box-orient:horizontal;-webkit-box-direction:normal;flex-direction:row;flex-wrap:wrap;width:100%}.ruf-layout-row-lg .ruf-menu-item{border-bottom-width:.125rem;border-top-width:.125rem;-webkit-box-pack:center;justify-content:center;border-style:solid none;padding:.125rem .9375rem}.ruf-layout-column-lg{display:-webkit-box;display:flex;-webkit-box-orient:vertical;-webkit-box-direction:normal;flex-direction:column}.ruf-layout-column-lg>ul{padding-left:0}.ruf-layout-column-lg .ruf-menu-item{border-left-width:.125rem;border-right-width:.125rem;-webkit-box-pack:start;justify-content:flex-start;border-style:none solid;padding:.5rem .9375rem}}@media (min-width:1920px){.ruf-layout-row-xl{display:-webkit-box;display:flex;-webkit-box-orient:horizontal;-webkit-box-direction:normal;flex-direction:row}.ruf-layout-row-xl>ul{padding-left:0;display:-webkit-box;display:flex;-webkit-box-orient:horizontal;-webkit-box-direction:normal;flex-direction:row;flex-wrap:wrap;width:100%}.ruf-layout-row-xl .ruf-menu-item{border-bottom-width:.125rem;border-top-width:.125rem;-webkit-box-pack:center;justify-content:center;border-style:solid none;padding:.125rem .9375rem}.ruf-layout-column-xl{display:-webkit-box;display:flex;-webkit-box-orient:vertical;-webkit-box-direction:normal;flex-direction:column}.ruf-layout-column-xl>ul{padding-left:0}.ruf-layout-column-xl .ruf-menu-item{border-left-width:.125rem;border-right-width:.125rem;-webkit-box-pack:start;justify-content:flex-start;border-style:none solid;padding:.5rem .9375rem}}@media (min-width:600px){.ruf-layout-row-gt-xs{display:-webkit-box;display:flex;-webkit-box-orient:horizontal;-webkit-box-direction:normal;flex-direction:row}.ruf-layout-row-gt-xs>ul{padding-left:0;display:-webkit-box;display:flex;-webkit-box-orient:horizontal;-webkit-box-direction:normal;flex-direction:row;flex-wrap:wrap;width:100%}.ruf-layout-row-gt-xs .ruf-menu-item{border-bottom-width:.125rem;border-top-width:.125rem;-webkit-box-pack:center;justify-content:center;border-style:solid none;padding:.125rem .9375rem}.ruf-layout-column-gt-xs{display:-webkit-box;display:flex;-webkit-box-orient:vertical;-webkit-box-direction:normal;flex-direction:column}.ruf-layout-column-gt-xs>ul{padding-left:0}.ruf-layout-column-gt-xs .ruf-menu-item{border-left-width:.125rem;border-right-width:.125rem;-webkit-box-pack:start;justify-content:flex-start;border-style:none solid;padding:.5rem .9375rem}}@media (min-width:960px){.ruf-layout-row-gt-sm{display:-webkit-box;display:flex;-webkit-box-orient:horizontal;-webkit-box-direction:normal;flex-direction:row}.ruf-layout-row-gt-sm>ul{padding-left:0;display:-webkit-box;display:flex;-webkit-box-orient:horizontal;-webkit-box-direction:normal;flex-direction:row;flex-wrap:wrap;width:100%}.ruf-layout-row-gt-sm .ruf-menu-item{border-bottom-width:.125rem;border-top-width:.125rem;-webkit-box-pack:center;justify-content:center;border-style:solid none;padding:.125rem .9375rem}.ruf-layout-column-gt-sm{display:-webkit-box;display:flex;-webkit-box-orient:vertical;-webkit-box-direction:normal;flex-direction:column}.ruf-layout-column-gt-sm>ul{padding-left:0}.ruf-layout-column-gt-sm .ruf-menu-item{border-left-width:.125rem;border-right-width:.125rem;-webkit-box-pack:start;justify-content:flex-start;border-style:none solid;padding:.5rem .9375rem}}@media (min-width:1280px){.ruf-layout-row-gt-md{display:-webkit-box;display:flex;-webkit-box-orient:horizontal;-webkit-box-direction:normal;flex-direction:row}.ruf-layout-row-gt-md>ul{padding-left:0;display:-webkit-box;display:flex;-webkit-box-orient:horizontal;-webkit-box-direction:normal;flex-direction:row;flex-wrap:wrap;width:100%}.ruf-layout-row-gt-md .ruf-menu-item{border-bottom-width:.125rem;border-top-width:.125rem;-webkit-box-pack:center;justify-content:center;border-style:solid none;padding:.125rem .9375rem}.ruf-layout-column-gt-md{display:-webkit-box;display:flex;-webkit-box-orient:vertical;-webkit-box-direction:normal;flex-direction:column}.ruf-layout-column-gt-md>ul{padding-left:0}.ruf-layout-column-gt-md .ruf-menu-item{border-left-width:.125rem;border-right-width:.125rem;-webkit-box-pack:start;justify-content:flex-start;border-style:none solid;padding:.5rem .9375rem}}@media (min-width:1920px){.ruf-layout-row-gt-lg{display:-webkit-box;display:flex;-webkit-box-orient:horizontal;-webkit-box-direction:normal;flex-direction:row}.ruf-layout-row-gt-lg>ul{padding-left:0;display:-webkit-box;display:flex;-webkit-box-orient:horizontal;-webkit-box-direction:normal;flex-direction:row;flex-wrap:wrap;width:100%}.ruf-layout-row-gt-lg .ruf-menu-item{border-bottom-width:.125rem;border-top-width:.125rem;-webkit-box-pack:center;justify-content:center;border-style:solid none;padding:.125rem .9375rem}.ruf-layout-column-gt-lg{display:-webkit-box;display:flex;-webkit-box-orient:vertical;-webkit-box-direction:normal;flex-direction:column}.ruf-layout-column-gt-lg>ul{padding-left:0}.ruf-layout-column-gt-lg .ruf-menu-item{border-left-width:.125rem;border-right-width:.125rem;-webkit-box-pack:start;justify-content:flex-start;border-style:none solid;padding:.5rem .9375rem}}"]
        }),
        tslib_1.__metadata("design:paramtypes", [ElementRef, Renderer2])
    ], RufMenubarComponent);
    return RufMenubarComponent;
}(RufMixinBase));
export { RufMenubarComponent };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibWVudWJhci5jb21wb25lbnQuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9AcnVmL3NoZWxsLyIsInNvdXJjZXMiOlsic3JjL21lbnViYXIvbWVudWJhci5jb21wb25lbnQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IjtBQUFBLE9BQU8sRUFDTCxLQUFLLEVBQ0wsTUFBTSxFQUNOLFlBQVksRUFDWixTQUFTLEVBQ1QsaUJBQWlCLEVBQ2pCLHVCQUF1QixFQUV2QixVQUFVLEVBQ1YsU0FBUyxFQUNULFlBQVksRUFHWixlQUFlLEVBQ2YsU0FBUyxFQUNULFVBQVUsRUFDWCxNQUFNLGVBQWUsQ0FBQztBQUV2QixPQUFPLEVBQWlCLHVCQUF1QixFQUFDLE1BQU0sMEJBQTBCLENBQUM7QUFDakYsT0FBTyxFQUFDLHFCQUFxQixFQUFDLE1BQU0sbUJBQW1CLENBQUM7QUFDeEQsT0FBTyxFQUFDLGVBQWUsRUFBRSxJQUFJLEVBQWMsT0FBTyxFQUFDLE1BQU0sTUFBTSxDQUFDO0FBRWhFLE9BQU8sRUFBRSxZQUFZLEVBQWUsTUFBTSx1QkFBdUIsQ0FBQztBQVNsRTtJQUF5QywrQ0FBWTtJQStDbkQsNkJBQW1CLFdBQXVCLEVBQVksU0FBb0I7UUFBMUUsWUFDRSxrQkFBTSxXQUFXLENBQUMsU0FDbkI7UUFGa0IsaUJBQVcsR0FBWCxXQUFXLENBQVk7UUFBWSxlQUFTLEdBQVQsU0FBUyxDQUFXO1FBM0NsRSwwQkFBb0IsR0FBb0IsSUFBSSxlQUFlLENBQUMsS0FBSSxDQUFDLGFBQWEsQ0FBQyxDQUFDO1FBQ2hGLG9CQUFjLEdBQXVCLElBQUksQ0FBQyxLQUFJLENBQUMsb0JBQW9CLENBQUMsQ0FBQztRQUVyRSwyQkFBcUIsR0FBb0IsSUFBSSxPQUFPLEVBQUUsQ0FBQztRQUN2RCxxQkFBZSxHQUF1QixJQUFJLENBQUMsS0FBSSxDQUFDLHFCQUFxQixDQUFDLENBQUM7UUFLL0Usc0RBQXNEO1FBQzlDLGtCQUFZLEdBQUcsSUFBSSxDQUFDO1FBT25CLGVBQVMsR0FBRyxLQUFL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WUFBWSxHQXlNcEQ7U0F6TVksbUJBQW1CIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHtcbiAgSW5wdXQsXG4gIE91dHB1dCxcbiAgRXZlbnRFbWl0dGVyLFxuICBDb21wb25lbnQsXG4gIFZpZXdFbmNhcHN1bGF0aW9uLFxuICBDaGFuZ2VEZXRlY3Rpb25TdHJhdGVneSxcbiAgSG9zdEJpbmRpbmcsXG4gIEVsZW1lbnRSZWYsXG4gIFJlbmRlcmVyMixcbiAgSG9zdExpc3RlbmVyLFxuICBBZnRlclZpZXdJbml0LFxuICBBZnRlckNvbnRlbnRJbml0LFxuICBDb250ZW50Q2hpbGRyZW4sXG4gIFF1ZXJ5TGlzdCxcbiAgZm9yd2FyZFJlZlxufSBmcm9tICdAYW5ndWxhci9jb3JlJztcblxuaW1wb3J0IHtSdWZNZW51YmFySXRlbSwgUnVmTWVudWJhckl0ZW1Db21wb25lbnR9IGZyb20gJy4vbWVudWJhci1pdGVtLmNvbXBvbmVudCc7XG5pbXBvcnQge1J1ZktleWJvYXJkTmF2aWdhdGlvbn0gZnJvbSAnLi4vaW5wdXQva2V5Ym9hcmQnO1xuaW1wb3J0IHtCZWhhdmlvclN1YmplY3QsIGZyb20sIE9ic2VydmFibGUsIFN1YmplY3R9IGZyb20gJ3J4anMnO1xuXG5pbXBvcnQgeyBSdWZNaXhpbkJhc2UsIFJ1ZkNhbkNvbG9yIH0gZnJvbSAnLi4vY29tbW9uL2NvbG9yL2NvbG9yJztcblxuQENvbXBvbmVudCh7XG4gIHNlbGVjdG9yOiAncnVmLW1lbnViYXInLFxuICB0ZW1wbGF0ZVVybDogJy4vbWVudWJhci5jb21wb25lbnQuaHRtbCcsXG4gIHN0eWxlVXJsczogWycuL21lbnViYXIuY29tcG9uZW50LnNjc3MnXSxcbiAgZW5jYXBzdWxhdGlvbjogVmlld0VuY2Fwc3VsYXRpb24uTm9uZSxcbiAgY2hhbmdlRGV0ZWN0aW9uOiBDaGFuZ2VEZXRlY3Rpb25TdHJhdGVneS5PblB1c2hcbn0pXG5leHBvcnQgY2xhc3MgUnVmTWVudWJhckNvbXBvbmVudCBleHRlbmRzIFJ1Zk1peGluQmFzZSBpbXBsZW1lbnRzIEFmdGVyVmlld0luaXQsIEFmdGVyQ29udGVudEluaXQsIFJ1ZkNhbkNvbG9yIHtcblxuICAvLyBkZWZpbmVzIHdoaWNoIGl0ZW0gaXMgc2VsZWN0ZWRcbiAgcHJpdmF0ZSBfc2VsZWN0ZWRQYXRoOiBzdHJpbmc7XG4gIHByaXZhdGUgX3NlbGVjdGVkUGF0aFN1YmplY3Q6IFN1YmplY3Q8c3RyaW5nPiA9IG5ldyBCZWhhdmlvclN1YmplY3QodGhpcy5fc2VsZWN0ZWRQYXRoKTtcbiAgcHJpdmF0ZSBfc2VsZWN0ZWRQYXRoJDogT2JzZXJ2YWJsZTxzdHJpbmc+ID0gZnJvbSh0aGlzLl9zZWxlY3RlZFBhdGhTdWJqZWN0KTtcblxuICBwcml2YXRlIF9hY3RpdmF0ZWRQYXRoU3ViamVjdDogU3ViamVjdDxzdHJpbmc+ID0gbmV3IFN1YmplY3QoKTtcbiAgcHJpdmF0ZSBfYWN0aXZhdGVkUGF0aCQ6IE9ic2VydmFibGU8c3RyaW5nPiA9IGZyb20odGhpcy5fYWN0aXZhdGVkUGF0aFN1YmplY3QpO1xuXG4gIC8vIGRlZmluZXMgdGhlIHBvc2l0aW9uIG9mIHRoZSBpbmtiYXIgcmVsYXRpdmUgdG8gdGhlIGRpcmVjdGlvbiBvZiB0aGUgbWVudWJhclxuICBwcml2YXRlIF9pbmtiYXJQb3NpdGlvbjogc3RyaW5nO1xuXG4gIC8vIGlmIHRydWUsIHNlbGVjdGluZyBhdXRvbWF0aWNhbGx5IGFjdGl2YXRlcyB0aGUgaXRlbVxuICBwcml2YXRlIGF1dG9BY3RpdmF0ZSA9IHRydWU7XG5cbiAgcHJpdmF0ZSBfa2V5Ym9hcmROYXY6IFJ1ZktleWJvYXJkTmF2aWdhdGlvbjtcblxuICAvKiB0c2xpbnQ6ZGlzYWJsZTpuby1pbnB1dC1yZW5hbWUgKi9cbiAgQElucHV0KCdhY3RpdmVDb2xvcicpIGNvbG9yO1xuXG4gIEBJbnB1dCgpIGRpcmVjdGlvbiA9ICdyb3cnO1xuXG4gIC8qIHRzbGludDpkaXNhYmxlOm5vLWlucHV0LXJlbmFtZSAqL1xuICBASW5wdXQoJ2RpcmVjdGlvbi54cycpIGRpcmVjdGlvblhzO1xuICBASW5wdXQoJ2RpcmVjdGlvbi5zbScpIGRpcmVjdGlvblNtO1xuICBASW5wdXQoJ2RpcmVjdGlvbi5tZCcpIGRpcmVjdGlvbk1kO1xuICBASW5wdXQoJ2RpcmVjdGlvbi5sZycpIGRpcmVjdGlvbkxnO1xuICBASW5wdXQoJ2RpcmVjdGlvbi54bCcpIGRpcmVjdGlvblhsO1xuXG4gIEBJbnB1dCgnZGlyZWN0aW9uLmd0LXhzJykgZGlyZWN0aW9uR3RYcztcbiAgQElucHV0KCdkaXJlY3Rpb24uZ3Qtc20nKSBkaXJlY3Rpb25HdFNtO1xuICBASW5wdXQoJ2RpcmVjdGlvbi5ndC1tZCcpIGRpcmVjdGlvbkd0TWQ7XG4gIEBJbnB1dCgnZGlyZWN0aW9uLmd0LWxnJykgZGlyZWN0aW9uR3RMZztcblxuICBASW5wdXQoJ2RpcmVjdGlvbi5sdC1zbScpIGRpcmVjdGlvbkx0U207XG4gIEBJbnB1dCgnZGlyZWN0aW9uLmx0LW1kJykgZGlyZWN0aW9uTHRNZDtcbiAgQElucHV0KCdkaXJlY3Rpb24ubHQtbGcnKSBkaXJlY3Rpb25MdExnO1xuICBASW5wdXQoJ2RpcmVjdGlvbi5sdC14bCcpIGRpcmVjdGlvbkx0WGw7XG5cbiAgLyogdHNsaW50OmRpc2FibGU6bm8tb3V0cHV0LXJlbmFtZSAqL1xuICAvLyBSZW5hbWluZyBvdXRwdXQgdG8gYXZvaWQgZHVwbGljYXRlIGBzZWxlY3RgIGlkZW50aWZpZXJzXG4gIEBPdXRwdXQoJ3NlbGVjdCcpIHNlbGVjdEVtaXR0ZXIgPSBuZXcgRXZlbnRFbWl0dGVyPFJ1Zk1lbnViYXJJdGVtPigpO1xuXG4gIEBDb250ZW50Q2hpbGRyZW4oZm9yd2FyZFJlZigoKSA9PiBSdWZNZW51YmFySXRlbUNvbXBvbmVudCkpXG4gIG1lbnVJdGVtczogUXVlcnlMaXN0PFJ1Zk1lbnViYXJJdGVtQ29tcG9uZW50PjtcblxuICBjb25zdHJ1Y3RvcihwdWJsaWMgX2VsZW1lbnRSZWY6IEVsZW1lbnRSZWYsIHByb3RlY3RlZCBfcmVuZGVyZXI6IFJlbmRlcmVyMikge1xuICAgIHN1cGVyKF9lbGVtZW50UmVmKTtcbiAgfVxuXG4gIG5nQWZ0ZXJWaWV3SW5pdCgpIHtcbiAgICB0aGlzLmFkZE5ld0tleWJvYXJkTmF2KCk7XG4gICAgc2V0VGltZW91dCgoKSA9PiB0aGlzLmFkZFRhYkluZGV4KCkpO1xuICB9XG5cbiAgbmdBZnRlckNvbnRlbnRJbml0KCkge1xuICAgIHRoaXMubWVudUl0ZW1zLmNoYW5nZXMuc3Vic2NyaWJlKCgpID0+IHtcbiAgICAgIHRoaXMuYWRkTmV3S2V5Ym9hcmROYXYoKTtcbiAgICAgIGlmICh0aGlzLl9rZXlib2FyZE5hdikge1xuICAgICAgICB0aGlzLl9rZXlib2FyZE5hdi5zZXRBY3RpdmVJdGVtV2l0aG91dEZvY3VzKHRoaXMuc2VsZWN0ZWRJbmRleCh0aGlzLnNlbGVjdGVkUGF0aCkpO1xuICAgICAgfVxuICAgIH0pO1xuICB9XG5cbiAgYWRkTmV3S2V5Ym9hcmROYXYoKSB7XG4gICAgdGhpcy5fa2V5Ym9hcmROYXYgPSBuZXcgUnVmS2V5Ym9hcmROYXZpZ2F0aW9uKCk7XG4gICAgdGhpcy5fa2V5Ym9hcmROYXYuc2V0RGlyZWN0aW9uKHRoaXMuZGlyZWN0aW9uKTtcbiAgICB0aGlzLl9rZXlib2FyZE5hdi5pbml0KHRoaXMuX2VsZW1lbnRSZWYsIHRoaXMubWVudUl0ZW1zKS5zdWJzY3JpYmUoaXRlbSA9PiB0aGlzLnNlbGVjdChpdGVtLnBhdGgsIGl0ZW0uZGF0YSkpO1xuICB9XG5cbiAgc2V0QWN0aXZlSXRlbShwYXRoOiBzdHJpbmcpIHtcbiAgICB0aGlzLl9rZXlib2FyZE5hdi5zZXRBY3RpdmVJdGVtV2l0aG91dEZvY3VzKHRoaXMuc2VsZWN0ZWRJbmRleChwYXRoKSk7XG4gICAgLy8gaWYgcGF0aCBpcyBudWxsLCBzZXQgdGFiaW5kZXggdG8gMCBmb3IgZmlyc3QgbWVudWl0ZW1cbiAgICBpZiAoIXBhdGgpIHtcbiAgICAgIHRoaXMuYWRkVGFiSW5kZXgoKTtcbiAgICB9XG4gIH1cblxuICBmaXJzdENoaWxkKCk6IFJ1Zk1lbnViYXJJdGVtQ29tcG9uZW50IHtcbiAgICByZXR1cm4gdGhpcy5tZW51SXRlbXMgPyB0aGlzLm1lbnVJdGVtcy50b0FycmF5KClbMF0gOiBudWxsO1xuICB9XG5cbiAgYWRkVGFiSW5kZXgoKSB7XG4gICAgaWYgKHRoaXMuZmlyc3RDaGlsZCgpKSB7XG4gICAgICB0aGlzLmZpcnN0Q2hpbGQoKS50YWJpbmRleCA9IDA7XG4gICAgfVxuICB9XG5cbiAgc2VsZWN0ZWRJbmRleChwYXRoOiBzdHJpbmcpOiBudW1iZXIge1xuICAgIGxldCBpbmRleCA9IDA7XG4gICAgaWYgKHBhdGggJiYgdGhpcy5tZW51SXRlbXMpIHtcbiAgICAgIGluZGV4ID0gdGhpcy5tZW51SXRlbXMudG9BcnJheSgpLmZpbmRJbmRleChtZW51SXRlbSA9PiB7XG4gICAgICAgIHJldHVybiBtZW51SXRlbS5tYXRjaGVzKHBhdGgpO1xuICAgICAgfSk7XG4gICAgfVxuICAgIHJldHVybiBpbmRleDtcbiAgfVxuXG4gIHNlbGVjdChwYXRoPzogc3RyaW5nLCBkYXRhPzogYW55LCBldmVudD86IGFueSkge1xuICAgIGlmICghcGF0aCkge1xuICAgICAgdGhpcy5fc2VsZWN0ZWRQYXRoID0gbnVsbDtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICB0aGlzLnNlbGVjdEVtaXR0ZXIuZW1pdCh7XG4gICAgICBwYXRoOiBwYXRoLFxuICAgICAgZGF0YTogZGF0YSxcbiAgICAgIGV2ZW50OiBldmVudFxuICAgIH0pO1xuXG4gICAgaWYgKHRoaXMuYXV0b0FjdGl2YXRlKSB7XG4gICAgICB0aGlzLmFjdGl2YXRlKHBhdGgpO1xuICAgIH1cblxuICAgIHRoaXMuX2tleWJvYXJkTmF2LmZvY3VzKHBhdGgpO1xuICAgIHRoaXMuX2FjdGl2YXRlZFBhdGhTdWJqZWN0Lm5leHQocGF0aCk7XG4gIH1cblxuICBhY3RpdmF0ZShwYXRoOiBzdHJpbmcpIHtcbiAgICB0aGlzLl9zZWxlY3RlZFBhdGggPSBwYXRoO1xuICAgIHRoaXMuX3NlbGVjdGVkUGF0aFN1YmplY3QubmV4dChwYXRoKTtcbiAgfVxuXG4gIC8vIFNlbGVjdGlvbiBvZiBhbiBpdGVtIGlzIGRyaXZlbiBieSB0aGlzIGlucHV0IGlmIGl0IGlzIHVzZWQuXG4gIC8vIE90aGVyd2lzZSwgdGhlIHNlbGVjdCBtZXRob2QgKHdoaWNoIGlzIGludm9rZWQgb24gY2xpY2sgb2YgYW4gaXRlbSkgY2hhbmdlcyB0aGUgc2VsZWN0ZWRQYXRoIGF1dG9tYXRpY2FsbHkuXG4gIC8vIElmIHRoaXMgcHJvcGVydHkgc2V0dGVyIGlzIGludm9rZWQsIGl0IHR1cm5zIG9mZiBhdXRvbWF0aWMgc2VsZWN0aW9uLlxuICAvLyBOb3JtYWxseSwgdGhpcyBzaG91bGQgb25seSBoYXBwZW4gd2hlbiBhIHNlbGVjdGVkUGF0aCBwcm9wZXJ0eSBiaW5kaW5nIGlzIHVzZWQuXG4gIEBJbnB1dCgpXG4gIHNldCBzZWxlY3RlZFBhdGgocGF0aDogc3RyaW5nKSB7XG4gICAgdGhpcy5hdXRvQWN0aXZhdGUgPSBmYWxzZTtcbiAgICB0aGlzLmFjdGl2YXRlKHBhdGgpO1xuICB9XG5cbiAgZ2V0IHNlbGVjdGVkUGF0aCgpIHtcbiAgICByZXR1cm4gdGhpcy5fc2VsZWN0ZWRQYXRoO1xuICB9XG5cbiAgZ2V0IHNlbGVjdGVkUGF0aCQoKSB7XG4gICAgcmV0dXJuIHRoaXMuX3NlbGVjdGVkUGF0aCQ7XG4gIH1cblxuICBnZXQgYWN0aXZhdGVkUGF0aCQoKSB7XG4gICAgcmV0dXJuIHRoaXMuX2FjdGl2YXRlZFBhdGgkO1xuICB9XG5cbiAgQElucHV0KClcbiAgc2V0IGlua2JhclBvc2l0aW9uKHBvc2l0aW9uOiBzdHJpbmcpIHtcbiAgICB0aGlzLl91cGRhdGVJbmtiYXJQb3NpdGlvbihwb3NpdGlvbiA9PT0gJ3N0YXJ0JyA/IHBvc2l0aW9uIDogJ2VuZCcpO1xuICB9XG5cbiAgZ2V0IGlua2JhclBvc2l0aW9uKCkge1xuICAgIHJldHVybiB0aGlzLl9pbmtiYXJQb3NpdGlvbjtcbiAgfVxuXG4gIGdldExheW91dENsYXNzKCkge1xuICAgIHJldHVybiB7XG4gICAgICAncnVmLW1lbnViYXItbGF5b3V0JzogdHJ1ZSxcbiAgICAgICdydWYtbGF5b3V0LXJvdyc6IHRoaXMuZGlyZWN0aW9uICE9PSAnY29sdW1uJyxcbiAgICAgICdydWYtbGF5b3V0LWNvbHVtbic6IHRoaXMuZGlyZWN0aW9uID09PSAnY29sdW1uJyxcbiAgICAgICdydWYtbGF5b3V0LXJvdy14cyc6IHRoaXMuZGlyZWN0aW9uWHMgPT09ICdyb3cnLFxuICAgICAgJ3J1Zi1sYXlvdXQtY29sdW1uLXhzJzogdGhpcy5kaXJlY3Rpb25YcyA9PT0gJ2NvbHVtbicsXG4gICAgICAncnVmLWxheW91dC1yb3ctc20nOiB0aGlzLmRpcmVjdGlvblNtID09PSAncm93JyxcbiAgICAgICdydWYtbGF5b3V0LWNvbHVtbi1zbSc6IHRoaXMuZGlyZWN0aW9uU20gPT09ICdjb2x1bW4nLFxuICAgICAgJ3J1Zi1sYXlvdXQtcm93LW1kJzogdGhpcy5kaXJlY3Rpb25NZCA9PT0gJ3JvdycsXG4gICAgICAncnVmLWxheW91dC1jb2x1bW4tbWQnOiB0aGlzLmRpcmVjdGlvbk1kID09PSAnY29sdW1uJyxcbiAgICAgICdydWYtbGF5b3V0LXJvdy1sZyc6IHRoaXMuZGlyZWN0aW9uTGcgPT09ICdyb3cnLFxuICAgICAgJ3J1Zi1sYXlvdXQtY29sdW1uLWxnJzogdGhpcy5kaXJlY3Rpb25MZyA9PT0gJ2NvbHVtbicsXG4gICAgICAncnVmLWxheW91dC1yb3cteGwnOiB0aGlzLmRpcmVjdGlvblhsID09PSAncm93JyxcbiAgICAgICdydWYtbGF5b3V0LWNvbHVtbi14bCc6IHRoaXMuZGlyZWN0aW9uWGwgPT09ICdjb2x1bW4nLFxuICAgICAgJ3J1Zi1sYXlvdXQtcm93LWd0LXhzJzogdGhpcy5kaXJlY3Rpb25HdFhzID09PSAncm93JyxcbiAgICAgICdydWYtbGF5b3V0LWNvbHVtbi1ndC14cyc6IHRoaXMuZGlyZWN0aW9uR3RYcyA9PT0gJ2NvbHVtbicsXG4gICAgICAncnVmLWxheW91dC1yb3ctZ3Qtc20nOiB0aGlzLmRpcmVjdGlvbkd0U20gPT09ICdyb3cnLFxuICAgICAgJ3J1Zi1sYXlvdXQtY29sdW1uLWd0LXNtJzogdGhpcy5kaXJlY3Rpb25HdFNtID09PSAnY29sdW1uJyxcbiAgICAgICdydWYtbGF5b3V0LXJvdy1ndC1tZCc6IHRoaXMuZGlyZWN0aW9uR3RNZCA9PT0gJ3JvdycsXG4gICAgICAncnVmLWxheW91dC1jb2x1bW4tZ3QtbWQnOiB0aGlzLmRpcmVjdGlvbkd0TWQgPT09ICdjb2x1bW4nLFxuICAgICAgJ3J1Zi1sYXlvdXQtcm93LWd0LWxnJzogdGhpcy5kaXJlY3Rpb25HdExnID09PSAncm93JyxcbiAgICAgICdydWYtbGF5b3V0LWNvbHVtbi1ndC1sZyc6IHRoaXMuZGlyZWN0aW9uR3RMZyA9PT0gJ2NvbHVtbicsXG4gICAgICAncnVmLWxheW91dC1yb3ctbHQtc20nOiB0aGlzLmRpcmVjdGlvbkx0U20gPT09ICdyb3cnLFxuICAgICAgJ3J1Zi1sYXlvdXQtY29sdW1uLWx0LXNtJzogdGhpcy5kaXJlY3Rpb25MdFNtID09PSAnY29sdW1uJyxcbiAgICAgICdydWYtbGF5b3V0LXJvdy1sdC1tZCc6IHRoaXMuZGlyZWN0aW9uTHRNZCA9PT0gJ3JvdycsXG4gICAgICAncnVmLWxheW91dC1jb2x1bW4tbHQtbWQnOiB0aGlzLmRpcmVjdGlvbkx0TWQgPT09ICdjb2x1bW4nLFxuICAgICAgJ3J1Zi1sYXlvdXQtcm93LWx0LWxnJzogdGhpcy5kaXJlY3Rpb25MdExnID09PSAncm93JyxcbiAgICAgICdydWYtbGF5b3V0LWNvbHVtbi1sdC1sZyc6IHRoaXMuZGlyZWN0aW9uTHRMZyA9PT0gJ2NvbHVtbicsXG4gICAgICAncnVmLWxheW91dC1yb3ctbHQteGwnOiB0aGlzLmRpcmVjdGlvbkx0WGwgPT09ICdyb3cnLFxuICAgICAgJ3J1Zi1sYXlvdXQtY29sdW1uLWx0LXhsJzogdGhpcy5kaXJlY3Rpb25MdFhsID09PSAnY29sdW1uJ1xuICAgIH1cbiAgfVxuXG4gIHByaXZhdGUgX3VwZGF0ZUlua2JhclBvc2l0aW9uKHBvc2l0aW9uOiBzdHJpbmcpIHtcbiAgICB0aGlzLl9yZW5kZXJlci5yZW1vdmVDbGFzcyh0aGlzLl9lbGVtZW50UmVmLm5hdGl2ZUVsZW1lbnQsIGBydWYtbWVudWJhci1pbmtiYXItJHt0aGlzLl9pbmtiYXJQb3NpdGlvbn1gKTtcbiAgICB0aGlzLl9yZW5kZXJlci5hZGRDbGFzcyh0aGlzLl9lbGVtZW50UmVmLm5hdGl2ZUVsZW1lbnQsIGBydWYtbWVudWJhci1pbmtiYXItJHtwb3NpdGlvbn1gKTtcbiAgICB0aGlzLl9pbmtiYXJQb3NpdGlvbiA9IHBvc2l0aW9uO1xuICB9XG5cbiAgQEhvc3RMaXN0ZW5lcigna2V5ZG93bicsIFsnJGV2ZW50J10pXG4gIG9uS2V5KGV2ZW50OiBLZXlib2FyZEV2ZW50KSB7XG4gICAgaWYgKHRoaXMuX2tleWJvYXJkTmF2ICYmIHRoaXMuX2tleWJvYXJkTmF2LmlzQWN0aXZlKCkpIHtcbiAgICAgIHRoaXMuX2tleWJvYXJkTmF2Lm9uS2V5RG93bihldmVudCk7XG4gICAgfVxuICB9XG59XG4iXX0=