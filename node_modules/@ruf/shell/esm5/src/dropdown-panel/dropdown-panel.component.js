import * as tslib_1 from "tslib";
import { Component, EventEmitter, HostListener, TemplateRef, ViewEncapsulation, Input, Output, ViewChild, ViewContainerRef } from '@angular/core';
import { TemplatePortal } from '@angular/cdk/portal';
import { ENTER, SPACE, ESCAPE } from '@angular/cdk/keycodes';
import { Overlay, CdkOverlayOrigin } from '@angular/cdk/overlay';
export var RufDropdownType;
(function (RufDropdownType) {
    RufDropdownType["PopoverMenu"] = "popover-menu";
    RufDropdownType["ContextMenu"] = "context-menu";
    RufDropdownType["Dropdown"] = "dropdown";
})(RufDropdownType || (RufDropdownType = {}));
;
var RufDropdownPanelComponent = /** @class */ (function () {
    function RufDropdownPanelComponent(_overlay, _viewContainerRef) {
        this._overlay = _overlay;
        this._viewContainerRef = _viewContainerRef;
        this.hasBackdrop = true;
        this.openedChange = new EventEmitter();
        this.type = RufDropdownType.Dropdown;
        this.xPosition = 'center';
        this.yPosition = 'bottom';
        this.className = 'ruf-dropdown-panel-container';
        this.toggle = new EventEmitter();
    }
    RufDropdownPanelComponent.prototype.ngOnChanges = function (changes) {
        if (changes &&
            changes.hasBackdrop &&
            changes.hasBackdrop.previousValue !== changes.hasBackdrop.currentValue) {
            // when value is changes for hasBackdrop set value null for overlay
            // so that it will create new overlay with updated backdrop value
            if (this._overlayRef) {
                this._overlayRef.detach();
                this._overlayRef = null;
            }
        }
    };
    RufDropdownPanelComponent.prototype.open = function () {
        var _this = this;
        var origin = this._getOrigin();
        var overlay = this._getOverlayPosition();
        if (!this._overlayRef) {
            var positionStrategy = void 0;
            positionStrategy = this._overlay.position()
                .flexibleConnectedTo(this.origin.elementRef)
                .withPositions([
                tslib_1.__assign({}, origin.main, overlay.main),
                tslib_1.__assign({}, origin.fallback, overlay.fallback)
            ]);
            this.onPositionChanged({
                connectionPair: {
                    overlayX: overlay.main.overlayX,
                    overlayY: overlay.main.overlayY
                }
            });
            positionStrategy.positionChanges.subscribe(function (change) {
                _this.onPositionChanged(change);
            });
            this._overlayRef = this._overlay.create({
                hasBackdrop: this.hasBackdrop,
                backdropClass: 'ruf-dropdown-panel-wrapper',
                positionStrategy: positionStrategy
            });
            this._overlayRef.backdropClick().subscribe(function () { return _this.close(); });
            this._portal = new TemplatePortal(this.content, this._viewContainerRef);
        }
        if (!this._overlayRef.hasAttached()) {
            this._overlayRef.attach(this._portal);
            this.opened = true;
            this.toggle.emit(true);
        }
        else {
            this.close();
            this.toggle.emit(false);
        }
    };
    ;
    RufDropdownPanelComponent.prototype._getOrigin = function () {
        var originPosition;
        originPosition = this._getPositionStrategy(this._getOriginValues(), this._getOverlayPositionValues()).originPosition;
        var _a = this._invertPosition(originPosition.originX, originPosition.originY), x = _a.x, y = _a.y;
        if (this.type === RufDropdownType.PopoverMenu || this.type === RufDropdownType.ContextMenu) {
            return {
                main: originPosition,
                fallback: { originX: x, originY: y }
            };
        }
        else {
            return {
                main: { originX: 'start', originY: 'bottom' },
                fallback: { originX: 'end', originY: 'top' }
            };
        }
    };
    RufDropdownPanelComponent.prototype._getOverlayPosition = function () {
        var XPosition = this.xPosition;
        var YPosition = this.yPosition;
        var overlayPosition;
        overlayPosition = this._getPositionStrategy(this._getOriginValues(), this._getOverlayPositionValues()).overlayPosition;
        var _a = this._invertPosition(overlayPosition.overlayX, overlayPosition.overlayY), x = _a.x, y = _a.y;
        if (this.type === RufDropdownType.PopoverMenu || this.type === RufDropdownType.ContextMenu) {
            return {
                main: overlayPosition,
                fallback: { overlayX: x, overlayY: y }
            };
        }
        else {
            return {
                main: { overlayX: 'start', overlayY: 'top' },
                fallback: { overlayX: 'end', overlayY: 'bottom' }
            };
        }
    };
    RufDropdownPanelComponent.prototype._getOriginValues = function () {
        var xCenterYBottom = { originX: 'center', originY: 'bottom' };
        var xCenterYTop = { originX: 'center', originY: 'top' };
        var xStartYBottom = { originX: 'start', originY: 'bottom' };
        var xStartYTop = { originX: 'start', originY: 'top' };
        var xStartYCenter = { originX: 'start', originY: 'center' };
        var xEndYBottom = { originX: 'end', originY: 'bottom' };
        var xEndYTop = { originX: 'end', originY: 'top' };
        var xEndYCenter = { originX: 'end', originY: 'center' };
        return {
            xCenterYBottom: xCenterYBottom,
            xCenterYTop: xCenterYTop,
            xStartYBottom: xStartYBottom,
            xStartYTop: xStartYTop,
            xStartYCenter: xStartYCenter,
            xEndYBottom: xEndYBottom,
            xEndYTop: xEndYTop,
            xEndYCenter: xEndYCenter
        };
    };
    RufDropdownPanelComponent.prototype._getOverlayPositionValues = function () {
        var xCenterYTop = { overlayX: 'center', overlayY: 'top' };
        var xCenterYBottom = { overlayX: 'center', overlayY: 'bottom' };
        var xStartYTop = { overlayX: 'start', overlayY: 'top' };
        var xStartYBottom = { overlayX: 'start', overlayY: 'bottom' };
        var xStartYCenter = { overlayX: 'start', overlayY: 'center' };
        var xEndYTop = { overlayX: 'end', overlayY: 'top' };
        var xEndYBottom = { overlayX: 'end', overlayY: 'bottom' };
        var xEndYCenter = { overlayX: 'end', overlayY: 'center' };
        return {
            xCenterYTop: xCenterYTop,
            xCenterYBottom: xCenterYBottom,
            xStartYTop: xStartYTop,
            xStartYBottom: xStartYBottom,
            xStartYCenter: xStartYCenter,
            xEndYTop: xEndYTop,
            xEndYBottom: xEndYBottom,
            xEndYCenter: xEndYCenter
        };
    };
    RufDropdownPanelComponent.prototype._getPositionStrategy = function (origin, overlay) {
        var originPosition = origin.xCenterYBottom;
        var overlayPosition = overlay.xCenterYTop;
        if (this.xPosition === 'start') {
            if (this.yPosition === 'top') {
                originPosition = origin.xStartYTop;
                overlayPosition = overlay.xStartYBottom;
            }
            else if (this.yPosition === 'center' && this.type === RufDropdownType.PopoverMenu) {
                originPosition = origin.xStartYCenter;
                overlayPosition = overlay.xEndYCenter;
            }
            else if (this.yPosition === 'bottom' || (this.yPosition === 'center' && this.type === RufDropdownType.ContextMenu)) {
                originPosition = origin.xStartYBottom;
                overlayPosition = overlay.xStartYTop;
            }
        }
        else if (this.xPosition === 'end') {
            if (this.yPosition === 'top') {
                originPosition = origin.xEndYTop;
                overlayPosition = overlay.xEndYBottom;
            }
            else if (this.yPosition === 'center' && this.type === RufDropdownType.PopoverMenu) {
                originPosition = origin.xEndYCenter;
                overlayPosition = overlay.xStartYCenter;
            }
            else if (this.yPosition === 'bottom' || (this.yPosition === 'center' && this.type === RufDropdownType.ContextMenu)) {
                originPosition = origin.xEndYBottom;
                overlayPosition = overlay.xEndYTop;
            }
        }
        else if (this.xPosition === 'center') {
            originPosition = this.yPosition === 'top' ? origin.xCenterYTop : origin.xCenterYBottom;
            overlayPosition = this.yPosition === 'top' ? overlay.xCenterYBottom : overlay.xCenterYTop;
        }
        return {
            originPosition: originPosition,
            overlayPosition: overlayPosition
        };
    };
    RufDropdownPanelComponent.prototype._invertPosition = function (x, y) {
        if (x === 'start') {
            x = 'end';
        }
        else if (x === 'end') {
            x = 'start';
        }
        if (y === 'top') {
            y = 'bottom';
        }
        else if (y === 'bottom') {
            y = 'top';
        }
        return { x: x, y: y };
    };
    RufDropdownPanelComponent.prototype.onPositionChanged = function ($event) {
        if (this.type === RufDropdownType.PopoverMenu || this.type === RufDropdownType.ContextMenu) {
            if ($event.connectionPair.overlayY === 'top') {
                if ($event.connectionPair.overlayX === 'center') {
                    this.className = 'ruf-dropdown-panel-container ruf-popover-menu center-arrow-up';
                }
                else if ($event.connectionPair.overlayX === 'start') {
                    this.className = 'ruf-dropdown-panel-container ruf-popover-menu left-arrow-up';
                }
                else {
                    this.className = 'ruf-dropdown-panel-container ruf-popover-menu right-arrow-up';
                }
            }
            else if ($event.connectionPair.overlayY === 'center') {
                if ($event.connectionPair.overlayX === 'start') {
                    this.className = 'ruf-dropdown-panel-container ruf-popover-menu right-arrow-center';
                }
                else {
                    this.className = 'ruf-dropdown-panel-container ruf-popover-menu left-arrow-center';
                }
            }
            else {
                if ($event.connectionPair.overlayX === 'center') {
                    this.className = 'ruf-dropdown-panel-container ruf-popover-menu center-arrow-down';
                }
                else if ($event.connectionPair.overlayX === 'start') {
                    this.className = 'ruf-dropdown-panel-container ruf-popover-menu left-arrow-down';
                }
                else {
                    this.className = 'ruf-dropdown-panel-container ruf-popover-menu right-arrow-down';
                }
            }
        }
        else if (this.type === RufDropdownType.Dropdown) {
            this.className = 'ruf-dropdown-panel-container';
        }
    };
    RufDropdownPanelComponent.prototype.close = function () {
        if (this.opened) {
            this.opened = false;
            this._overlayRef.detach();
            this.openedChange.emit(this.opened);
        }
    };
    RufDropdownPanelComponent.prototype.hasPopup = function () {
        return true;
    };
    RufDropdownPanelComponent.prototype.handleKeydown = function (event) {
        switch (event.keyCode) {
            case SPACE:
            case ENTER:
                this.open();
                event.preventDefault();
                event.stopPropagation();
                this.toggle.emit(true);
                break;
            case ESCAPE:
                this.close();
                this.toggle.emit(false);
                event.stopPropagation();
                break;
            default:
        }
    };
    RufDropdownPanelComponent.prototype.handleClick = function (event) {
        this.open();
    };
    tslib_1.__decorate([
        Input(),
        tslib_1.__metadata("design:type", CdkOverlayOrigin)
    ], RufDropdownPanelComponent.prototype, "origin", void 0);
    tslib_1.__decorate([
        Input(),
        tslib_1.__metadata("design:type", Boolean)
    ], RufDropdownPanelComponent.prototype, "opened", void 0);
    tslib_1.__decorate([
        Input(),
        tslib_1.__metadata("design:type", Object)
    ], RufDropdownPanelComponent.prototype, "hasBackdrop", void 0);
    tslib_1.__decorate([
        Output(),
        tslib_1.__metadata("design:type", EventEmitter)
    ], RufDropdownPanelComponent.prototype, "openedChange", void 0);
    tslib_1.__decorate([
        Input(),
        tslib_1.__metadata("design:type", Object)
    ], RufDropdownPanelComponent.prototype, "type", void 0);
    tslib_1.__decorate([
        Input(),
        tslib_1.__metadata("design:type", Object)
    ], RufDropdownPanelComponent.prototype, "xPosition", void 0);
    tslib_1.__decorate([
        Input(),
        tslib_1.__metadata("design:type", Object)
    ], RufDropdownPanelComponent.prototype, "yPosition", void 0);
    tslib_1.__decorate([
        Input(),
        tslib_1.__metadata("design:type", Boolean)
    ], RufDropdownPanelComponent.prototype, "closeIcon", void 0);
    tslib_1.__decorate([
        ViewChild(TemplateRef, { static: false }),
        tslib_1.__metadata("design:type", TemplateRef)
    ], RufDropdownPanelComponent.prototype, "content", void 0);
    tslib_1.__decorate([
        Output(),
        tslib_1.__metadata("design:type", Object)
    ], RufDropdownPanelComponent.prototype, "toggle", void 0);
    tslib_1.__decorate([
        HostListener('click', ['$event']),
        tslib_1.__metadata("design:type", Function),
        tslib_1.__metadata("design:paramtypes", [Object]),
        tslib_1.__metadata("design:returntype", void 0)
    ], RufDropdownPanelComponent.prototype, "handleClick", null);
    RufDropdownPanelComponent = tslib_1.__decorate([
        Component({
            selector: 'ruf-dropdown-panel',
            template: "<ng-template>\n <div [ngClass]=\"className\">\n      <div *ngIf=\"closeIcon\">\n        <button type=\"button\" mat-icon-button class=\"dropdown-panel-close-icon\" (keydown.enter)=\"close()\" (keydown.space)=\"close()\" (click)=\"close()\" rufIconButton>\n          <mat-icon rufIconStyle=\"sm\" rufId fisIcon=\"close\"></mat-icon>\n        </button>\n        <br>\n      </div>\n      <div [ngClass]=\"{'dropdown-panel-content': closeIcon}\">\n        <ng-content></ng-content>\n      </div>\n    </div>\n </ng-template>\n",
            encapsulation: ViewEncapsulation.None,
            styles: [".center-arrow-down:after,.center-arrow-down:before,.center-arrow-up:after,.center-arrow-up:before,.left-arrow-center:after,.left-arrow-center:before,.left-arrow-down:after,.left-arrow-down:before,.left-arrow-up:after,.left-arrow-up:before,.right-arrow-center:after,.right-arrow-center:before,.right-arrow-down:after,.right-arrow-down:before,.right-arrow-up:after,.right-arrow-up:before{border-style:solid;content:'';height:0;position:absolute;width:0;z-index:9999}.left-arrow-up{margin-top:.625rem;position:relative}.left-arrow-up:after,.left-arrow-up:before{bottom:100%;right:91%}.left-arrow-up:after{border-width:.625rem;margin-right:-.625rem}.left-arrow-up:before{border-width:.75rem;margin-right:-.75rem}.left-arrow-center{margin-right:.625rem;position:relative}.left-arrow-center:after,.left-arrow-center:before{bottom:50%;left:100%}.left-arrow-center:after{border-width:.625rem;margin-bottom:-.625rem}.left-arrow-center:before{border-width:.75rem;margin-bottom:-.75rem}.left-arrow-down{margin-bottom:.625rem;position:relative}.left-arrow-down:after,.left-arrow-down:before{right:91%;top:100%}.left-arrow-down:after{border-width:.625rem;margin-right:-.625rem}.left-arrow-down:before{border-width:.75rem;margin-right:-.75rem}.right-arrow-up{margin-top:.625rem;position:relative}.right-arrow-up:after,.right-arrow-up:before{bottom:100%;right:9%}.right-arrow-up:after{border-width:.625rem;margin-right:-.625rem}.right-arrow-up:before{border-width:.75rem;margin-right:-.75rem}.right-arrow-center{margin-left:.625rem;position:relative}.right-arrow-center:after,.right-arrow-center:before{right:100%;top:50%}.right-arrow-center:after{border-width:.625rem;margin-top:-.625rem}.right-arrow-center:before{border-width:.75rem;margin-top:-.75rem}.right-arrow-down{margin-bottom:.5rem;position:relative}.right-arrow-down:after,.right-arrow-down:before{right:9%;top:100%}.right-arrow-down:after{border-width:.625rem;margin-right:-.625rem}.right-arrow-down:before{border-width:.75rem;margin-right:-.75rem}.center-arrow-up{margin-top:.625rem;position:relative}.center-arrow-up:after,.center-arrow-up:before{bottom:100%;right:50%}.center-arrow-up:after{border-width:.625rem;margin-right:-.625rem}.center-arrow-up:before{border-width:.75rem;margin-right:-.75rem}.center-arrow-down{margin-bottom:.625rem;position:relative}.center-arrow-down:after,.center-arrow-down:before{left:50%;top:100%}.center-arrow-down:after{border-width:.625rem;margin-left:-.625rem}.center-arrow-down:before{border-width:.75rem;margin-left:-.75rem}.dropdown-panel-close-icon{float:right;opacity:.2}.dropdown-panel-close-icon:hover{cursor:pointer}.dropdown-panel-content{margin-right:1.25rem;margin-top:.5rem}.ruf-popover-menu{border-radius:.1875rem;border-style:solid;border-width:.0625rem}"]
        }),
        tslib_1.__metadata("design:paramtypes", [Overlay,
            ViewContainerRef])
    ], RufDropdownPanelComponent);
    return RufDropdownPanelComponent;
}());
export { RufDropdownPanelComponent };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZHJvcGRvd24tcGFuZWwuY29tcG9uZW50LmpzIiwic291cmNlUm9vdCI6Im5nOi8vQHJ1Zi9zaGVsbC8iLCJzb3VyY2VzIjpbInNyYy9kcm9wZG93bi1wYW5lbC9kcm9wZG93bi1wYW5lbC5jb21wb25lbnQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IjtBQUFBLE9BQU8sRUFDTCxTQUFTLEVBQ1QsWUFBWSxFQUNaLFlBQVksRUFDWixXQUFXLEVBQ1gsaUJBQWlCLEVBQ2pCLEtBQUssRUFDTCxNQUFNLEVBQ04sU0FBUyxFQUNULGdCQUFnQixFQUdqQixNQUFNLGVBQWUsQ0FBQztBQUN2QixPQUFPLEVBQUUsY0FBYyxFQUFFLE1BQU0scUJBQXFCLENBQUM7QUFDckQsT0FBTyxFQUFFLEtBQUssRUFBRSxLQUFLLEVBQUUsTUFBTSxFQUFFLE1BQU0sdUJBQXVCLENBQUM7QUFDN0QsT0FBTyxFQUFFLE9BQU8sRUFLUCxnQkFBZ0IsRUFFTSxNQUFNLHNCQUFzQixDQUFDO0FBSTVELE1BQU0sQ0FBTixJQUFZLGVBSVg7QUFKRCxXQUFZLGVBQWU7SUFDekIsK0NBQTRCLENBQUE7SUFDNUIsK0NBQTRCLENBQUE7SUFDNUIsd0NBQXFCLENBQUE7QUFDdkIsQ0FBQyxFQUpXLGVBQWUsS0FBZixlQUFlLFFBSTFCO0FBQUEsQ0FBQztBQVFGO0lBZUUsbUNBQW9CLFFBQWlCLEVBQ2pCLGlCQUFtQztRQURuQyxhQUFRLEdBQVIsUUFBUSxDQUFTO1FBQ2pCLHNCQUFpQixHQUFqQixpQkFBaUIsQ0FBa0I7UUFiOUMsZ0JBQVcsR0FBRyxJQUFJLENBQUM7UUFDbEIsaUJBQVksR0FBMEIsSUFBSSxZQUFZLEVBQVcsQ0FBQztRQUNuRSxTQUFJLEdBQUcsZUFBZSxDQUFDLFFBQVEsQ0FBQztRQUNoQyxjQUFTLEdBQUcsUUFBUSxDQUFDO1FBQ3JCLGNBQVMsR0FBRyxRQUFRLENBQUM7UUFDOUIsY0FBUyxHQUFHLDhCQUE4QixDQUFDO1FBS2pDLFdBQU0sR0FBRyxJQUFJLFlBQVksRUFB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RUFBd0M7SUFDbkU7UUFBUixLQUFLLEVBQUU7OzJEQUFpQztJQUNoQztRQUFSLEtBQUssRUFBRTs7Z0VBQXNCO0lBQ3JCO1FBQVIsS0FBSyxFQUFFOztnRUFBc0I7SUFFckI7UUFBUixLQUFLLEVBQUU7O2dFQUFvQjtJQUdhO1FBQXhDLFNBQVMsQ0FBQyxXQUFXLEVBQUUsRUFBQyxNQUFNLEVBQUUsS0FBSyxFQUFDLENBQUM7MENBQVUsV0FBVzs4REFBTTtJQUN6RDtRQUFULE1BQU0sRUFBRTs7NkRBQXNDO0lBa1EvQztRQURDLFlBQVksQ0FBQyxPQUFPLEVBQUUsQ0FBQyxRQUFRLENBQUMsQ0FBQzs7OztnRUFHakM7SUFqUlUseUJBQXlCO1FBTnJDLFNBQVMsQ0FBQztZQUNULFFBQVEsRUFBRSxvQkFBb0I7WUFDOUIsdWhCQUE4QztZQUU5QyxhQUFhLEVBQUUsaUJBQWlCLENBQUMsSUFBSTs7U0FDdEMsQ0FBQztpREFnQjhCLE9BQU87WUFDRSxnQkFBZ0I7T0FoQjVDLHlCQUF5QixDQW1SckM7SUFBRCxnQ0FBQztDQUFBLEFBblJELElBbVJDO1NBblJZLHlCQUF5QiIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7XG4gIENvbXBvbmVudCxcbiAgRXZlbnRFbWl0dGVyLFxuICBIb3N0TGlzdGVuZXIsXG4gIFRlbXBsYXRlUmVmLFxuICBWaWV3RW5jYXBzdWxhdGlvbixcbiAgSW5wdXQsXG4gIE91dHB1dCxcbiAgVmlld0NoaWxkLFxuICBWaWV3Q29udGFpbmVyUmVmLFxuICBPbkNoYW5nZXMsXG4gIFNpbXBsZUNoYW5nZXNcbn0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5pbXBvcnQgeyBUZW1wbGF0ZVBvcnRhbCB9IGZyb20gJ0Bhbmd1bGFyL2Nkay9wb3J0YWwnO1xuaW1wb3J0IHsgRU5URVIsIFNQQUNFLCBFU0NBUEUgfSBmcm9tICdAYW5ndWxhci9jZGsva2V5Y29kZXMnO1xuaW1wb3J0IHsgT3ZlcmxheSxcbiAgICAgICAgIE92ZXJsYXlDb25uZWN0aW9uUG9zaXRpb24sXG4gICAgICAgICBPcmlnaW5Db25uZWN0aW9uUG9zaXRpb24sXG4gICAgICAgICBGbGV4aWJsZUNvbm5lY3RlZFBvc2l0aW9uU3RyYXRlZ3ksXG4gICAgICAgICBPdmVybGF5UmVmLFxuICAgICAgICAgQ2RrT3ZlcmxheU9yaWdpbixcbiAgICAgICAgIEhvcml6b250YWxDb25uZWN0aW9uUG9zLFxuICAgICAgICAgVmVydGljYWxDb25uZWN0aW9uUG9zfSBmcm9tICdAYW5ndWxhci9jZGsvb3ZlcmxheSc7XG5cbmltcG9ydCB7IFJ1ZlRyaWdnZXJUYXJnZXQgfSBmcm9tICcuLi90cmlnZ2VyL3RyaWdnZXIuaW50ZXJmYWNlJztcblxuZXhwb3J0IGVudW0gUnVmRHJvcGRvd25UeXBlIHtcbiAgUG9wb3Zlck1lbnUgPSAncG9wb3Zlci1tZW51JyxcbiAgQ29udGV4dE1lbnUgPSAnY29udGV4dC1tZW51JyxcbiAgRHJvcGRvd24gPSAnZHJvcGRvd24nLFxufTtcblxuQENvbXBvbmVudCh7XG4gIHNlbGVjdG9yOiAncnVmLWRyb3Bkb3duLXBhbmVsJyxcbiAgdGVtcGxhdGVVcmw6ICcuL2Ryb3Bkb3duLXBhbmVsLmNvbXBvbmVudC5odG1sJyxcbiAgc3R5bGVVcmxzOiBbJ2Ryb3Bkb3duLXBhbmVsLmNvbXBvbmVudC5zY3NzJ10sXG4gIGVuY2Fwc3VsYXRpb246IFZpZXdFbmNhcHN1bGF0aW9uLk5vbmVcbn0pXG5leHBvcnQgY2xhc3MgUnVmRHJvcGRvd25QYW5lbENvbXBvbmVudCBpbXBsZW1lbnRzIFJ1ZlRyaWdnZXJUYXJnZXQsIE9uQ2hhbmdlcyB7XG4gIEBJbnB1dCgpIG9yaWdpbjogQ2RrT3ZlcmxheU9yaWdpbjtcbiAgQElucHV0KCkgb3BlbmVkOiBib29sZWFuO1xuICBASW5wdXQoKSBoYXNCYWNrZHJvcCA9IHRydWU7XG4gIEBPdXRwdXQoKSBvcGVuZWRDaGFuZ2U6IEV2ZW50RW1pdHRlcjxib29sZWFuPiA9IG5ldyBFdmVudEVtaXR0ZXI8Ym9vbGVhbj4oKTtcbiAgQElucHV0KCkgdHlwZSA9IFJ1ZkRyb3Bkb3duVHlwZS5Ecm9wZG93bjtcbiAgQElucHV0KCkgeFBvc2l0aW9uID0gJ2NlbnRlcic7XG4gIEBJbnB1dCgpIHlQb3NpdGlvbiA9ICdib3R0b20nO1xuICBjbGFzc05hbWUgPSAncnVmLWRyb3Bkb3duLXBhbmVsLWNvbnRhaW5lcic7XG4gIEBJbnB1dCgpIGNsb3NlSWNvbjogYm9vbGVhbjtcbiAgcHJpdmF0ZSBfb3ZlcmxheVJlZjogT3ZlcmxheVJlZjtcbiAgcHJpdmF0ZSBfcG9ydGFsOiBUZW1wbGF0ZVBvcnRhbDxhbnk+O1xuICBAVmlld0NoaWxkKFRlbXBsYXRlUmVmLCB7c3RhdGljOiBmYWxzZX0pIGNvbnRlbnQ6IFRlbXBsYXRlUmVmPGFueT47XG4gIEBPdXRwdXQoKSB0b2dnbGUgPSBuZXcgRXZlbnRFbWl0dGVyPGJvb2xlYW4+KCk7XG5cbiAgY29uc3RydWN0b3IocHJpdmF0ZSBfb3ZlcmxheTogT3ZlcmxheSxcbiAgICAgICAgICAgICAgcHJpdmF0ZSBfdmlld0NvbnRhaW5lclJlZjogVmlld0NvbnRhaW5lclJlZikge31cblxuIG5nT25DaGFuZ2VzKGNoYW5nZXM6IFNpbXBsZUNoYW5nZXMpOiB2b2lkIHtcbiAgaWYgKGNoYW5nZXMgJiZcbiAgICAgIGNoYW5nZXMuaGFzQmFja2Ryb3AgJiZcbiAgICAgIGNoYW5nZXMuaGFzQmFja2Ryb3AucHJldmlvdXNWYWx1ZSAhPT0gY2hhbmdlcy5oYXNCYWNrZHJvcC5jdXJyZW50VmFsdWUpIHtcbiAgICAvLyB3aGVuIHZhbHVlIGlzIGNoYW5nZXMgZm9yIGhhc0JhY2tkcm9wIHNldCB2YWx1ZSBudWxsIGZvciBvdmVybGF5XG4gICAgLy8gc28gdGhhdCBpdCB3aWxsIGNyZWF0ZSBuZXcgb3ZlcmxheSB3aXRoIHVwZGF0ZWQgYmFja2Ryb3AgdmFsdWVcbiAgICBpZiAodGhpcy5fb3ZlcmxheVJlZikge1xuICAgICAgdGhpcy5fb3ZlcmxheVJlZi5kZXRhY2goKTtcbiAgICAgIHRoaXMuX292ZXJsYXlSZWYgPSBudWxsO1xuICAgIH1cbiAgfVxuIH1cblxuICBvcGVuKCkge1xuICAgIGNvbnN0IG9yaWdpbiA9IHRoaXMuX2dldE9yaWdpbigpO1xuICAgIGNvbnN0IG92ZXJsYXkgPSB0aGlzLl9nZXRPdmVybGF5UG9zaXRpb24oKTtcblxuICAgIGlmICghdGhpcy5fb3ZlcmxheVJlZikge1xuICAgICAgbGV0IHBvc2l0aW9uU3RyYXRlZ3k6IEZsZXhpYmxlQ29ubmVjdGVkUG9zaXRpb25TdHJhdGVneTtcbiAgICAgIHBvc2l0aW9uU3RyYXRlZ3kgPSB0aGlzLl9vdmVybGF5LnBvc2l0aW9uKClcbiAgICAgICAgLmZsZXhpYmxlQ29ubmVjdGVkVG8odGhpcy5vcmlnaW4uZWxlbWVudFJlZilcbiAgICAgICAgLndpdGhQb3NpdGlvbnMoW1xuICAgICAgICAgIHsgLi4ub3JpZ2luLm1haW4sIC4uLm92ZXJsYXkubWFpbiB9LFxuICAgICAgICAgIHsuLi5vcmlnaW4uZmFsbGJhY2ssIC4uLm92ZXJsYXkuZmFsbGJhY2t9XG4gICAgICAgIF0pO1xuXG4gICAgICB0aGlzLm9uUG9zaXRpb25DaGFuZ2VkKHtcbiAgICAgICAgY29ubmVjdGlvblBhaXI6IHtcbiAgICAgICAgICBvdmVybGF5WDogb3ZlcmxheS5tYWluLm92ZXJsYXlYLFxuICAgICAgICAgIG92ZXJsYXlZOiBvdmVybGF5Lm1haW4ub3ZlcmxheVlcbiAgICAgICAgfVxuICAgICAgfSk7XG5cbiAgICAgIHBvc2l0aW9uU3RyYXRlZ3kucG9zaXRpb25DaGFuZ2VzLnN1YnNjcmliZShjaGFuZ2UgPT4ge1xuICAgICAgICB0aGlzLm9uUG9zaXRpb25DaGFuZ2VkKGNoYW5nZSk7XG4gICAgICB9KTtcblxuICAgICAgdGhpcy5fb3ZlcmxheVJlZiA9IHRoaXMuX292ZXJsYXkuY3JlYXRlKHtcbiAgICAgICAgaGFzQmFja2Ryb3A6IHRoaXMuaGFzQmFja2Ryb3AsXG4gICAgICAgIGJhY2tkcm9wQ2xhc3M6ICdydWYtZHJvcGRvd24tcGFuZWwtd3JhcHBlcicsXG4gICAgICAgIHBvc2l0aW9uU3RyYXRlZ3lcbiAgICAgIH0pO1xuXG4gICAgICB0aGlzLl9vdmVybGF5UmVmLmJhY2tkcm9wQ2xpY2soKS5zdWJzY3JpYmUoKCkgPT4gdGhpcy5jbG9zZSgpKTtcbiAgICAgIHRoaXMuX3BvcnRhbCA9IG5ldyBUZW1wbGF0ZVBvcnRhbCh0aGlzLmNvbnRlbnQsIHRoaXMuX3ZpZXdDb250YWluZXJSZWYpO1xuICAgIH1cblxuICAgIGlmICghdGhpcy5fb3ZlcmxheVJlZi5oYXNBdHRhY2hlZCgpKSB7XG4gICAgICB0aGlzLl9vdmVybGF5UmVmLmF0dGFjaCh0aGlzLl9wb3J0YWwpO1xuICAgICAgdGhpcy5vcGVuZWQgPSB0cnVlO1xuICAgICAgdGhpcy50b2dnbGUuZW1pdCh0cnVlKTtcbiAgICB9IGVsc2Uge1xuICAgICAgdGhpcy5jbG9zZSgpO1xuICAgICAgdGhpcy50b2dnbGUuZW1pdChmYWxzZSk7XG4gICAgfVxuICB9O1xuXG4gIF9nZXRPcmlnaW4oKTogeyBtYWluOiBPcmlnaW5Db25uZWN0aW9uUG9zaXRpb24sIGZhbGxiYWNrOiBPcmlnaW5Db25uZWN0aW9uUG9zaXRpb259IHtcbiAgICBsZXQgb3JpZ2luUG9zaXRpb246IE9yaWdpbkNvbm5lY3Rpb25Qb3NpdGlvbjtcbiAgICBvcmlnaW5Qb3NpdGlvbiA9IHRoaXMuX2dldFBvc2l0aW9uU3RyYXRlZ3kodGhpcy5fZ2V0T3JpZ2luVmFsdWVzKCksIHRoaXMuX2dldE92ZXJsYXlQb3NpdGlvblZhbHVlcygpKS5vcmlnaW5Qb3NpdGlvbjtcbiAgICBjb25zdCB7eCwgeX0gPSB0aGlzLl9pbnZlcnRQb3NpdGlvbihvcmlnaW5Qb3NpdGlvbi5vcmlnaW5YLCBvcmlnaW5Qb3NpdGlvbi5vcmlnaW5ZKTtcbiAgICBpZiAodGhpcy50eXBlID09PSBSdWZEcm9wZG93blR5cGUuUG9wb3Zlck1lbnUgfHwgdGhpcy50eXBlID09PSBSdWZEcm9wZG93blR5cGUuQ29udGV4dE1lbnUpIHtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIG1haW46IG9yaWdpblBvc2l0aW9uLFxuICAgICAgICBmYWxsYmFjazoge29yaWdpblg6IHgsIG9yaWdpblk6IHl9XG4gICAgICB9XG4gICAgfSBlbHNlIHtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIG1haW46IHtvcmlnaW5YOiAnc3RhcnQnLCBvcmlnaW5ZOiAnYm90dG9tJ30sXG4gICAgICAgIGZhbGxiYWNrOiB7b3JpZ2luWDogJ2VuZCcsIG9yaWdpblk6ICd0b3AnfVxuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIF9nZXRPdmVybGF5UG9zaXRpb24oKTogeyBtYWluOiBPdmVybGF5Q29ubmVjdGlvblBvc2l0aW9uLCBmYWxsYmFjazogT3ZlcmxheUNvbm5lY3Rpb25Qb3NpdGlvbn0ge1xuICAgIGNvbnN0IFhQb3NpdGlvbiA9IHRoaXMueFBvc2l0aW9uO1xuICAgIGNvbnN0IFlQb3NpdGlvbiA9IHRoaXMueVBvc2l0aW9uO1xuICAgIGxldCBvdmVybGF5UG9zaXRpb246IE92ZXJsYXlDb25uZWN0aW9uUG9zaXRpb247XG4gICAgb3ZlcmxheVBvc2l0aW9uID0gdGhpcy5fZ2V0UG9zaXRpb25TdHJhdGVneSh0aGlzLl9nZXRPcmlnaW5WYWx1ZXMoKSwgdGhpcy5fZ2V0T3ZlcmxheVBvc2l0aW9uVmFsdWVzKCkpLm92ZXJsYXlQb3NpdGlvbjtcbiAgICBjb25zdCB7eCwgeX0gPSB0aGlzLl9pbnZlcnRQb3NpdGlvbihvdmVybGF5UG9zaXRpb24ub3ZlcmxheVgsIG92ZXJsYXlQb3NpdGlvbi5vdmVybGF5WSk7XG4gICAgaWYgKHRoaXMudHlwZSA9PT0gUnVmRHJvcGRvd25UeXBlLlBvcG92ZXJNZW51IHx8IHRoaXMudHlwZSA9PT0gUnVmRHJvcGRvd25UeXBlLkNvbnRleHRNZW51KSB7XG4gICAgICByZXR1cm4ge1xuICAgICAgICBtYWluOiBvdmVybGF5UG9zaXRpb24sXG4gICAgICAgIGZhbGxiYWNrOiB7b3ZlcmxheVg6IHgsIG92ZXJsYXlZOiB5fVxuICAgICAgfVxuICAgIH0gZWxzZSB7XG4gICAgICByZXR1cm4ge1xuICAgICAgICBtYWluOiB7b3ZlcmxheVg6ICdzdGFydCcsIG92ZXJsYXlZOiAndG9wJ30sXG4gICAgICAgIGZhbGxiYWNrOiB7b3ZlcmxheVg6ICdlbmQnLCBvdmVybGF5WTogJ2JvdHRvbSd9XG4gICAgICB9XG4gICAgfVxuICB9XG5cbiAgX2dldE9yaWdpblZhbHVlcygpOiB7IHhDZW50ZXJZQm90dG9tOiBPcmlnaW5Db25uZWN0aW9uUG9zaXRpb24sIHhDZW50ZXJZVG9wOiBPcmlnaW5Db25uZWN0aW9uUG9zaXRpb25cbiAgICAgICAgICAgICAgICAgIHhTdGFydFlCb3R0b206IE9yaWdpbkNvbm5lY3Rpb25Qb3NpdGlvbiwgeFN0YXJ0WVRvcDogT3JpZ2luQ29ubmVjdGlvblBvc2l0aW9uLCB4U3RhcnRZQ2VudGVyOiBPcmlnaW5Db25uZWN0aW9uUG9zaXRpb24sXG4gICAgICAgICAgICAgICAgICB4RW5kWUJvdHRvbTogT3JpZ2luQ29ubmVjdGlvblBvc2l0aW9uLCB4RW5kWVRvcDogT3JpZ2luQ29ubmVjdGlvblBvc2l0aW9uLCB4RW5kWUNlbnRlcjogT3JpZ2luQ29ubmVjdGlvblBvc2l0aW9ufSB7XG4gICAgY29uc3QgeENlbnRlcllCb3R0b206IE9yaWdpbkNvbm5lY3Rpb25Qb3NpdGlvbiA9IHtvcmlnaW5YOiAnY2VudGVyJywgb3JpZ2luWTogJ2JvdHRvbSd9O1xuICAgIGNvbnN0IHhDZW50ZXJZVG9wOiBPcmlnaW5Db25uZWN0aW9uUG9zaXRpb24gPSB7b3JpZ2luWDogJ2NlbnRlcicsIG9yaWdpblk6ICd0b3AnfTtcbiAgICBjb25zdCB4U3RhcnRZQm90dG9tOiBPcmlnaW5Db25uZWN0aW9uUG9zaXRpb24gPSB7b3JpZ2luWDogJ3N0YXJ0Jywgb3JpZ2luWTogJ2JvdHRvbSd9O1xuICAgIGNvbnN0IHhTdGFydFlUb3A6IE9yaWdpbkNvbm5lY3Rpb25Qb3NpdGlvbiA9IHtvcmlnaW5YOiAnc3RhcnQnLCBvcmlnaW5ZOiAndG9wJ307XG4gICAgY29uc3QgeFN0YXJ0WUNlbnRlcjogT3JpZ2luQ29ubmVjdGlvblBvc2l0aW9uID0geyBvcmlnaW5YOiAnc3RhcnQnLCBvcmlnaW5ZOiAnY2VudGVyJ307XG4gICAgY29uc3QgeEVuZFlCb3R0b206IE9yaWdpbkNvbm5lY3Rpb25Qb3NpdGlvbiA9IHtvcmlnaW5YOiAnZW5kJywgb3JpZ2luWTogJ2JvdHRvbSd9O1xuICAgIGNvbnN0IHhFbmRZVG9wOiBPcmlnaW5Db25uZWN0aW9uUG9zaXRpb24gPSB7b3JpZ2luWDogJ2VuZCcsIG9yaWdpblk6ICd0b3AnfTtcbiAgICBjb25zdCB4RW5kWUNlbnRlcjogT3JpZ2luQ29ubmVjdGlvblBvc2l0aW9uID0geyBvcmlnaW5YOiAnZW5kJywgb3JpZ2luWTogJ2NlbnRlcid9O1xuXG4gICAgcmV0dXJuIHtcbiAgICAgIHhDZW50ZXJZQm90dG9tOiB4Q2VudGVyWUJvdHRvbSxcbiAgICAgIHhDZW50ZXJZVG9wOiB4Q2VudGVyWVRvcCxcbiAgICAgIHhTdGFydFlCb3R0b206IHhTdGFydFlCb3R0b20sXG4gICAgICB4U3RhcnRZVG9wOiB4U3RhcnRZVG9wLFxuICAgICAgeFN0YXJ0WUNlbnRlcjogeFN0YXJ0WUNlbnRlcixcbiAgICAgIHhFbmRZQm90dG9tOiB4RW5kWUJvdHRvbSxcbiAgICAgIHhFbmRZVG9wOiB4RW5kWVRvcCxcbiAgICAgIHhFbmRZQ2VudGVyOiB4RW5kWUNlbnRlclxuICAgIH07XG4gIH1cblxuICBfZ2V0T3ZlcmxheVBvc2l0aW9uVmFsdWVzKCk6IHtcbiAgICAgICAgICB4Q2VudGVyWVRvcDogT3ZlcmxheUNvbm5lY3Rpb25Qb3NpdGlvbiwgeENlbnRlcllCb3R0b206IE92ZXJsYXlDb25uZWN0aW9uUG9zaXRpb25cbiAgICAgICAgICB4U3RhcnRZVG9wOiBPdmVybGF5Q29ubmVjdGlvblBvc2l0aW9uLCB4U3RhcnRZQm90dG9tOiBPdmVybGF5Q29ubmVjdGlvblBvc2l0aW9uLCB4U3RhcnRZQ2VudGVyOiBPdmVybGF5Q29ubmVjdGlvblBvc2l0aW9uLFxuICAgICAgICAgIHhFbmRZVG9wOiBPdmVybGF5Q29ubmVjdGlvblBvc2l0aW9uLCB4RW5kWUJvdHRvbTogT3ZlcmxheUNvbm5lY3Rpb25Qb3NpdGlvbiwgeEVuZFlDZW50ZXI6IE92ZXJsYXlDb25uZWN0aW9uUG9zaXRpb259IHtcbiAgICAgIGNvbnN0IHhDZW50ZXJZVG9wOiBPdmVybGF5Q29ubmVjdGlvblBvc2l0aW9uID0ge292ZXJsYXlYOiAnY2VudGVyJywgb3ZlcmxheVk6ICd0b3AnfTtcbiAgICAgIGNvbnN0IHhDZW50ZXJZQm90dG9tOiBPdmVybGF5Q29ubmVjdGlvblBvc2l0aW9uID0ge292ZXJsYXlYOiAnY2VudGVyJywgb3ZlcmxheVk6ICdib3R0b20nfTtcbiAgICAgIGNvbnN0IHhTdGFydFlUb3A6IE92ZXJsYXlDb25uZWN0aW9uUG9zaXRpb24gPSB7b3ZlcmxheVg6ICdzdGFydCcsIG92ZXJsYXlZOiAndG9wJ307XG4gICAgICBjb25zdCB4U3RhcnRZQm90dG9tOiBPdmVybGF5Q29ubmVjdGlvblBvc2l0aW9uID0ge292ZXJsYXlYOiAnc3RhcnQnLCBvdmVybGF5WTogJ2JvdHRvbSd9O1xuICAgICAgY29uc3QgeFN0YXJ0WUNlbnRlcjogT3ZlcmxheUNvbm5lY3Rpb25Qb3NpdGlvbiA9IHtvdmVybGF5WDogJ3N0YXJ0Jywgb3ZlcmxheVk6ICdjZW50ZXInfTtcbiAgICAgIGNvbnN0IHhFbmRZVG9wOiBPdmVybGF5Q29ubmVjdGlvblBvc2l0aW9uID0ge292ZXJsYXlYOiAnZW5kJywgb3ZlcmxheVk6ICd0b3AnfTtcbiAgICAgIGNvbnN0IHhFbmRZQm90dG9tOiBPdmVybGF5Q29ubmVjdGlvblBvc2l0aW9uID0ge292ZXJsYXlYOiAnZW5kJywgb3ZlcmxheVk6ICdib3R0b20nfTtcbiAgICAgIGNvbnN0IHhFbmRZQ2VudGVyOiBPdmVybGF5Q29ubmVjdGlvblBvc2l0aW9uID0ge292ZXJsYXlYOiAnZW5kJywgb3ZlcmxheVk6ICdjZW50ZXInfTtcblxuICAgICAgcmV0dXJuIHtcbiAgICAgICAgeENlbnRlcllUb3A6IHhDZW50ZXJZVG9wLFxuICAgICAgICB4Q2VudGVyWUJvdHRvbTogeENlbnRlcllCb3R0b20sXG4gICAgICAgIHhTdGFydFlUb3A6IHhTdGFydFlUb3AsXG4gICAgICAgIHhTdGFydFlCb3R0b206IHhTdGFydFlCb3R0b20sXG4gICAgICAgIHhTdGFydFlDZW50ZXI6IHhTdGFydFlDZW50ZXIsXG4gICAgICAgIHhFbmRZVG9wOiB4RW5kWVRvcCxcbiAgICAgICAgeEVuZFlCb3R0b206IHhFbmRZQm90dG9tLFxuICAgICAgICB4RW5kWUNlbnRlcjogeEVuZFlDZW50ZXJcbiAgICAgIH07XG4gIH1cblxuICBfZ2V0UG9zaXRpb25TdHJhdGVneShvcmlnaW4sIG92ZXJsYXkpIHtcbiAgICBsZXQgb3JpZ2luUG9zaXRpb24gPSBvcmlnaW4ueENlbnRlcllCb3R0b207XG4gICAgbGV0IG92ZXJsYXlQb3NpdGlvbiA9IG92ZXJsYXkueENlbnRlcllUb3A7XG4gICAgaWYgKHRoaXMueFBvc2l0aW9uID09PSAnc3RhcnQnKSB7XG4gICAgICBpZiAodGhpcy55UG9zaXRpb24gPT09ICd0b3AnKSB7XG4gICAgICAgIG9yaWdpblBvc2l0aW9uID0gb3JpZ2luLnhTdGFydFlUb3A7XG4gICAgICAgIG92ZXJsYXlQb3NpdGlvbiA9IG92ZXJsYXkueFN0YXJ0WUJvdHRvbTtcbiAgICAgIH0gZWxzZSBpZiAodGhpcy55UG9zaXRpb24gPT09ICdjZW50ZXInICYmIHRoaXMudHlwZSA9PT0gUnVmRHJvcGRvd25UeXBlLlBvcG92ZXJNZW51KSB7XG4gICAgICAgIG9yaWdpblBvc2l0aW9uID0gb3JpZ2luLnhTdGFydFlDZW50ZXI7XG4gICAgICAgIG92ZXJsYXlQb3NpdGlvbiA9IG92ZXJsYXkueEVuZFlDZW50ZXI7XG4gICAgICB9IGVsc2UgaWYgKHRoaXMueVBvc2l0aW9uID09PSAnYm90dG9tJyB8fCAodGhpcy55UG9zaXRpb24gPT09ICdjZW50ZXInICYmIHRoaXMudHlwZSA9PT0gUnVmRHJvcGRvd25UeXBlLkNvbnRleHRNZW51KSkge1xuICAgICAgICBvcmlnaW5Qb3NpdGlvbiA9IG9yaWdpbi54U3RhcnRZQm90dG9tO1xuICAgICAgICBvdmVybGF5UG9zaXRpb24gPSBvdmVybGF5LnhTdGFydFlUb3A7XG4gICAgICB9XG4gICAgfSBlbHNlIGlmICh0aGlzLnhQb3NpdGlvbiA9PT0gJ2VuZCcpIHtcbiAgICAgIGlmICh0aGlzLnlQb3NpdGlvbiA9PT0gJ3RvcCcpIHtcbiAgICAgICAgb3JpZ2luUG9zaXRpb24gPSBvcmlnaW4ueEVuZFlUb3A7XG4gICAgICAgIG92ZXJsYXlQb3NpdGlvbiA9IG92ZXJsYXkueEVuZFlCb3R0b207XG4gICAgICB9IGVsc2UgaWYgKHRoaXMueVBvc2l0aW9uID09PSAnY2VudGVyJyAmJiB0aGlzLnR5cGUgPT09IFJ1ZkRyb3Bkb3duVHlwZS5Qb3BvdmVyTWVudSkge1xuICAgICAgICBvcmlnaW5Qb3NpdGlvbiA9IG9yaWdpbi54RW5kWUNlbnRlcjtcbiAgICAgICAgb3ZlcmxheVBvc2l0aW9uID0gb3ZlcmxheS54U3RhcnRZQ2VudGVyO1xuICAgICAgfSBlbHNlIGlmICh0aGlzLnlQb3NpdGlvbiA9PT0gJ2JvdHRvbScgfHwgKHRoaXMueVBvc2l0aW9uID09PSAnY2VudGVyJyAmJiB0aGlzLnR5cGUgPT09IFJ1ZkRyb3Bkb3duVHlwZS5Db250ZXh0TWVudSkpIHtcbiAgICAgICAgb3JpZ2luUG9zaXRpb24gPSBvcmlnaW4ueEVuZFlCb3R0b207XG4gICAgICAgIG92ZXJsYXlQb3NpdGlvbiA9IG92ZXJsYXkueEVuZFlUb3A7XG4gICAgICB9XG4gICAgfSBlbHNlIGlmICh0aGlzLnhQb3NpdGlvbiA9PT0gJ2NlbnRlcicpIHtcbiAgICAgIG9yaWdpblBvc2l0aW9uID0gdGhpcy55UG9zaXRpb24gPT09ICd0b3AnID8gb3JpZ2luLnhDZW50ZXJZVG9wIDogb3JpZ2luLnhDZW50ZXJZQm90dG9tO1xuICAgICAgb3ZlcmxheVBvc2l0aW9uID0gdGhpcy55UG9zaXRpb24gPT09ICd0b3AnID8gb3ZlcmxheS54Q2VudGVyWUJvdHRvbSA6IG92ZXJsYXkueENlbnRlcllUb3A7XG4gICAgfVxuICAgIHJldHVybiB7XG4gICAgICBvcmlnaW5Qb3NpdGlvbjogb3JpZ2luUG9zaXRpb24sXG4gICAgICBvdmVybGF5UG9zaXRpb246IG92ZXJsYXlQb3NpdGlvblxuICAgIH1cbiAgfVxuXG4gIF9pbnZlcnRQb3NpdGlvbih4OiBIb3Jpem9udGFsQ29ubmVjdGlvblBvcywgeTogVmVydGljYWxDb25uZWN0aW9uUG9zKSB7XG4gICAgaWYgKHggPT09ICdzdGFydCcpIHtcbiAgICAgIHggPSAnZW5kJ1xuICAgIH0gZWxzZSBpZiAoeCA9PT0gJ2VuZCcpIHtcbiAgICAgIHggPSAnc3RhcnQnXG4gICAgfVxuXG4gICAgaWYgKHkgPT09ICd0b3AnKSB7XG4gICAgICB5ID0gJ2JvdHRvbSc7XG4gICAgfSBlbHNlIGlmICh5ID09PSAnYm90dG9tJykge1xuICAgICAgeSA9ICd0b3AnO1xuICAgIH1cbiAgICByZXR1cm4ge3gsIHl9O1xuICB9XG5cbiAgb25Qb3NpdGlvbkNoYW5nZWQgKCRldmVudCkge1xuICAgIGlmICh0aGlzLnR5cGUgPT09IFJ1ZkRyb3Bkb3duVHlwZS5Qb3BvdmVyTWVudSB8fCB0aGlzLnR5cGUgPT09IFJ1ZkRyb3Bkb3duVHlwZS5Db250ZXh0TWVudSkge1xuICAgICAgaWYgKCRldmVudC5jb25uZWN0aW9uUGFpci5vdmVybGF5WSA9PT0gJ3RvcCcpIHtcbiAgICAgICAgaWYgKCRldmVudC5jb25uZWN0aW9uUGFpci5vdmVybGF5WCA9PT0gJ2NlbnRlcicpIHtcbiAgICAgICAgICB0aGlzLmNsYXNzTmFtZSA9ICdydWYtZHJvcGRvd24tcGFuZWwtY29udGFpbmVyIHJ1Zi1wb3BvdmVyLW1lbnUgY2VudGVyLWFycm93LXVwJztcbiAgICAgICAgfSBlbHNlIGlmICgkZXZlbnQuY29ubmVjdGlvblBhaXIub3ZlcmxheVggPT09ICdzdGFydCcpIHtcbiAgICAgICAgICB0aGlzLmNsYXNzTmFtZSA9ICdydWYtZHJvcGRvd24tcGFuZWwtY29udGFpbmVyIHJ1Zi1wb3BvdmVyLW1lbnUgbGVmdC1hcnJvdy11cCc7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgdGhpcy5jbGFzc05hbWUgPSAncnVmLWRyb3Bkb3duLXBhbmVsLWNvbnRhaW5lciBydWYtcG9wb3Zlci1tZW51IHJpZ2h0LWFycm93LXVwJztcbiAgICAgICAgfVxuICAgICAgfSBlbHNlIGlmICgkZXZlbnQuY29ubmVjdGlvblBhaXIub3ZlcmxheVkgPT09ICdjZW50ZXInKSB7XG4gICAgICAgIGlmICgkZXZlbnQuY29ubmVjdGlvblBhaXIub3ZlcmxheVggPT09ICdzdGFydCcpIHtcbiAgICAgICAgICB0aGlzLmNsYXNzTmFtZSA9ICdydWYtZHJvcGRvd24tcGFuZWwtY29udGFpbmVyIHJ1Zi1wb3BvdmVyLW1lbnUgcmlnaHQtYXJyb3ctY2VudGVyJztcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICB0aGlzLmNsYXNzTmFtZSA9ICdydWYtZHJvcGRvd24tcGFuZWwtY29udGFpbmVyIHJ1Zi1wb3BvdmVyLW1lbnUgbGVmdC1hcnJvdy1jZW50ZXInO1xuICAgICAgICB9XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBpZiAoJGV2ZW50LmNvbm5lY3Rpb25QYWlyLm92ZXJsYXlYID09PSAnY2VudGVyJykge1xuICAgICAgICAgIHRoaXMuY2xhc3NOYW1lID0gJ3J1Zi1kcm9wZG93bi1wYW5lbC1jb250YWluZXIgcnVmLXBvcG92ZXItbWVudSBjZW50ZXItYXJyb3ctZG93bic7XG4gICAgICAgIH0gZWxzZSBpZiAoJGV2ZW50LmNvbm5lY3Rpb25QYWlyLm92ZXJsYXlYID09PSAnc3RhcnQnKSB7XG4gICAgICAgICAgdGhpcy5jbGFzc05hbWUgPSAncnVmLWRyb3Bkb3duLXBhbmVsLWNvbnRhaW5lciBydWYtcG9wb3Zlci1tZW51IGxlZnQtYXJyb3ctZG93bic7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgdGhpcy5jbGFzc05hbWUgPSAncnVmLWRyb3Bkb3duLXBhbmVsLWNvbnRhaW5lciBydWYtcG9wb3Zlci1tZW51IHJpZ2h0LWFycm93LWRvd24nO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfSBlbHNlIGlmICh0aGlzLnR5cGUgPT09IFJ1ZkRyb3Bkb3duVHlwZS5Ecm9wZG93bikge1xuICAgICAgdGhpcy5jbGFzc05hbWUgPSAncnVmLWRyb3Bkb3duLXBhbmVsLWNvbnRhaW5lcic7XG4gICAgfVxuICB9XG5cbiAgY2xvc2UoKSB7XG4gICAgaWYgKHRoaXMub3BlbmVkKSB7XG4gICAgICB0aGlzLm9wZW5lZCA9IGZhbHNlO1xuICAgICAgdGhpcy5fb3ZlcmxheVJlZi5kZXRhY2goKTtcbiAgICAgIHRoaXMub3BlbmVkQ2hhbmdlLmVtaXQodGhpcy5vcGVuZWQpO1xuICAgIH1cbiAgfVxuXG4gIGhhc1BvcHVwKCk6IGJvb2xlYW4ge1xuICAgIHJldHVybiB0cnVlO1xuICB9XG5cbiAgaGFuZGxlS2V5ZG93bihldmVudCkge1xuICAgIHN3aXRjaCAoZXZlbnQua2V5Q29kZSkge1xuICAgICAgY2FzZSBTUEFDRTpcbiAgICAgIGNhc2UgRU5URVI6XG4gICAgICAgIHRoaXMub3BlbigpO1xuICAgICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICBldmVudC5zdG9wUHJvcGFnYXRpb24oKTtcbiAgICAgICAgdGhpcy50b2dnbGUuZW1pdCh0cnVlKTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlIEVTQ0FQRTpcbiAgICAgICAgdGhpcy5jbG9zZSgpO1xuICAgICAgICB0aGlzLnRvZ2dsZS5lbWl0KGZhbHNlKTtcbiAgICAgICAgZXZlbnQuc3RvcFByb3BhZ2F0aW9uKCk7XG4gICAgICAgIGJyZWFrO1xuICAgICAgZGVmYXVsdDpcbiAgICB9XG4gIH1cblxuICBASG9zdExpc3RlbmVyKCdjbGljaycsIFsnJGV2ZW50J10pXG4gIGhhbmRsZUNsaWNrKGV2ZW50KSB7XG4gICAgdGhpcy5vcGVuKCk7XG4gIH1cblxufVxuIl19