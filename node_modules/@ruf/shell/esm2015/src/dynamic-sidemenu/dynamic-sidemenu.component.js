import * as tslib_1 from "tslib";
import { Component, ViewEncapsulation, ElementRef, Renderer2, EventEmitter, Input, Inject, Output, ViewChild, ViewChildren, QueryList } from '@angular/core';
import { MediaObserver } from '@angular/flex-layout';
import { MatMenuTrigger } from '@angular/material/menu';
import { DOCUMENT } from '@angular/common';
import { ENTER, SPACE } from '@angular/cdk/keycodes';
let RufDynamicSideMenuComponent = class RufDynamicSideMenuComponent {
    constructor(document, _renderer, _mediaObserver, _elementRef) {
        this.document = document;
        this._renderer = _renderer;
        this._mediaObserver = _mediaObserver;
        this._elementRef = _elementRef;
        this.items = [];
        this._inkbarPosition = this._inkbarPosition || 'start';
        this.multi = true;
        this._select = new EventEmitter();
        // @HostBinding('class.ruf-dynamic-sidemenu-minimized')
        this.minimized = false;
        this.minimizedXs = false;
        this.minimizedSm = false;
        this.minimizedMd = false;
        this.minimizedLg = false;
        this.minimizedXl = false;
        this.minimizedGtXs = false;
        this.minimizedGtSm = false;
        this.minimizedGtMd = false;
        this.minimizedGtLg = false;
    }
    isMinimized() {
        return [
            this.minimized,
            this.minimizedXs && this._mediaObserver.isActive('xs'),
            this.minimizedSm && this._mediaObserver.isActive('sm'),
            this.minimizedMd && this._mediaObserver.isActive('md'),
            this.minimizedLg && this._mediaObserver.isActive('lg'),
            this.minimizedXl && this._mediaObserver.isActive('xl'),
            this.minimizedGtXs && this._mediaObserver.isActive('gt-xs'),
            this.minimizedGtSm && this._mediaObserver.isActive('gt-sm'),
            this.minimizedGtMd && this._mediaObserver.isActive('gt-md'),
            this.minimizedGtLg && this._mediaObserver.isActive('gt-lg')
        ].some(x => x === true);
    }
    onSelect($event) {
        if (!($event.data && $event.data.children)) {
            this._selectedPath = $event.path;
            this._select.emit($event.data);
        }
        else if ($event && $event.event) {
            $event.event.preventDefault();
            $event.event.stopPropagation();
        }
    }
    getRufId(item) {
        return 'dynamic_sidemenu_' + item.label.toLowerCase().replace(/ /g, '_');
    }
    closeMenu() {
        this.menuTrigger.closeMenu();
    }
    setPopupData(event, data) {
        this.sideMenuPopupData = data;
        event.currentTarget.classList.add('ruf-active');
        // focus on the first menu item
        setTimeout(() => {
            const cdkOverlayClass = `.ruf-sidemenu-popup-backdrop + .cdk-overlay-connected-position-bounding-box`;
            const cdkOverlayElement = this.document.querySelector(cdkOverlayClass);
            if (cdkOverlayElement) {
                // set left position for cdkOverlay based on the position of menuitem.
                // so we need to get left and width value from BoundingClientRect;
                const rufMenuItem = this._elementRef.nativeElement.querySelector('.ruf-menu-item');
                const rufMenuItemClientTect = rufMenuItem.getBoundingClientRect();
                cdkOverlayElement.style.left = rufMenuItemClientTect.left + rufMenuItemClientTect.width + 'px';
                const firstMenuItem = this.document.querySelector(`${cdkOverlayClass} .ruf-menu-item`);
                if (firstMenuItem) {
                    firstMenuItem.focus();
                }
            }
        });
    }
    onPopupClose() {
        // remove active class when popop is closed
        const currentActiveItem = this._elementRef.nativeElement.querySelector('.ruf-menu-item.ruf-active');
        if (currentActiveItem) {
            currentActiveItem.focus();
            this._renderer.removeClass(currentActiveItem, 'ruf-active');
        }
    }
    keyHandler(event) {
        switch (event.keyCode) {
            case ENTER:
            case SPACE:
                event.currentTarget.click();
                break;
            default:
        }
    }
    getOverlayClasses() {
        const colorClass = this._activeColor ? `ruf-${this._activeColor}` : ``;
        return `${this.popupBackgroundClass} ${colorClass} ruf-menubar-inkbar-${this._inkbarPosition}`;
    }
    toggleChildItems(currentTrigger) {
        if (this.multi === false) {
            this._triggers.toArray()
                .filter((element) => element.value === true && element !== currentTrigger)
                .forEach((element) => {
                element.value = false;
            });
        }
    }
};
tslib_1.__decorate([
    Input(),
    tslib_1.__metadata("design:type", Array)
], RufDynamicSideMenuComponent.prototype, "items", void 0);
tslib_1.__decorate([
    Input(),
    tslib_1.__metadata("design:type", String)
], RufDynamicSideMenuComponent.prototype, "popupBackgroundClass", void 0);
tslib_1.__decorate([
    ViewChild(MatMenuTrigger, { static: false }),
    tslib_1.__metadata("design:type", MatMenuTrigger)
], RufDynamicSideMenuComponent.prototype, "menuTrigger", void 0);
tslib_1.__decorate([
    ViewChild('menuTrigger', { static: false }),
    tslib_1.__metadata("design:type", ElementRef)
], RufDynamicSideMenuComponent.prototype, "trigger", void 0);
tslib_1.__decorate([
    Input('selectedPath'),
    tslib_1.__metadata("design:type", String)
], RufDynamicSideMenuComponent.prototype, "_selectedPath", void 0);
tslib_1.__decorate([
    Input('activeColor'),
    tslib_1.__metadata("design:type", String)
], RufDynamicSideMenuComponent.prototype, "_activeColor", void 0);
tslib_1.__decorate([
    Input('inkbarPosition'),
    tslib_1.__metadata("design:type", Object)
], RufDynamicSideMenuComponent.prototype, "_inkbarPosition", void 0);
tslib_1.__decorate([
    Input('multi'),
    tslib_1.__metadata("design:type", Object)
], RufDynamicSideMenuComponent.prototype, "multi", void 0);
tslib_1.__decorate([
    Output('select'),
    tslib_1.__metadata("design:type", Object)
], RufDynamicSideMenuComponent.prototype, "_select", void 0);
tslib_1.__decorate([
    ViewChildren('trigger'),
    tslib_1.__metadata("design:type", QueryList)
], RufDynamicSideMenuComponent.prototype, "_triggers", void 0);
tslib_1.__decorate([
    Input(),
    tslib_1.__metadata("design:type", Object)
], RufDynamicSideMenuComponent.prototype, "minimized", void 0);
tslib_1.__decorate([
    Input('minimized.xs'),
    tslib_1.__metadata("design:type", Object)
], RufDynamicSideMenuComponent.prototype, "minimizedXs", void 0);
tslib_1.__decorate([
    Input('minimized.sm'),
    tslib_1.__metadata("design:type", Object)
], RufDynamicSideMenuComponent.prototype, "minimizedSm", void 0);
tslib_1.__decorate([
    Input('minimized.md'),
    tslib_1.__metadata("design:type", Object)
], RufDynamicSideMenuComponent.prototype, "minimizedMd", void 0);
tslib_1.__decorate([
    Input('minimized.lg'),
    tslib_1.__metadata("design:type", Object)
], RufDynamicSideMenuComponent.prototype, "minimizedLg", void 0);
tslib_1.__decorate([
    Input('minimized.xl'),
    tslib_1.__metadata("design:type", Object)
], RufDynamicSideMenuComponent.prototype, "minimizedXl", void 0);
tslib_1.__decorate([
    Input('minimized.gt-xs'),
    tslib_1.__metadata("design:type", Object)
], RufDynamicSideMenuComponent.prototype, "minimizedGtXs", void 0);
tslib_1.__decorate([
    Input('minimized.gt-sm'),
    tslib_1.__metadata("design:type", Object)
], RufDynamicSideMenuComponent.prototype, "minimizedGtSm", void 0);
tslib_1.__decorate([
    Input('minimized.gt-md'),
    tslib_1.__metadata("design:type", Object)
], RufDynamicSideMenuComponent.prototype, "minimizedGtMd", void 0);
tslib_1.__decorate([
    Input('minimized.gt-lg'),
    tslib_1.__metadata("design:type", Object)
], RufDynamicSideMenuComponent.prototype, "minimizedGtLg", void 0);
RufDynamicSideMenuComponent = tslib_1.__decorate([
    Component({
        selector: 'ruf-dynamic-sidemenu',
        template: "<ruf-sidemenu rufId=\"dynamic_sidemenu\" [activeColor]=\"_activeColor\"\n   [inkbarPosition]=\"_inkbarPosition\"\n   [selectedPath]=\"_selectedPath\"\n   [ngClass]=\"{'ruf-dynamic-sidemenu-minimized': isMinimized()}\"\n   (select)=\"onSelect($event)\">\n\n  <ng-container *ngFor=\"let item of items\">\n    <a [rufId]=\"getRufId(item)\" [data]=\"item\" *ngIf=\"!item.children || item.children.length === 0 \" [path]=\"item.path\"\n      rufSidemenuItem>\n      <mat-icon *ngIf=\"isMinimized()\" [fontIcon]=\"item.icon\"></mat-icon>\n      <ruf-labeled-icon *ngIf=\"!isMinimized()\" [fontIcon]=\"item.icon\" [ngClass]=\"{'sidemenu-item-with-no-icon': !item.icon}\">{{item.label}}\n      </ruf-labeled-icon>\n    </a>\n    <ng-container *ngIf=\"item.children && item.children.length > 0\">\n      <ng-container *ngIf=\"!isMinimized(); else minimizedTemplate\">\n        <a [rufId]=\"getRufId(item)\" [data]=\"item\" [path]=\"item.path\" rufSidemenuItem rufToggleChevron\n         #trigger=\"rufToggle\" (toggleChange)=\"toggleChildItems(trigger)\">\n          <ruf-labeled-icon [fontIcon]=\"item.icon\" [ngClass]=\"{'sidemenu-item-with-no-icon': !item.icon}\">{{item.label}}\n          </ruf-labeled-icon>\n        </a>\n        <ruf-sidemenu-children [rufId]=\"getRufId(item)+'_children'\" [visible]=\"trigger.value\"\n          [menuTrigger]=\"trigger\">\n          <a rufId *ngFor=\"let child of item.children\" [data]=\"child\" [path]=\"child.path\" rufSidemenuItem>\n            <ruf-labeled-icon [fontIcon]=\"child.icon\" [ngClass]=\"{'sidemenu-item-with-no-icon': !child.icon}\">{{child.label}}\n            </ruf-labeled-icon>\n          </a>\n        </ruf-sidemenu-children>\n      </ng-container>\n\n      <ng-template #minimizedTemplate>\n        <a [rufId]=\"getRufId(item)\"\n           [data]=\"item\"\n           [path]=\"item.path\"\n           rufSidemenuItem\n           #menuTrigger\n           [matMenuTriggerFor]=\"sideMenuPopup\"\n           (click)=\"setPopupData($event, item)\"\n           (keydown)=\"keyHandler($event)\">\n          <mat-icon [fontIcon]=\"item.icon\"></mat-icon>\n          <mat-icon fisIcon=\"arrow-down\" rufIconStyle=\"xs\" class=\"ruf-expand-sidemenu-popup-icon\"></mat-icon>\n      </a>\n      </ng-template>\n    </ng-container>\n\n  </ng-container>\n\n  <mat-menu #sideMenuPopup=\"matMenu\" overlapTrigger=\"true\" [class]=\"getOverlayClasses()\" (closed)=\"onPopupClose()\"\n    backdropClass=\"ruf-sidemenu-popup-backdrop\">\n    <ruf-sidemenu-children *ngIf=\"sideMenuPopupData\" rufId=\"ruf-sidemenu-children-items-popup\">\n      <p class=\"ruf-side-menu-popup-title\">{{sideMenuPopupData?.label}}</p>\n      <a rufId *ngFor=\"let child of sideMenuPopupData?.children\" [data]=\"child\" [path]=\"child.path\" (keydown.enter)=\"closeMenu()\"\n        rufSidemenuItem>\n        <span>{{child.label}}</span>\n    </a>\n    </ruf-sidemenu-children>\n  </mat-menu>\n</ruf-sidemenu>\n",
        encapsulation: ViewEncapsulation.None,
        styles: ["ruf-dynamic-sidemenu .sidemenu-item-with-no-icon .mat-icon{visibility:hidden;width:0}ruf-dynamic-sidemenu .sidemenu-item-with-no-icon span{margin-left:0}ruf-dynamic-sidemenu ruf-labeled-icon{white-space:normal}ruf-dynamic-sidemenu ruf-sidemenu.ruf-dynamic-sidemenu-minimized{box-shadow:none;min-width:auto}ruf-dynamic-sidemenu ruf-sidemenu.ruf-dynamic-sidemenu-minimized .ruf-menubar-layout.ruf-layout-column .ruf-menu-item{padding-right:0}.ruf-sidemenu-popup-backdrop+* .mat-menu-panel{border-radius:0;box-shadow:none}.ruf-sidemenu-popup-backdrop+* .mat-menu-panel.ruf-menubar-inkbar-start .ruf-menu-item{border-left-width:.25rem;border-left-style:solid}.ruf-sidemenu-popup-backdrop+* .mat-menu-panel.ruf-menubar-inkbar-end .ruf-menu-item{border-right-width:.25rem;border-right-style:solid}.ruf-sidemenu-popup-backdrop+* .mat-menu-panel .ruf-menu-item{padding-left:.9375rem;padding-right:.9375rem}.ruf-expand-sidemenu-popup-icon{-webkit-box-align:center;align-items:center;display:-webkit-box;display:flex}.ruf-side-menu-popup-title{padding-left:1.1875rem}"]
    }),
    tslib_1.__param(0, Inject(DOCUMENT)),
    tslib_1.__metadata("design:paramtypes", [Object, Renderer2,
        MediaObserver,
        ElementRef])
], RufDynamicSideMenuComponent);
export { RufDynamicSideMenuComponent };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZHluYW1pYy1zaWRlbWVudS5jb21wb25lbnQuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9AcnVmL3NoZWxsLyIsInNvdXJjZXMiOlsic3JjL2R5bmFtaWMtc2lkZW1lbnUvZHluYW1pYy1zaWRlbWVudS5jb21wb25lbnQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IjtBQUFBLE9BQU8sRUFDTCxTQUFTLEVBQ1QsaUJBQWlCLEVBRWpCLFVBQVUsRUFDVixTQUFTLEVBQ1QsWUFBWSxFQUNaLEtBQUssRUFDTCxNQUFNLEVBQ04sTUFBTSxFQUNOLFNBQVMsRUFFVCxZQUFZLEVBQ1osU0FBUyxFQUNWLE1BQU0sZUFBZSxDQUFDO0FBQ3ZCLE9BQU8sRUFBRSxhQUFhLEVBQUUsTUFBTSxzQkFBc0IsQ0FBQztBQUdyRCxPQUFPLEVBQUUsY0FBYyxFQUFFLE1BQU0sd0JBQXdCLENBQUM7QUFDeEQsT0FBTyxFQUFDLFFBQVEsRUFBQyxNQUFNLGlCQUFpQixDQUFDO0FBQ3pDLE9BQU8sRUFBRSxLQUFLLEVBQUUsS0FBSyxFQUFFLE1BQU0sdUJBQXVCLENBQUM7QUFVckQsSUFBYSwyQkFBMkIsR0FBeEMsTUFBYSwyQkFBMkI7SUFvQ3RDLFlBQzJCLFFBQVEsRUFDMUIsU0FBb0IsRUFDcEIsY0FBNkIsRUFDN0IsV0FBdUI7UUFITCxhQUFRLEdBQVIsUUFBUSxDQUFBO1FBQzFCLGNBQVMsR0FBVCxTQUFTLENBQVc7UUFDcEIsbUJBQWMsR0FBZCxjQUFjLENBQWU7UUFDN0IsZ0JBQVcsR0FBWCxXQUFXLENBQVk7UUF2Q3ZCLFVBQUssR0FBNkIsRUFBRSxDQUFDO1FBY3JCLG9CQUFlLEdBQUcsSUFBSSxDQUFDLGVBQWUsSUFBSSxPQUFPLENBQUM7UUFFM0QsVUFBSyxHQUFHLElBQUksQ0FBQztRQUVYLFlBQU8sR0FBRyxJQUFJLFlBQVksRUFBMEIsQ0FBQztRQUd2RSx1REFBdUQ7UUFDOUMsY0FBUyxHQUFHLEtBQUssQ0FBQztRQUNKLGdCQUFXLEdBQUcsS0FBSyxDQUFDO1FBQ3BC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QixLQUFLLENBQUMsY0FBYyxDQUFDOztnRUFBcUI7QUFDcEI7SUFBdEIsS0FBSyxDQUFDLGNBQWMsQ0FBQzs7Z0VBQXFCO0FBQ3BCO0lBQXRCLEtBQUssQ0FBQyxjQUFjLENBQUM7O2dFQUFxQjtBQUNwQjtJQUF0QixLQUFLLENBQUMsY0FBYyxDQUFDOztnRUFBcUI7QUFDcEI7SUFBdEIsS0FBSyxDQUFDLGNBQWMsQ0FBQzs7Z0VBQXFCO0FBRWpCO0lBQXpCLEtBQUssQ0FBQyxpQkFBaUIsQ0FBQzs7a0VBQXVCO0FBQ3RCO0lBQXpCLEtBQUssQ0FBQyxpQkFBaUIsQ0FBQzs7a0VBQXVCO0FBQ3RCO0lBQXpCLEtBQUssQ0FBQyxpQkFBaUIsQ0FBQzs7a0VBQXVCO0FBQ3RCO0lBQXpCLEtBQUssQ0FBQyxpQkFBaUIsQ0FBQzs7a0VBQXVCO0FBakNyQywyQkFBMkI7SUFOdkMsU0FBUyxDQUFDO1FBQ1QsUUFBUSxFQUFFLHNCQUFzQjtRQUNoQyxpNEZBQWdEO1FBRWhELGFBQWEsRUFBRSxpQkFBaUIsQ0FBQyxJQUFJOztLQUN0QyxDQUFDO0lBc0NFLG1CQUFBLE1BQU0sQ0FBQyxRQUFRLENBQUMsQ0FBQTtxREFDRSxTQUFTO1FBQ0osYUFBYTtRQUNoQixVQUFVO0dBeENyQiwyQkFBMkIsQ0FxSXZDO1NBcklZLDJCQUEyQiIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7XG4gIENvbXBvbmVudCxcbiAgVmlld0VuY2Fwc3VsYXRpb24sXG4gIENoYW5nZURldGVjdGlvblN0cmF0ZWd5LFxuICBFbGVtZW50UmVmLFxuICBSZW5kZXJlcjIsXG4gIEV2ZW50RW1pdHRlcixcbiAgSW5wdXQsXG4gIEluamVjdCxcbiAgT3V0cHV0LFxuICBWaWV3Q2hpbGQsXG4gIEhvc3RCaW5kaW5nLFxuICBWaWV3Q2hpbGRyZW4sXG4gIFF1ZXJ5TGlzdFxufSBmcm9tICdAYW5ndWxhci9jb3JlJztcbmltcG9ydCB7IE1lZGlhT2JzZXJ2ZXIgfSBmcm9tICdAYW5ndWxhci9mbGV4LWxheW91dCc7XG5cbmltcG9ydCB7IFJ1ZkR5bmFtaWNTaWRlbWVudUl0ZW0gfSBmcm9tICcuL2R5bmFtaWMtc2lkZW1lbnUtaXRlbSc7XG5pbXBvcnQgeyBNYXRNZW51VHJpZ2dlciB9IGZyb20gJ0Bhbmd1bGFyL21hdGVyaWFsL21lbnUnO1xuaW1wb3J0IHtET0NVTUVOVH0gZnJvbSAnQGFuZ3VsYXIvY29tbW9uJztcbmltcG9ydCB7IEVOVEVSLCBTUEFDRSB9IGZyb20gJ0Bhbmd1bGFyL2Nkay9rZXljb2Rlcyc7XG5pbXBvcnQgeyBSdWZNZW51YmFySXRlbSB9IGZyb20gJy4uL21lbnViYXIvL21lbnViYXItaXRlbS5jb21wb25lbnQnO1xuaW1wb3J0IHsgUnVmVG9nZ2xlRGlyZWN0aXZlIH0gZnJvbSAnLi4vdG9nZ2xlL3RvZ2dsZS5kaXJlY3RpdmUnO1xuXG5AQ29tcG9uZW50KHtcbiAgc2VsZWN0b3I6ICdydWYtZHluYW1pYy1zaWRlbWVudScsXG4gIHRlbXBsYXRlVXJsOiAnLi9keW5hbWljLXNpZGVtZW51LmNvbXBvbmVudC5odG1sJyxcbiAgc3R5bGVVcmxzOiBbJy4vZHluYW1pYy1zaWRlbWVudS5jb21wb25lbnQuc2NzcyddLFxuICBlbmNhcHN1bGF0aW9uOiBWaWV3RW5jYXBzdWxhdGlvbi5Ob25lXG59KVxuZXhwb3J0IGNsYXNzIFJ1ZkR5bmFtaWNTaWRlTWVudUNvbXBvbmVudCB7XG4gIEBJbnB1dCgpIGl0ZW1zOiBSdWZEeW5hbWljU2lkZW1lbnVJdGVtW10gPSBbXTtcbiAgQElucHV0KCkgcG9wdXBCYWNrZ3JvdW5kQ2xhc3M6IHN0cmluZ1xuICBzaWRlTWVudVBvcHVwRGF0YTogUnVmRHluYW1pY1NpZGVtZW51SXRlbTtcblxuICBAVmlld0NoaWxkKE1hdE1lbnVUcmlnZ2VyLCB7c3RhdGljOiBmYWxzZX0pIHB1YmxpYyBtZW51VHJpZ2dlcjogTWF0TWVudVRyaWdnZXI7XG4gIEBWaWV3Q2hpbGQoJ21lbnVUcmlnZ2VyJywge3N0YXRpYzogZmFsc2V9KSBwdWJsaWMgdHJpZ2dlcjogRWxlbWVudFJlZjtcblxuICAvKiB0c2xpbnQ6ZGlzYWJsZTpuby1pbnB1dC1yZW5hbWUgKi9cbiAgLyogdHNsaW50OmRpc2FibGU6bm8tb3V0cHV0LXJlbmFtZSAqL1xuXG4gIEBJbnB1dCgnc2VsZWN0ZWRQYXRoJykgX3NlbGVjdGVkUGF0aDogc3RyaW5nO1xuXG4gIEBJbnB1dCgnYWN0aXZlQ29sb3InKSBfYWN0aXZlQ29sb3I6IHN0cmluZztcblxuICBASW5wdXQoJ2lua2JhclBvc2l0aW9uJykgX2lua2JhclBvc2l0aW9uID0gdGhpcy5faW5rYmFyUG9zaXRpb24gfHwgJ3N0YXJ0JztcblxuICBASW5wdXQoJ211bHRpJykgbXVsdGkgPSB0cnVlO1xuXG4gIEBPdXRwdXQoJ3NlbGVjdCcpIF9zZWxlY3QgPSBuZXcgRXZlbnRFbWl0dGVyPFJ1ZkR5bmFtaWNTaWRlbWVudUl0ZW0+KCk7XG4gIEBWaWV3Q2hpbGRyZW4oJ3RyaWdnZXInKSBwcml2YXRlIF90cmlnZ2VyczogUXVlcnlMaXN0PFJ1ZlRvZ2dsZURpcmVjdGl2ZT47XG5cbiAgLy8gQEhvc3RCaW5kaW5nKCdjbGFzcy5ydWYtZHluYW1pYy1zaWRlbWVudS1taW5pbWl6ZWQnKVxuICBASW5wdXQoKSBtaW5pbWl6ZWQgPSBmYWxzZTtcbiAgQElucHV0KCdtaW5pbWl6ZWQueHMnKSBtaW5pbWl6ZWRYcyA9IGZhbHNlO1xuICBASW5wdXQoJ21pbmltaXplZC5zbScpIG1pbmltaXplZFNtID0gZmFsc2U7XG4gIEBJbnB1dCgnbWluaW1pemVkLm1kJykgbWluaW1pemVkTWQgPSBmYWxzZTtcbiAgQElucHV0KCdtaW5pbWl6ZWQubGcnKSBtaW5pbWl6ZWRMZyA9IGZhbHNlO1xuICBASW5wdXQoJ21pbmltaXplZC54bCcpIG1pbmltaXplZFhsID0gZmFsc2U7XG5cbiAgQElucHV0KCdtaW5pbWl6ZWQuZ3QteHMnKSBtaW5pbWl6ZWRHdFhzID0gZmFsc2U7XG4gIEBJbnB1dCgnbWluaW1pemVkLmd0LXNtJykgbWluaW1pemVkR3RTbSA9IGZhbHNlO1xuICBASW5wdXQoJ21pbmltaXplZC5ndC1tZCcpIG1pbmltaXplZEd0TWQgPSBmYWxzZTtcbiAgQElucHV0KCdtaW5pbWl6ZWQuZ3QtbGcnKSBtaW5pbWl6ZWRHdExnID0gZmFsc2U7XG5cblxuICBjb25zdHJ1Y3RvcihcbiAgIEBJbmplY3QoRE9DVU1FTlQpIHByaXZhdGUgZG9jdW1lbnQsXG4gICBwcml2YXRlIF9yZW5kZXJlcjogUmVuZGVyZXIyLFxuICAgcHJpdmF0ZSBfbWVkaWFPYnNlcnZlcjogTWVkaWFPYnNlcnZlcixcbiAgIHByaXZhdGUgX2VsZW1lbnRSZWY6IEVsZW1lbnRSZWYpIHtcblxuICB9XG5cblxuICBpc01pbmltaXplZCgpIHtcbiAgICByZXR1cm4gW1xuICAgICAgIHRoaXMubWluaW1pemVkLFxuICAgICAgIHRoaXMubWluaW1pemVkWHMgJiYgdGhpcy5fbWVkaWFPYnNlcnZlci5pc0FjdGl2ZSgneHMnKSxcbiAgICAgICB0aGlzLm1pbmltaXplZFNtICYmIHRoaXMuX21lZGlhT2JzZXJ2ZXIuaXNBY3RpdmUoJ3NtJyksXG4gICAgICAgdGhpcy5taW5pbWl6ZWRNZCAmJiB0aGlzLl9tZWRpYU9ic2VydmVyLmlzQWN0aXZlKCdtZCcpLFxuICAgICAgIHRoaXMubWluaW1pemVkTGcgJiYgdGhpcy5fbWVkaWFPYnNlcnZlci5pc0FjdGl2ZSgnbGcnKSxcbiAgICAgICB0aGlzLm1pbmltaXplZFhsICYmIHRoaXMuX21lZGlhT2JzZXJ2ZXIuaXNBY3RpdmUoJ3hsJyksXG4gICAgICAgdGhpcy5taW5pbWl6ZWRHdFhzICYmIHRoaXMuX21lZGlhT2JzZXJ2ZXIuaXNBY3RpdmUoJ2d0LXhzJyksXG4gICAgICAgdGhpcy5taW5pbWl6ZWRHdFNtICYmIHRoaXMuX21lZGlhT2JzZXJ2ZXIuaXNBY3RpdmUoJ2d0LXNtJyksXG4gICAgICAgdGhpcy5taW5pbWl6ZWRHdE1kICYmIHRoaXMuX21lZGlhT2JzZXJ2ZXIuaXNBY3RpdmUoJ2d0LW1kJyksXG4gICAgICAgdGhpcy5taW5pbWl6ZWRHdExnICYmIHRoaXMuX21lZGlhT2JzZXJ2ZXIuaXNBY3RpdmUoJ2d0LWxnJylcbiAgICAgIF0uc29tZSh4ID0+IHggPT09IHRydWUpO1xuICB9XG5cblxuICBvblNlbGVjdCgkZXZlbnQ6IFJ1Zk1lbnViYXJJdGVtKSB7XG4gICAgaWYgKCEoJGV2ZW50LmRhdGEgJiYgJGV2ZW50LmRhdGEuY2hpbGRyZW4pKSB7XG4gICAgICB0aGlzLl9zZWxlY3RlZFBhdGggPSAkZXZlbnQucGF0aDtcbiAgICAgIHRoaXMuX3NlbGVjdC5lbWl0KCRldmVudC5kYXRhKTtcbiAgICB9IGVsc2UgaWYgKCRldmVudCAmJiAkZXZlbnQuZXZlbnQpIHtcbiAgICAgICRldmVudC5ldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgJGV2ZW50LmV2ZW50LnN0b3BQcm9wYWdhdGlvbigpO1xuICAgIH1cbiAgfVxuXG4gIGdldFJ1ZklkKGl0ZW0pOiBzdHJpbmcgeyAvLyByZXR1cm4gaWQgZm9yIHNpZGVtZW51IGl0ZW1zLlxuICAgcmV0dXJuICdkeW5hbWljX3NpZGVtZW51XycgKyBpdGVtLmxhYmVsLnRvTG93ZXJDYXNlKCkucmVwbGFjZSgvIC9nLCAnXycpO1xuICB9XG5cbiAgY2xvc2VNZW51KCkge1xuICAgIHRoaXMubWVudVRyaWdnZXIuY2xvc2VNZW51KCk7XG4gIH1cblxuICBzZXRQb3B1cERhdGEoZXZlbnQsIGRhdGEpIHtcbiAgICB0aGlzLnNpZGVNZW51UG9wdXBEYXRhID0gZGF0YVxuICAgIGV2ZW50LmN1cnJlbnRUYXJnZXQuY2xhc3NMaXN0LmFkZCgncnVmLWFjdGl2ZScpXG4gICAgLy8gZm9jdXMgb24gdGhlIGZpcnN0IG1lbnUgaXRlbVxuICAgIHNldFRpbWVvdXQoKCkgPT4ge1xuICAgICAgY29uc3QgY2RrT3ZlcmxheUNsYXNzID0gYC5ydWYtc2lkZW1lbnUtcG9wdXAtYmFja2Ryb3AgKyAuY2RrLW92ZXJsYXktY29ubmVjdGVkLXBvc2l0aW9uLWJvdW5kaW5nLWJveGA7XG4gICAgICBjb25zdCBjZGtPdmVybGF5RWxlbWVudDogSFRNTEVsZW1lbnQgPSB0aGlzLmRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoY2RrT3ZlcmxheUNsYXNzKTtcbiAgICAgIGlmIChjZGtPdmVybGF5RWxlbWVudCkge1xuICAgICAgICAvLyBzZXQgbGVmdCBwb3NpdGlvbiBmb3IgY2RrT3ZlcmxheSBiYXNlZCBvbiB0aGUgcG9zaXRpb24gb2YgbWVudWl0ZW0uXG4gICAgICAgIC8vIHNvIHdlIG5lZWQgdG8gZ2V0IGxlZnQgYW5kIHdpZHRoIHZhbHVlIGZyb20gQm91bmRpbmdDbGllbnRSZWN0O1xuICAgICAgICBjb25zdCBydWZNZW51SXRlbSA9IHRoaXMuX2VsZW1lbnRSZWYubmF0aXZlRWxlbWVudC5xdWVyeVNlbGVjdG9yKCcucnVmLW1lbnUtaXRlbScpO1xuICAgICAgICBjb25zdCBydWZNZW51SXRlbUNsaWVudFRlY3QgPSAgIHJ1Zk1lbnVJdGVtLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpO1xuICAgICAgICBjZGtPdmVybGF5RWxlbWVudC5zdHlsZS5sZWZ0ID0gcnVmTWVudUl0ZW1DbGllbnRUZWN0LmxlZnQgKyBydWZNZW51SXRlbUNsaWVudFRlY3Qud2lkdGggKyAncHgnO1xuICAgICAgICBjb25zdCBmaXJzdE1lbnVJdGVtOiBIVE1MRWxlbWVudCA9IHRoaXMuZG9jdW1lbnQucXVlcnlTZWxlY3RvcihgJHtjZGtPdmVybGF5Q2xhc3N9IC5ydWYtbWVudS1pdGVtYCk7XG4gICAgICAgIGlmIChmaXJzdE1lbnVJdGVtKSB7XG4gICAgICAgICAgZmlyc3RNZW51SXRlbS5mb2N1cygpO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfSk7XG4gIH1cblxuICBvblBvcHVwQ2xvc2UoKSB7XG4gICAgLy8gcmVtb3ZlIGFjdGl2ZSBjbGFzcyB3aGVuIHBvcG9wIGlzIGNsb3NlZFxuICAgIGNvbnN0IGN1cnJlbnRBY3RpdmVJdGVtICA9IHRoaXMuX2VsZW1lbnRSZWYubmF0aXZlRWxlbWVudC5xdWVyeVNlbGVjdG9yKCcucnVmLW1lbnUtaXRlbS5ydWYtYWN0aXZlJyk7XG4gICAgaWYgKGN1cnJlbnRBY3RpdmVJdGVtKSB7XG4gICAgICBjdXJyZW50QWN0aXZlSXRlbS5mb2N1cygpO1xuICAgICAgdGhpcy5fcmVuZGVyZXIucmVtb3ZlQ2xhc3MoY3VycmVudEFjdGl2ZUl0ZW0sICdydWYtYWN0aXZlJyk7XG4gICAgfVxuICB9XG5cbiAga2V5SGFuZGxlcihldmVudCkge1xuICAgIHN3aXRjaCAoZXZlbnQua2V5Q29kZSkge1xuICAgICAgY2FzZSBFTlRFUjpcbiAgICAgIGNhc2UgU1BBQ0U6XG4gICAgICAgIGV2ZW50LmN1cnJlbnRUYXJnZXQuY2xpY2soKTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBkZWZhdWx0OlxuICAgIH1cbiAgfVxuXG4gIGdldE92ZXJsYXlDbGFzc2VzKCkge1xuICAgIGNvbnN0IGNvbG9yQ2xhc3MgPSAgdGhpcy5fYWN0aXZlQ29sb3IgPyBgcnVmLSR7dGhpcy5fYWN0aXZlQ29sb3J9YCA6IGBgO1xuICAgIHJldHVybiBgJHt0aGlzLnBvcHVwQmFja2dyb3VuZENsYXNzfSAke2NvbG9yQ2xhc3N9IHJ1Zi1tZW51YmFyLWlua2Jhci0ke3RoaXMuX2lua2JhclBvc2l0aW9ufWA7XG4gIH1cblxuICB0b2dnbGVDaGlsZEl0ZW1zKGN1cnJlbnRUcmlnZ2VyOiBSdWZUb2dnbGVEaXJlY3RpdmUpOiB2b2lkIHtcbiAgICBpZiAodGhpcy5tdWx0aSA9PT0gZmFsc2UpIHtcbiAgICAgIHRoaXMuX3RyaWdnZXJzLnRvQXJyYXkoKVxuICAgICAgLmZpbHRlcigoZWxlbWVudDogUnVmVG9nZ2xlRGlyZWN0aXZlKSA9PiBlbGVtZW50LnZhbHVlID09PSB0cnVlICYmIGVsZW1lbnQgIT09IGN1cnJlbnRUcmlnZ2VyKVxuICAgICAgLmZvckVhY2goKGVsZW1lbnQ6IGFueSkgPT4ge1xuICAgICAgICBlbGVtZW50LnZhbHVlID0gZmFsc2U7XG4gICAgICB9KTtcbiAgICB9XG4gIH1cbn1cbiJdfQ==