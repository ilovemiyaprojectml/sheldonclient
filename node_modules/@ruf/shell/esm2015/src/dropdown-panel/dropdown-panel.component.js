import * as tslib_1 from "tslib";
import { Component, EventEmitter, HostListener, TemplateRef, ViewEncapsulation, Input, Output, ViewChild, ViewContainerRef } from '@angular/core';
import { TemplatePortal } from '@angular/cdk/portal';
import { ENTER, SPACE, ESCAPE } from '@angular/cdk/keycodes';
import { Overlay, CdkOverlayOrigin } from '@angular/cdk/overlay';
export var RufDropdownType;
(function (RufDropdownType) {
    RufDropdownType["PopoverMenu"] = "popover-menu";
    RufDropdownType["ContextMenu"] = "context-menu";
    RufDropdownType["Dropdown"] = "dropdown";
})(RufDropdownType || (RufDropdownType = {}));
;
let RufDropdownPanelComponent = class RufDropdownPanelComponent {
    constructor(_overlay, _viewContainerRef) {
        this._overlay = _overlay;
        this._viewContainerRef = _viewContainerRef;
        this.hasBackdrop = true;
        this.openedChange = new EventEmitter();
        this.type = RufDropdownType.Dropdown;
        this.xPosition = 'center';
        this.yPosition = 'bottom';
        this.className = 'ruf-dropdown-panel-container';
        this.toggle = new EventEmitter();
    }
    ngOnChanges(changes) {
        if (changes &&
            changes.hasBackdrop &&
            changes.hasBackdrop.previousValue !== changes.hasBackdrop.currentValue) {
            // when value is changes for hasBackdrop set value null for overlay
            // so that it will create new overlay with updated backdrop value
            if (this._overlayRef) {
                this._overlayRef.detach();
                this._overlayRef = null;
            }
        }
    }
    open() {
        const origin = this._getOrigin();
        const overlay = this._getOverlayPosition();
        if (!this._overlayRef) {
            let positionStrategy;
            positionStrategy = this._overlay.position()
                .flexibleConnectedTo(this.origin.elementRef)
                .withPositions([
                Object.assign({}, origin.main, overlay.main),
                Object.assign({}, origin.fallback, overlay.fallback)
            ]);
            this.onPositionChanged({
                connectionPair: {
                    overlayX: overlay.main.overlayX,
                    overlayY: overlay.main.overlayY
                }
            });
            positionStrategy.positionChanges.subscribe(change => {
                this.onPositionChanged(change);
            });
            this._overlayRef = this._overlay.create({
                hasBackdrop: this.hasBackdrop,
                backdropClass: 'ruf-dropdown-panel-wrapper',
                positionStrategy
            });
            this._overlayRef.backdropClick().subscribe(() => this.close());
            this._portal = new TemplatePortal(this.content, this._viewContainerRef);
        }
        if (!this._overlayRef.hasAttached()) {
            this._overlayRef.attach(this._portal);
            this.opened = true;
            this.toggle.emit(true);
        }
        else {
            this.close();
            this.toggle.emit(false);
        }
    }
    ;
    _getOrigin() {
        let originPosition;
        originPosition = this._getPositionStrategy(this._getOriginValues(), this._getOverlayPositionValues()).originPosition;
        const { x, y } = this._invertPosition(originPosition.originX, originPosition.originY);
        if (this.type === RufDropdownType.PopoverMenu || this.type === RufDropdownType.ContextMenu) {
            return {
                main: originPosition,
                fallback: { originX: x, originY: y }
            };
        }
        else {
            return {
                main: { originX: 'start', originY: 'bottom' },
                fallback: { originX: 'end', originY: 'top' }
            };
        }
    }
    _getOverlayPosition() {
        const XPosition = this.xPosition;
        const YPosition = this.yPosition;
        let overlayPosition;
        overlayPosition = this._getPositionStrategy(this._getOriginValues(), this._getOverlayPositionValues()).overlayPosition;
        const { x, y } = this._invertPosition(overlayPosition.overlayX, overlayPosition.overlayY);
        if (this.type === RufDropdownType.PopoverMenu || this.type === RufDropdownType.ContextMenu) {
            return {
                main: overlayPosition,
                fallback: { overlayX: x, overlayY: y }
            };
        }
        else {
            return {
                main: { overlayX: 'start', overlayY: 'top' },
                fallback: { overlayX: 'end', overlayY: 'bottom' }
            };
        }
    }
    _getOriginValues() {
        const xCenterYBottom = { originX: 'center', originY: 'bottom' };
        const xCenterYTop = { originX: 'center', originY: 'top' };
        const xStartYBottom = { originX: 'start', originY: 'bottom' };
        const xStartYTop = { originX: 'start', originY: 'top' };
        const xStartYCenter = { originX: 'start', originY: 'center' };
        const xEndYBottom = { originX: 'end', originY: 'bottom' };
        const xEndYTop = { originX: 'end', originY: 'top' };
        const xEndYCenter = { originX: 'end', originY: 'center' };
        return {
            xCenterYBottom: xCenterYBottom,
            xCenterYTop: xCenterYTop,
            xStartYBottom: xStartYBottom,
            xStartYTop: xStartYTop,
            xStartYCenter: xStartYCenter,
            xEndYBottom: xEndYBottom,
            xEndYTop: xEndYTop,
            xEndYCenter: xEndYCenter
        };
    }
    _getOverlayPositionValues() {
        const xCenterYTop = { overlayX: 'center', overlayY: 'top' };
        const xCenterYBottom = { overlayX: 'center', overlayY: 'bottom' };
        const xStartYTop = { overlayX: 'start', overlayY: 'top' };
        const xStartYBottom = { overlayX: 'start', overlayY: 'bottom' };
        const xStartYCenter = { overlayX: 'start', overlayY: 'center' };
        const xEndYTop = { overlayX: 'end', overlayY: 'top' };
        const xEndYBottom = { overlayX: 'end', overlayY: 'bottom' };
        const xEndYCenter = { overlayX: 'end', overlayY: 'center' };
        return {
            xCenterYTop: xCenterYTop,
            xCenterYBottom: xCenterYBottom,
            xStartYTop: xStartYTop,
            xStartYBottom: xStartYBottom,
            xStartYCenter: xStartYCenter,
            xEndYTop: xEndYTop,
            xEndYBottom: xEndYBottom,
            xEndYCenter: xEndYCenter
        };
    }
    _getPositionStrategy(origin, overlay) {
        let originPosition = origin.xCenterYBottom;
        let overlayPosition = overlay.xCenterYTop;
        if (this.xPosition === 'start') {
            if (this.yPosition === 'top') {
                originPosition = origin.xStartYTop;
                overlayPosition = overlay.xStartYBottom;
            }
            else if (this.yPosition === 'center' && this.type === RufDropdownType.PopoverMenu) {
                originPosition = origin.xStartYCenter;
                overlayPosition = overlay.xEndYCenter;
            }
            else if (this.yPosition === 'bottom' || (this.yPosition === 'center' && this.type === RufDropdownType.ContextMenu)) {
                originPosition = origin.xStartYBottom;
                overlayPosition = overlay.xStartYTop;
            }
        }
        else if (this.xPosition === 'end') {
            if (this.yPosition === 'top') {
                originPosition = origin.xEndYTop;
                overlayPosition = overlay.xEndYBottom;
            }
            else if (this.yPosition === 'center' && this.type === RufDropdownType.PopoverMenu) {
                originPosition = origin.xEndYCenter;
                overlayPosition = overlay.xStartYCenter;
            }
            else if (this.yPosition === 'bottom' || (this.yPosition === 'center' && this.type === RufDropdownType.ContextMenu)) {
                originPosition = origin.xEndYBottom;
                overlayPosition = overlay.xEndYTop;
            }
        }
        else if (this.xPosition === 'center') {
            originPosition = this.yPosition === 'top' ? origin.xCenterYTop : origin.xCenterYBottom;
            overlayPosition = this.yPosition === 'top' ? overlay.xCenterYBottom : overlay.xCenterYTop;
        }
        return {
            originPosition: originPosition,
            overlayPosition: overlayPosition
        };
    }
    _invertPosition(x, y) {
        if (x === 'start') {
            x = 'end';
        }
        else if (x === 'end') {
            x = 'start';
        }
        if (y === 'top') {
            y = 'bottom';
        }
        else if (y === 'bottom') {
            y = 'top';
        }
        return { x, y };
    }
    onPositionChanged($event) {
        if (this.type === RufDropdownType.PopoverMenu || this.type === RufDropdownType.ContextMenu) {
            if ($event.connectionPair.overlayY === 'top') {
                if ($event.connectionPair.overlayX === 'center') {
                    this.className = 'ruf-dropdown-panel-container ruf-popover-menu center-arrow-up';
                }
                else if ($event.connectionPair.overlayX === 'start') {
                    this.className = 'ruf-dropdown-panel-container ruf-popover-menu left-arrow-up';
                }
                else {
                    this.className = 'ruf-dropdown-panel-container ruf-popover-menu right-arrow-up';
                }
            }
            else if ($event.connectionPair.overlayY === 'center') {
                if ($event.connectionPair.overlayX === 'start') {
                    this.className = 'ruf-dropdown-panel-container ruf-popover-menu right-arrow-center';
                }
                else {
                    this.className = 'ruf-dropdown-panel-container ruf-popover-menu left-arrow-center';
                }
            }
            else {
                if ($event.connectionPair.overlayX === 'center') {
                    this.className = 'ruf-dropdown-panel-container ruf-popover-menu center-arrow-down';
                }
                else if ($event.connectionPair.overlayX === 'start') {
                    this.className = 'ruf-dropdown-panel-container ruf-popover-menu left-arrow-down';
                }
                else {
                    this.className = 'ruf-dropdown-panel-container ruf-popover-menu right-arrow-down';
                }
            }
        }
        else if (this.type === RufDropdownType.Dropdown) {
            this.className = 'ruf-dropdown-panel-container';
        }
    }
    close() {
        if (this.opened) {
            this.opened = false;
            this._overlayRef.detach();
            this.openedChange.emit(this.opened);
        }
    }
    hasPopup() {
        return true;
    }
    handleKeydown(event) {
        switch (event.keyCode) {
            case SPACE:
            case ENTER:
                this.open();
                event.preventDefault();
                event.stopPropagation();
                this.toggle.emit(true);
                break;
            case ESCAPE:
                this.close();
                this.toggle.emit(false);
                event.stopPropagation();
                break;
            default:
        }
    }
    handleClick(event) {
        this.open();
    }
};
tslib_1.__decorate([
    Input(),
    tslib_1.__metadata("design:type", CdkOverlayOrigin)
], RufDropdownPanelComponent.prototype, "origin", void 0);
tslib_1.__decorate([
    Input(),
    tslib_1.__metadata("design:type", Boolean)
], RufDropdownPanelComponent.prototype, "opened", void 0);
tslib_1.__decorate([
    Input(),
    tslib_1.__metadata("design:type", Object)
], RufDropdownPanelComponent.prototype, "hasBackdrop", void 0);
tslib_1.__decorate([
    Output(),
    tslib_1.__metadata("design:type", EventEmitter)
], RufDropdownPanelComponent.prototype, "openedChange", void 0);
tslib_1.__decorate([
    Input(),
    tslib_1.__metadata("design:type", Object)
], RufDropdownPanelComponent.prototype, "type", void 0);
tslib_1.__decorate([
    Input(),
    tslib_1.__metadata("design:type", Object)
], RufDropdownPanelComponent.prototype, "xPosition", void 0);
tslib_1.__decorate([
    Input(),
    tslib_1.__metadata("design:type", Object)
], RufDropdownPanelComponent.prototype, "yPosition", void 0);
tslib_1.__decorate([
    Input(),
    tslib_1.__metadata("design:type", Boolean)
], RufDropdownPanelComponent.prototype, "closeIcon", void 0);
tslib_1.__decorate([
    ViewChild(TemplateRef, { static: false }),
    tslib_1.__metadata("design:type", TemplateRef)
], RufDropdownPanelComponent.prototype, "content", void 0);
tslib_1.__decorate([
    Output(),
    tslib_1.__metadata("design:type", Object)
], RufDropdownPanelComponent.prototype, "toggle", void 0);
tslib_1.__decorate([
    HostListener('click', ['$event']),
    tslib_1.__metadata("design:type", Function),
    tslib_1.__metadata("design:paramtypes", [Object]),
    tslib_1.__metadata("design:returntype", void 0)
], RufDropdownPanelComponent.prototype, "handleClick", null);
RufDropdownPanelComponent = tslib_1.__decorate([
    Component({
        selector: 'ruf-dropdown-panel',
        template: "<ng-template>\n <div [ngClass]=\"className\">\n      <div *ngIf=\"closeIcon\">\n        <button type=\"button\" mat-icon-button class=\"dropdown-panel-close-icon\" (keydown.enter)=\"close()\" (keydown.space)=\"close()\" (click)=\"close()\" rufIconButton>\n          <mat-icon rufIconStyle=\"sm\" rufId fisIcon=\"close\"></mat-icon>\n        </button>\n        <br>\n      </div>\n      <div [ngClass]=\"{'dropdown-panel-content': closeIcon}\">\n        <ng-content></ng-content>\n      </div>\n    </div>\n </ng-template>\n",
        encapsulation: ViewEncapsulation.None,
        styles: [".center-arrow-down:after,.center-arrow-down:before,.center-arrow-up:after,.center-arrow-up:before,.left-arrow-center:after,.left-arrow-center:before,.left-arrow-down:after,.left-arrow-down:before,.left-arrow-up:after,.left-arrow-up:before,.right-arrow-center:after,.right-arrow-center:before,.right-arrow-down:after,.right-arrow-down:before,.right-arrow-up:after,.right-arrow-up:before{border-style:solid;content:'';height:0;position:absolute;width:0;z-index:9999}.left-arrow-up{margin-top:.625rem;position:relative}.left-arrow-up:after,.left-arrow-up:before{bottom:100%;right:91%}.left-arrow-up:after{border-width:.625rem;margin-right:-.625rem}.left-arrow-up:before{border-width:.75rem;margin-right:-.75rem}.left-arrow-center{margin-right:.625rem;position:relative}.left-arrow-center:after,.left-arrow-center:before{bottom:50%;left:100%}.left-arrow-center:after{border-width:.625rem;margin-bottom:-.625rem}.left-arrow-center:before{border-width:.75rem;margin-bottom:-.75rem}.left-arrow-down{margin-bottom:.625rem;position:relative}.left-arrow-down:after,.left-arrow-down:before{right:91%;top:100%}.left-arrow-down:after{border-width:.625rem;margin-right:-.625rem}.left-arrow-down:before{border-width:.75rem;margin-right:-.75rem}.right-arrow-up{margin-top:.625rem;position:relative}.right-arrow-up:after,.right-arrow-up:before{bottom:100%;right:9%}.right-arrow-up:after{border-width:.625rem;margin-right:-.625rem}.right-arrow-up:before{border-width:.75rem;margin-right:-.75rem}.right-arrow-center{margin-left:.625rem;position:relative}.right-arrow-center:after,.right-arrow-center:before{right:100%;top:50%}.right-arrow-center:after{border-width:.625rem;margin-top:-.625rem}.right-arrow-center:before{border-width:.75rem;margin-top:-.75rem}.right-arrow-down{margin-bottom:.5rem;position:relative}.right-arrow-down:after,.right-arrow-down:before{right:9%;top:100%}.right-arrow-down:after{border-width:.625rem;margin-right:-.625rem}.right-arrow-down:before{border-width:.75rem;margin-right:-.75rem}.center-arrow-up{margin-top:.625rem;position:relative}.center-arrow-up:after,.center-arrow-up:before{bottom:100%;right:50%}.center-arrow-up:after{border-width:.625rem;margin-right:-.625rem}.center-arrow-up:before{border-width:.75rem;margin-right:-.75rem}.center-arrow-down{margin-bottom:.625rem;position:relative}.center-arrow-down:after,.center-arrow-down:before{left:50%;top:100%}.center-arrow-down:after{border-width:.625rem;margin-left:-.625rem}.center-arrow-down:before{border-width:.75rem;margin-left:-.75rem}.dropdown-panel-close-icon{float:right;opacity:.2}.dropdown-panel-close-icon:hover{cursor:pointer}.dropdown-panel-content{margin-right:1.25rem;margin-top:.5rem}.ruf-popover-menu{border-radius:.1875rem;border-style:solid;border-width:.0625rem}"]
    }),
    tslib_1.__metadata("design:paramtypes", [Overlay,
        ViewContainerRef])
], RufDropdownPanelComponent);
export { RufDropdownPanelComponent };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZHJvcGRvd24tcGFuZWwuY29tcG9uZW50LmpzIiwic291cmNlUm9vdCI6Im5nOi8vQHJ1Zi9zaGVsbC8iLCJzb3VyY2VzIjpbInNyYy9kcm9wZG93bi1wYW5lbC9kcm9wZG93bi1wYW5lbC5jb21wb25lbnQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IjtBQUFBLE9BQU8sRUFDTCxTQUFTLEVBQ1QsWUFBWSxFQUNaLFlBQVksRUFDWixXQUFXLEVBQ1gsaUJBQWlCLEVBQ2pCLEtBQUssRUFDTCxNQUFNLEVBQ04sU0FBUyxFQUNULGdCQUFnQixFQUdqQixNQUFNLGVBQWUsQ0FBQztBQUN2QixPQUFPLEVBQUUsY0FBYyxFQUFFLE1BQU0scUJBQXFCLENBQUM7QUFDckQsT0FBTyxFQUFFLEtBQUssRUFBRSxLQUFLLEVBQUUsTUFBTSxFQUFFLE1BQU0sdUJBQXVCLENBQUM7QUFDN0QsT0FBTyxFQUFFLE9BQU8sRUFLUCxnQkFBZ0IsRUFFTSxNQUFNLHNCQUFzQixDQUFDO0FBSTVELE1BQU0sQ0FBTixJQUFZLGVBSVg7QUFKRCxXQUFZLGVBQWU7SUFDekIsK0NBQTRCLENBQUE7SUFDNUIsK0NBQTRCLENBQUE7SUFDNUIsd0NBQXFCLENBQUE7QUFDdkIsQ0FBQyxFQUpXLGVBQWUsS0FBZixlQUFlLFFBSTFCO0FBQUEsQ0FBQztBQVFGLElBQWEseUJBQXlCLEdBQXRDLE1BQWEseUJBQXlCO0lBZXBDLFlBQW9CLFFBQWlCLEVBQ2pCLGlCQUFtQztRQURuQyxhQUFRLEdBQVIsUUFBUSxDQUFTO1FBQ2pCLHNCQUFpQixHQUFqQixpQkFBaUIsQ0FBa0I7UUFiOUMsZ0JBQVcsR0FBRyxJQUFJLENBQUM7UUFDbEIsaUJBQVksR0FBMEIsSUFBSSxZQUFZLEVBQVcsQ0FBQztRQUNuRSxTQUFJLEdBQUcsZUFBZSxDQUFDLFFBQVEsQ0FBQztRQUNoQyxjQUFTLEdBQUcsUUFBUSxDQUFDO1FBQ3JCLGNBQVMsR0FBRyxRQUFRLENBQUM7UUFDOUIsY0FBUyxHQUFHLDhCQUE4QixDQUFDO1FBS2pDLFdBQU0sR0FBRyxJQUFJLFlBQVksRUFBVyxDQUFDO0lBR1csQ0FBQztJQUU1RCxXQUFXLENBQUMsT0FBc0I7UUFDakMsSUFBSSxPQUFPO1lBQ1AsT0FBTyxDQUFDLFdBQVc7WUFDbkIsT0FBTyxDQUFDLFdBQVcsQ0FBQyxhQUFhLEtBQUssT0FBTyxDQUFDLFdBQVcsQ0FBQyxZQUFZLEVBQUU7WUFDMUUsbUVBQW1FO1lBQ25FLGlFQUFpRTtZQUNqRSxJQUFJLElBQUksQ0FBQyxXQUFXLEVBQUU7Z0JBQ3BCLElBQUksQ0FBQyxXQUFXLENBQUMsTUFBTSxFQUFFLENBQUM7Z0JBQzFCLElBQUksQ0FBQyxXQUFXLEdBQUcsSUFBSSxDQUFDO2FBQ3pCO1NBQ0Y7SUFDRixDQUFDO0lBRUEsSUFBSTtRQUNGLE1BQU0sTUFBTSxHQUFHLElBQUksQ0FBQyxVQUFVLEVBQUUsQ0FBQztRQUNqQyxNQUFNLE9BQU8sR0FBRyxJQUFJLENBQUMsbUJBQW1CLEVBQUUsQ0FBQztRQUUzQyxJQUFJLENBQUMsSUFBSSxDQUFDLFdBQVcsRUFBRTtZQUNyQixJQUFJLGdCQUFtRCxDQUFDO1lBQ3hELGdCQUFnQixHQUFHLElBQUksQ0FBQyxRQUFRLENBQUMsUUFBUSxFQUFFO2lCQUN4QyxtQkFBbUIsQ0FBQyxJQUFJLENBQUMsTUFBTSxDQUFDLFVBQVUsQ0FBQztpQkFDM0MsYUFBYSxDQUFDO2tDQUNSLE1BQU0sQ0FBQyxJQUFJLEVBQUssT0FBTyxDQUFDLElBQUk7a0NBQzdCLE1BQU0sQ0FBQyxRQUFRLEVBQUssT0FBTyxDQUFDLFFBQVE7YUFDekMsQ0FBQyxDQUFDO1lBRUwsSUFBSSxDQUFDLGlCQUFpQixDQUFDO2dCQUNyQixjQUFjLEVBQUU7b0JBQ2QsUUFBUSxFQUFFLE9BQU8sQ0FBQyxJQUFJLENBQUMsUUFBUTtvQkFDL0IsUUFBUSxFQUFFLE9BQU8sQ0FBQyxJQUFJLENBQUMsUUFBUTtpQkFDaEM7YUFDRixDQUFDLENBQUM7WUFFSCxnQkFBZ0IsQ0FBQyxlQUFlLENBQUMsU0FBUyxDQUFDLE1BQU0sQ0FBQyxFQUFFO2dCQUNsRCxJQUFJLENBQUMsaUJBQWlCLENBQUMsTUFBTSxDQUFDLENBQUM7WUFDakMsQ0FBQyxDQUFDLENBQUM7WUFFSCxJQUFJLENBQUMsV0FBVyxHQUFHLElBQUksQ0FBQyxRQUFRLENBQUMsTUFBTSxDQUFDO2dCQUN0QyxXQUFXLEVBQUUsSUFBSSxDQUFDLFdBQVc7Z0JBQzdCLGFBQWEsRUFBRSw0QkFBNEI7Z0JBQzNDLGdCQUFnQjthQUNqQixDQUFDLENBQUM7WUFFSCxJQUFJLENBQUMsV0FBVyxDQUFDLGFBQWEsRUFBRSxDQUFDLFNBQVMsQ0FBQyxHQUFHLEVBQUUsQ0FBQyxJQUFJLENBQUMsS0FBSyxFQUFFLENBQUMsQ0FBQztZQUMvRCxJQUFJLENBQUMsT0FBTyxHQUFHLElBQUksY0FBYyxDQUFDLElBQUksQ0FBQyxPQUFPLEVBQUUsSUFBSSxDQUFDLGlCQUFpQixDQUFDLENBQUM7U0FDekU7UUFFRCxJQUFJLENBQUMsSUFBSSxDQUFDLFdBQVcsQ0FBQyxXQUFXLEVBQUUsRUFBRTtZQUNuQyxJQUFJLENBQUMsV0FBVyxDQUFDLE1BQU0sQ0FBQyxJQUFJLENBQUMsT0FBTyxDQUFDLENBQUM7WUFDdEMsSUFBSSxDQUFDLE1BQU0sR0FBRyxJQUFJLENBQUM7WUFDbkIsSUFBSSxDQUFDLE1BQU0sQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUM7U0FDeEI7YUFBTTtZQUNMLElBQUksQ0FBQyxLQUFLLEVBQUUsQ0FBQztZQUNiLElBQUksQ0FBQyxNQUFNLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxDQUFDO1NBQ3pCO0lBQ0gsQ0FBQztJQUFBLENBQUM7SUFFRixVQUFVO1FBQ1IsSUFBSSxjQUF3QyxDQUFDO1FBQzdDLGNBQWMsR0FBRyxJQUFJLENBQUMsb0JBQW9CLENBQUMsSUFBSSxDQUFDLGdCQUFnQixFQUFFLEVBQUUsSUFBSSxDQUFDLHlCQUF5QixFQUFFLENBQUMsQ0FBQyxjQUFjLENBQUM7UUFDckgsTUFBTSxFQUFDLENBQUMsRUFBRSxDQUFDLEVBQUMsR0FBRyxJQUFJLENBQUMsZUFBZSxDQUFDLGNBQWMsQ0FBQyxPQUFPLEVBQUUsY0FBYyxDQUFDLE9BQU8sQ0FBQyxDQUFDO1FBQ3BGLElBQUksSUFBSSxDQUFDLElBQUksS0FBSyxlQUFlLENBQUMsV0FBVyxJQUFJLElBQUksQ0FBQyxJQUFJLEtBQUssZUFBZSxDQUFDLFdBQVcsRUFBRTtZQUMxRixPQUFPO2dCQUNMLElBQUksRUFBRSxjQUFjO2dCQUNwQixRQUFRLEVBQUUsRUFBQyxPQUFPLEVBQUUsQ0FBQyxFQUFFLE9BQU8sRUFBRSxDQUFDLEVBQUM7YUFDbkMsQ0FBQTtTQUNGO2FBQU07WUFDTCxPQUFPO2dCQUNMLElBQUksRUFBRSxFQUFDLE9BQU8sRUFBRSxPQUFPLEVBQUUsT0FBTyxFQUFFLFFBQVEsRUFBQztnQkFDM0MsUUFBUSxFQUFFLEVBQUMsT0FBTyxFQUFFLEtBQUssRUFBRSxPQUFPLEVBQUUsS0FBSyxFQUFDO2FBQzNDLENBQUE7U0FDRjtJQUNILENBQUM7SUFFRCxtQkFBbUI7UUFDakIsTUFBTSxTQUFTLEdBQUcsSUFBSSxDQUFDLFNBQVMsQ0FBQztRQUNqQyxNQUFNLFNBQVMsR0FBRyxJQUFJLENBQUMsU0FBUyxDQUFDO1FBQ2pDLElBQUksZUFBMEMsQ0FBQztRQUMvQyxlQUFlLEdBQUcsSUFBSSxDQUFDLG9CQUFvQixDQUFDLElBQUksQ0FBQyxnQkFBZ0IsRUFBRSxFQUFFLElBQUksQ0FBQyx5QkFBeUIsRUFBRSxDQUFDLENBQUMsZUFBZSxDQUFDO1FBQ3ZILE1BQU0sRUFBQyxDQUFDLEVBQUUsQ0FBQyxFQUFDLEdBQUcsSUFBSSxDQUFDLGVBQWUsQ0FBQyxlQUFlLENBQUMsUUFBUSxFQUFFLGVBQWUsQ0FBQyxRQUFRLENBQUMsQ0FBQztRQUN4RixJQUFJLElBQUksQ0FBQyxJQUFJLEtBQUssZUFBZSxDQUFDLFdBQVcsSUFBSSxJQUFJLENBQUMsSUFBSSxLQUFLLGVBQWUsQ0FBQyxXQUFXLEVBQUU7WUFDMUYsT0FBTztnQkFDTCxJQUFJLEVBQUUsZUFBZTtnQkFDckIsUUFBUSxFQUFFLEVBQUMsUUFBUSxFQUFFLENBQUMsRUFBRSxRQUFRLEVBQUUsQ0FBQyxFQUFDO2FBQ3JDLENBQUE7U0FDRjthQUFNO1lBQ0wsT0FBTztnQkFDTCxJQUFJLEVBQUUsRUFBQyxRQUFRLEVBQUUsT0FBTyxFQUFFLFFBQVEsRUFBRSxLQUFLLEVBQUM7Z0JBQzFDLFFBQVEsRUFBRSxFQUFDLFFBQVEsRUFBRSxLQUFLLEVBQUUsUUFBUSxFQUFFLFFBQVEsRUFBQzthQUNoRCxDQUFBO1NBQ0Y7SUFDSCxDQUFDO0lBRUQsZ0JBQWdCO1FBR2QsTUFBTSxjQUFjLEdBQTZCLEVBQUMsT0FBTyxFQUFFLFFBQVEsRUFBRSxPQUFPLEVBQUUsUUFBUSxFQUFDLENBQUM7UUFDeEYsTUFBTSxXQUFXLEdBQTZCLEVBQUMsT0FBTyxFQUFFLFFBQVEsRUFBRSxPQUFPLEVBQUUsS0FBSyxFQUFDLENBQUM7UUFDbEYsTUFBTSxhQUFhLEdBQTZCLEVBQUMsT0FBTyxFQUFFLE9BQU8sRUFBRSxPQUFPLEVBQUUsUUFBUSxFQUFDLENBQUM7UUFDdEYsTUFBTSxVQUFVLEdBQTZCLEVBQUMsT0FBTyxFQUFFLE9BQU8sRUFBRSxPQUFPLEVBQUUsS0FBSyxFQUFDLENBQUM7UUFDaEYsTUFBTSxhQUFhLEdBQTZCLEVBQUUsT0FBTyxFQUFFLE9BQU8sRUFBRSxPQUFPLEVBQUUsUUFBUSxFQUFDLENBQUM7UUFDdkYsTUFBTSxXQUFXLEdBQTZCLEVBQUMsT0FBTyxFQUFFLEtBQUssRUFBRSxPQUFPLEVBQUUsUUFBUSxFQUFDLENBQUM7UUFDbEYsTUFBTSxRQUFRLEdBQTZCLEVBQUMsT0FBTyxFQUFFLEtBQUssRUFBRSxPQUFPLEVBQUUsS0FBSyxFQUFDLENBQUM7UUFDNUUsTUFBTSxXQUFXLEdBQTZCLEVBQUUsT0FBTyxFQUFFLEtBQUssRUFBRSxPQUFPLEVBQUUsUUFBUSxFQUFDLENBQUM7UUFFbkYsT0FBTztZQUNMLGNBQWMsRUFBRSxjQUFjO1lBQzlCLFdBQVcsRUFBRSxXQUFXO1lBQ3hCLGFBQWEsRUFBRSxhQUFhO1lBQzVCLFVBQVUsRUFBRSxVQUFVO1lBQ3RCLGFBQWEsRUFBRSxhQUFhO1lBQzVCLFdBQVcsRUFBRSxXQUFXO1lBQ3hCLFFBQVEsRUFBRSxRQUFRO1lBQ2xCLFdBQVcsRUFBRSxXQUFXO1NBQ3pCLENBQUM7SUFDSixDQUFDO0lBRUQseUJBQXlCO1FBSXJCLE1BQU0sV0FBVyxHQUE4QixFQUFDLFFBQVEsRUFBRSxRQUFRLEVBQUUsUUFBUSxFQUFFLEtBQUssRUFBQyxDQUFDO1FBQ3JGLE1BQU0sY0FBYyxHQUE4QixFQUFDLFFBQVEsRUFBRSxRQUFRLEVBQUUsUUFBUSxFQUFFLFFBQVEsRUFBQyxDQUFDO1FBQzNGLE1BQU0sVUFBVSxHQUE4QixFQUFDLFFBQVEsRUFBRSxPQUFPLEVBQUUsUUFBUSxFQUFFLEtBQUssRUFBQyxDQUFDO1FBQ25GLE1BQU0sYUFBYSxHQUE4QixFQUFDLFFBQVEsRUFBRSxPQUFPLEVBQUUsUUFBUSxFQUFFLFFBQVEsRUFBQyxDQUFDO1FBQ3pGLE1BQU0sYUFBYSxHQUE4QixFQUFDLFFBQVEsRUFBRSxPQUFPLEVBQUUsUUFBUSxFQUFFLFFBQVEsRUFBQyxDQUFDO1FBQ3pGLE1BQU0sUUFBUSxHQUE4QixFQUFDLFFBQVEsRUFBRSxLQUFLLEVBQUUsUUFBUSxFQUFFLEtBQUssRUFBQyxDQUFDO1FBQy9FLE1BQU0sV0FBVyxHQUE4QixFQUFDLFFBQVEsRUFBRSxLQUFLLEVBQUUsUUFBUSxFQUFFLFFBQVEsRUFBQyxDQUFDO1FBQ3JGLE1BQU0sV0FBVyxHQUE4QixFQUFDLFFBQVEsRUFBRSxLQUFLLEVBQUUsUUFBUSxFQUFFLFFBQVEsRUFBQyxDQUFDO1FBRXJGLE9BQU87WUFDTCxXQUFXLEVBQUUsV0FBVztZQUN4QixjQUFjLEVBQUUsY0FBYztZQUM5QixVQUFVLEVBQUUsVUFBVTtZQUN0QixhQUFhLEVBQUUsYUFBYTtZQUM1QixhQUFhLEVBQUUsYUFBYTtZQUM1QixRQUFRLEVBQUUsUUFBUTtZQUNsQixXQUFXLEVBQUUsV0FBVztZQUN4QixXQUFXLEVBQUUsV0FBVztTQUN6QixDQUFDO0lBQ04sQ0FBQztJQUVELG9CQUFvQixDQUFDLE1BQU0sRUFBRSxPQUFPO1FBQ2xDLElBQUksY0FBYyxHQUFHLE1BQU0sQ0FBQyxjQUFjLENBQUM7UUFDM0MsSUFBSSxlQUFlLEdBQUcsT0FBTyxDQUFDLFdBQVcsQ0FBQztRQUMxQyxJQUFJLElBQUksQ0FBQyxTQUFTLEtBQUssT0FBTyxFQUFFO1lBQzlCLElBQUksSUFBSSxDQUFDLFNBQVMsS0FBSyxLQUFLLEVBQUU7Z0JBQzVCLGNBQWMsR0FBRyxNQUFNLENBQUMsVUFBVSxDQUFDO2dCQUNuQyxlQUFlLEdBQUcsT0FBTyxDQUFDLGFBQWEsQ0FBQzthQUN6QztpQkFBTSxJQUFJLElBQUksQ0FBQyxTQUFTLEtBQUssUUFBUSxJQUFJLElBQUksQ0FBQyxJQUFJLEtBQUssZUFBZSxDQUFDLFdBQVcsRUFBRTtnQkFDbkYsY0FBYyxHQUFHLE1BQU0sQ0FBQyxhQUFhLENBQUM7Z0JBQ3RDLGVBQWUsR0FBRyxPQUFPLENBQUMsV0FBVyxDQUFDO2FBQ3ZDO2lCQUFNLElBQUksSUFBSSxDQUFDLFNBQVMsS0FBSyxRQUFRLElBQUksQ0FBQyxJQUFJLENBQUMsU0FBUyxLQUFLLFFBQVEsSUFBSSxJQUFJLENBQUMsSUFBSSxLQUFLLGVBQWUsQ0FBQyxXQUFXLENBQUMsRUFBRTtnQkFDcEgsY0FBYyxHQUFHLE1BQU0sQ0FBQyxhQUFhLENBQUM7Z0JBQ3RDLGVBQWUsR0FBRyxPQUFPLENBQUMsVUFBVSxDQUFDO2FBQ3RDO1NBQ0Y7YUFBTSxJQUFJLElBQUksQ0FBQyxTQUFTLEtBQUssS0FBSyxFQUFFO1lBQ25DLElBQUksSUFBSSxDQUFDLFNBQVMsS0FBSyxLQUFLLEVBQUU7Z0JBQzVCLGNBQWMsR0FBRyxNQUFNLENBQUMsUUFBUSxDQUFDO2dCQUNqQyxlQUFlLEdBQUcsT0FBTyxDQUFDLFdBQVcsQ0FBQzthQUN2QztpQkFBTSxJQUFJLElBQUksQ0FBQyxTQUFTLEtBQUssUUFBUSxJQUFJLElBQUksQ0FBQyxJQUFJLEtBQUssZUFBZSxDQUFDLFdBQVcsRUFBRTtnQkFDbkYsY0FBYyxHQUFHLE1BQU0sQ0FBQyxXQUFXLENBQUM7Z0JBQ3BDLGVBQWUsR0FBRyxPQUFPLENBQUMsYUFBYSxDQUFDO2FBQ3pDO2lCQUFNLElBQUksSUFBSSxDQUFDLFNBQVMsS0FBSyxRQUFRLElBQUksQ0FBQyxJQUFJLENBQUMsU0FBUyxLQUFLLFFBQVEsSUFBSSxJQUFJLENBQUMsSUFBSSxLQUFLLGVBQWUsQ0FBQyxXQUFXLENBQUMsRUFBRTtnQkFDcEgsY0FBYyxHQUFHLE1BQU0sQ0FBQyxXQUFXLENBQUM7Z0JBQ3BDLGVBQWUsR0FBRyxPQUFPLENBQUMsUUFBUSxDQUFDO2FBQ3BDO1NBQ0Y7YUFBTSxJQUFJLElBQUksQ0FBQyxTQUFTLEtBQUssUUFBUSxFQUFFO1lBQ3RDLGNBQWMsR0FBRyxJQUFJLENBQUMsU0FBUyxLQUFLLEtBQUssQ0FBQyxDQUFDLENBQUMsTUFBTSxDQUFDLFdBQVcsQ0FBQyxDQUFDLENBQUMsTUFBTSxDQUFDLGNBQWMsQ0FBQztZQUN2RixlQUFlLEdBQUcsSUFBSSxDQUFDLFNBQVMsS0FBSyxLQUFLLENBQUMsQ0FBQyxDQUFDLE9BQU8sQ0FBQyxjQUFjLENBQUMsQ0FBQyxDQUFDLE9BQU8sQ0FBQyxXQUFXLENBQUM7U0FDM0Y7UUFDRCxPQUFPO1lBQ0wsY0FBYyxFQUFFLGNBQWM7WUFDOUIsZUFBZSxFQUFFLGVBQWU7U0FDakMsQ0FBQTtJQUNILENBQUM7SUFFRCxlQUFlLENBQUMsQ0FBMEIsRUFBRSxDQUF3QjtRQUNsRSxJQUFJLENBQUMsS0FBSyxPQUFPLEVBQUU7WUFDakIsQ0FBQyxHQUFHLEtBQUssQ0FBQTtTQUNWO2FBQU0sSUFBSSxDQUFDLEtBQUssS0FBSyxFQUFFO1lBQ3RCLENBQUMsR0FBRyxPQUFPLENBQUE7U0FDWjtRQUVELElBQUksQ0FBQyxLQUFLLEtBQUssRUFBRTtZQUNmLENBQUMsR0FBRyxRQUFRLENBQUM7U0FDZDthQUFNLElBQUksQ0FBQyxLQUFLLFFBQVEsRUFBRTtZQUN6QixDQUFDLEdBQUcsS0FBSyxDQUFDO1NBQ1g7UUFDRCxPQUFPLEVBQUMsQ0FBQyxFQUFFLENBQUMsRUFBQyxDQUFDO0lBQ2hCLENBQUM7SUFFRCxpQkFBaUIsQ0FBRSxNQUFNO1FBQ3ZCLElBQUksSUFBSSxDQUFDLElBQUksS0FBSyxlQUFlLENBQUMsV0FBVyxJQUFJLElBQUksQ0FBQyxJQUFJLEtBQUssZUFBZSxDQUFDLFdBQVcsRUFBRTtZQUMxRixJQUFJLE1BQU0sQ0FBQyxjQUFjLENBQUMsUUFBUSxLQUFLLEtBQUssRUFBRTtnQkFDNUMsSUFBSSxNQUFNLENBQUMsY0FBYyxDQUFDLFFBQVEsS0FBSyxRQUFRLEVBQUU7b0JBQy9DLElBQUksQ0FBQyxTQUFTLEdBQUcsK0RBQStELENBQUM7aUJBQ2xGO3FCQUFNLElBQUksTUFBTSxDQUFDLGNBQWMsQ0FBQyxRQUFRLEtBQUssT0FBTyxFQUFFO29CQUNyRCxJQUFJLENBQUMsU0FBUyxHQUFHLDZEQUE2RCxDQUFDO2lCQUNoRjtxQkFBTTtvQkFDTCxJQUFJLENBQUMsU0FBUyxHQUFHLDhEQUE4RCxDQUFDO2lCQUNqRjthQUNGO2lCQUFNLElBQUksTUFBTSxDQUFDLGNBQWMsQ0FBQyxRQUFRLEtBQUssUUFBUSxFQUFFO2dCQUN0RCxJQUFJLE1BQU0sQ0FBQyxjQUFjLENBQUMsUUFBUSxLQUFLLE9BQU8sRUFBRTtvQkFDOUMsSUFBSSxDQUFDLFNBQVMsR0FBRyxrRUFBa0UsQ0FBQztpQkFDckY7cUJBQU07b0JBQ0wsSUFBSSxDQUFDLFNBQVMsR0FBRyxpRUFBaUUsQ0FBQztpQkFDcEY7YUFDRjtpQkFBTTtnQkFDTCxJQUFJLE1BQU0sQ0FBQyxjQUFjLENBQUMsUUFBUSxLQUFLLFFBQVEsRUFBRTtvQkFDL0MsSUFBSSxDQUFDLFNBQVMsR0FBRyxpRUFBaUUsQ0FBQztpQkFDcEY7cUJBQU0sSUFBSSxNQUFNLENBQUMsY0FBYyxDQUFDLFFBQVEsS0FBSyxPQUFPLEVBQUU7b0JBQ3JELElBQUksQ0FBQyxTQUFTLEdBQUcsK0RBQStELENBQUM7aUJBQ2xGO3FCQUFNO29CQUNMLElBQUksQ0FBQyxTQUFTLEdBQUcsZ0VBQWdFLENBQUM7aUJBQ25GO2FBQ0Y7U0FDRjthQUFNLElBQUksSUFBSSxDQUFDLElBQUksS0FBSyxlQUFlLENBQUMsUUFBUSxFQUFFO1lBQ2pELElBQUksQ0FBQyxTQUFTLEdBQUcsOEJBQThCLENBQUM7U0FDakQ7SUFDSCxDQUFDO0lBRUQsS0FBSztRQUNILElBQUksSUFBSSxDQUFDLE1BQU0sRUFBRTtZQUNmLElBQUksQ0FBQyxNQUFNLEdBQUcsS0FBSyxDQUFDO1lBQ3BCLElBQUksQ0FBQyxXQUFXLENBQUMsTUFBTSxFQUFFLENBQUM7WUFDMUIsSUFBSSxDQUFDLFlBQVksQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLE1BQU0sQ0FBQyxDQUFDO1NBQ3JDO0lBQ0gsQ0FBQztJQUVELFFBQVE7UUFDTixPQUFPLElBQUksQ0FBQztJQUNkLENBQUM7SUFFRCxhQUFhLENBQUMsS0FBSztRQUNqQixRQUFRLEtBQUssQ0FBQyxPQUFPLEVBQUU7WUFDckIsS0FBSyxLQUFLLENBQUM7WUFDWCxLQUFLLEtBQUs7Z0JBQ1IsSUFBSSxDQUFDLElBQUksRUFBRSxDQUFDO2dCQUNaLEtBQUssQ0FBQyxjQUFjLEVBQUUsQ0FBQztnQkFDdkIsS0FBSyxDQUFDLGVBQWUsRUFBRSxDQUFDO2dCQUN4QixJQUFJLENBQUMsTUFBTSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQztnQkFDdkIsTUFBTTtZQUNSLEtBQUssTUFBTTtnQkFDVCxJQUFJLENBQUMsS0FBSyxFQUFFLENBQUM7Z0JBQ2IsSUFBSSxDQUFDLE1BQU0sQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLENBQUM7Z0JBQ3hCLEtBQUssQ0FBQyxlQUFlLEVBQUUsQ0FBQztnQkFDeEIsTUFBTTtZQUNSLFFBQVE7U0FDVDtJQUNILENBQUM7SUFHRCxXQUFXLENBQUMsS0FBSztRQUNmLElBQUksQ0FBQyxJQUFJLEVBQUUsQ0FBQztJQUNkLENBQUM7Q0FFRixDQUFBO0FBbFJVO0lBQVIsS0FBSyxFQUFFO3NDQUFTLGdCQUFnQjt5REFBQztBQUN6QjtJQUFSLEtBQUssRUFBRTs7eURBQWlCO0FBQ2hCO0lBQVIsS0FBSyxFQUFFOzs4REFBb0I7QUFDbEI7SUFBVCxNQUFNLEVBQUU7c0NBQWUsWUFBWTsrREFBd0M7QUFDbkU7SUFBUixLQUFLLEVBQUU7O3VEQUFpQztBQUNoQztJQUFSLEtBQUssRUFBRTs7NERBQXNCO0FBQ3JCO0lBQVIsS0FBSyxFQUFFOzs0REFBc0I7QUFFckI7SUFBUixLQUFLLEVBQUU7OzREQUFvQjtBQUdhO0lBQXhDLFNBQVMsQ0FBQyxXQUFXLEVBQUUsRUFBQyxNQUFNLEVBQUUsS0FBSyxFQUFDLENBQUM7c0NBQVUsV0FBVzswREFBTTtBQUN6RDtJQUFULE1BQU0sRUFBRTs7eURBQXNDO0FBa1EvQztJQURDLFlBQVksQ0FBQyxPQUFPLEVBQUUsQ0FBQyxRQUFRLENBQUMsQ0FBQzs7Ozs0REFHakM7QUFqUlUseUJBQXlCO0lBTnJDLFNBQVMsQ0FBQztRQUNULFFBQVEsRUFBRSxvQkFBb0I7UUFDOUIsdWhCQUE4QztRQUU5QyxhQUFhLEVBQUUsaUJBQWlCLENBQUMsSUFBSTs7S0FDdEMsQ0FBQzs2Q0FnQjhCLE9BQU87UUFDRSxnQkFBZ0I7R0FoQjVDLHlCQUF5QixDQW1SckM7U0FuUlkseUJBQXlCIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHtcbiAgQ29tcG9uZW50LFxuICBFdmVudEVtaXR0ZXIsXG4gIEhvc3RMaXN0ZW5lcixcbiAgVGVtcGxhdGVSZWYsXG4gIFZpZXdFbmNhcHN1bGF0aW9uLFxuICBJbnB1dCxcbiAgT3V0cHV0LFxuICBWaWV3Q2hpbGQsXG4gIFZpZXdDb250YWluZXJSZWYsXG4gIE9uQ2hhbmdlcyxcbiAgU2ltcGxlQ2hhbmdlc1xufSBmcm9tICdAYW5ndWxhci9jb3JlJztcbmltcG9ydCB7IFRlbXBsYXRlUG9ydGFsIH0gZnJvbSAnQGFuZ3VsYXIvY2RrL3BvcnRhbCc7XG5pbXBvcnQgeyBFTlRFUiwgU1BBQ0UsIEVTQ0FQRSB9IGZyb20gJ0Bhbmd1bGFyL2Nkay9rZXljb2Rlcyc7XG5pbXBvcnQgeyBPdmVybGF5LFxuICAgICAgICAgT3ZlcmxheUNvbm5lY3Rpb25Qb3NpdGlvbixcbiAgICAgICAgIE9yaWdpbkNvbm5lY3Rpb25Qb3NpdGlvbixcbiAgICAgICAgIEZsZXhpYmxlQ29ubmVjdGVkUG9zaXRpb25TdHJhdGVneSxcbiAgICAgICAgIE92ZXJsYXlSZWYsXG4gICAgICAgICBDZGtPdmVybGF5T3JpZ2luLFxuICAgICAgICAgSG9yaXpvbnRhbENvbm5lY3Rpb25Qb3MsXG4gICAgICAgICBWZXJ0aWNhbENvbm5lY3Rpb25Qb3N9IGZyb20gJ0Bhbmd1bGFyL2Nkay9vdmVybGF5JztcblxuaW1wb3J0IHsgUnVmVHJpZ2dlclRhcmdldCB9IGZyb20gJy4uL3RyaWdnZXIvdHJpZ2dlci5pbnRlcmZhY2UnO1xuXG5leHBvcnQgZW51bSBSdWZEcm9wZG93blR5cGUge1xuICBQb3BvdmVyTWVudSA9ICdwb3BvdmVyLW1lbnUnLFxuICBDb250ZXh0TWVudSA9ICdjb250ZXh0LW1lbnUnLFxuICBEcm9wZG93biA9ICdkcm9wZG93bicsXG59O1xuXG5AQ29tcG9uZW50KHtcbiAgc2VsZWN0b3I6ICdydWYtZHJvcGRvd24tcGFuZWwnLFxuICB0ZW1wbGF0ZVVybDogJy4vZHJvcGRvd24tcGFuZWwuY29tcG9uZW50Lmh0bWwnLFxuICBzdHlsZVVybHM6IFsnZHJvcGRvd24tcGFuZWwuY29tcG9uZW50LnNjc3MnXSxcbiAgZW5jYXBzdWxhdGlvbjogVmlld0VuY2Fwc3VsYXRpb24uTm9uZVxufSlcbmV4cG9ydCBjbGFzcyBSdWZEcm9wZG93blBhbmVsQ29tcG9uZW50IGltcGxlbWVudHMgUnVmVHJpZ2dlclRhcmdldCwgT25DaGFuZ2VzIHtcbiAgQElucHV0KCkgb3JpZ2luOiBDZGtPdmVybGF5T3JpZ2luO1xuICBASW5wdXQoKSBvcGVuZWQ6IGJvb2xlYW47XG4gIEBJbnB1dCgpIGhhc0JhY2tkcm9wID0gdHJ1ZTtcbiAgQE91dHB1dCgpIG9wZW5lZENoYW5nZTogRXZlbnRFbWl0dGVyPGJvb2xlYW4+ID0gbmV3IEV2ZW50RW1pdHRlcjxib29sZWFuPigpO1xuICBASW5wdXQoKSB0eXBlID0gUnVmRHJvcGRvd25UeXBlLkRyb3Bkb3duO1xuICBASW5wdXQoKSB4UG9zaXRpb24gPSAnY2VudGVyJztcbiAgQElucHV0KCkgeVBvc2l0aW9uID0gJ2JvdHRvbSc7XG4gIGNsYXNzTmFtZSA9ICdydWYtZHJvcGRvd24tcGFuZWwtY29udGFpbmVyJztcbiAgQElucHV0KCkgY2xvc2VJY29uOiBib29sZWFuO1xuICBwcml2YXRlIF9vdmVybGF5UmVmOiBPdmVybGF5UmVmO1xuICBwcml2YXRlIF9wb3J0YWw6IFRlbXBsYXRlUG9ydGFsPGFueT47XG4gIEBWaWV3Q2hpbGQoVGVtcGxhdGVSZWYsIHtzdGF0aWM6IGZhbHNlfSkgY29udGVudDogVGVtcGxhdGVSZWY8YW55PjtcbiAgQE91dHB1dCgpIHRvZ2dsZSA9IG5ldyBFdmVudEVtaXR0ZXI8Ym9vbGVhbj4oKTtcblxuICBjb25zdHJ1Y3Rvcihwcml2YXRlIF9vdmVybGF5OiBPdmVybGF5LFxuICAgICAgICAgICAgICBwcml2YXRlIF92aWV3Q29udGFpbmVyUmVmOiBWaWV3Q29udGFpbmVyUmVmKSB7fVxuXG4gbmdPbkNoYW5nZXMoY2hhbmdlczogU2ltcGxlQ2hhbmdlcyk6IHZvaWQge1xuICBpZiAoY2hhbmdlcyAmJlxuICAgICAgY2hhbmdlcy5oYXNCYWNrZHJvcCAmJlxuICAgICAgY2hhbmdlcy5oYXNCYWNrZHJvcC5wcmV2aW91c1ZhbHVlICE9PSBjaGFuZ2VzLmhhc0JhY2tkcm9wLmN1cnJlbnRWYWx1ZSkge1xuICAgIC8vIHdoZW4gdmFsdWUgaXMgY2hhbmdlcyBmb3IgaGFzQmFja2Ryb3Agc2V0IHZhbHVlIG51bGwgZm9yIG92ZXJsYXlcbiAgICAvLyBzbyB0aGF0IGl0IHdpbGwgY3JlYXRlIG5ldyBvdmVybGF5IHdpdGggdXBkYXRlZCBiYWNrZHJvcCB2YWx1ZVxuICAgIGlmICh0aGlzLl9vdmVybGF5UmVmKSB7XG4gICAgICB0aGlzLl9vdmVybGF5UmVmLmRldGFjaCgpO1xuICAgICAgdGhpcy5fb3ZlcmxheVJlZiA9IG51bGw7XG4gICAgfVxuICB9XG4gfVxuXG4gIG9wZW4oKSB7XG4gICAgY29uc3Qgb3JpZ2luID0gdGhpcy5fZ2V0T3JpZ2luKCk7XG4gICAgY29uc3Qgb3ZlcmxheSA9IHRoaXMuX2dldE92ZXJsYXlQb3NpdGlvbigpO1xuXG4gICAgaWYgKCF0aGlzLl9vdmVybGF5UmVmKSB7XG4gICAgICBsZXQgcG9zaXRpb25TdHJhdGVneTogRmxleGlibGVDb25uZWN0ZWRQb3NpdGlvblN0cmF0ZWd5O1xuICAgICAgcG9zaXRpb25TdHJhdGVneSA9IHRoaXMuX292ZXJsYXkucG9zaXRpb24oKVxuICAgICAgICAuZmxleGlibGVDb25uZWN0ZWRUbyh0aGlzLm9yaWdpbi5lbGVtZW50UmVmKVxuICAgICAgICAud2l0aFBvc2l0aW9ucyhbXG4gICAgICAgICAgeyAuLi5vcmlnaW4ubWFpbiwgLi4ub3ZlcmxheS5tYWluIH0sXG4gICAgICAgICAgey4uLm9yaWdpbi5mYWxsYmFjaywgLi4ub3ZlcmxheS5mYWxsYmFja31cbiAgICAgICAgXSk7XG5cbiAgICAgIHRoaXMub25Qb3NpdGlvbkNoYW5nZWQoe1xuICAgICAgICBjb25uZWN0aW9uUGFpcjoge1xuICAgICAgICAgIG92ZXJsYXlYOiBvdmVybGF5Lm1haW4ub3ZlcmxheVgsXG4gICAgICAgICAgb3ZlcmxheVk6IG92ZXJsYXkubWFpbi5vdmVybGF5WVxuICAgICAgICB9XG4gICAgICB9KTtcblxuICAgICAgcG9zaXRpb25TdHJhdGVneS5wb3NpdGlvbkNoYW5nZXMuc3Vic2NyaWJlKGNoYW5nZSA9PiB7XG4gICAgICAgIHRoaXMub25Qb3NpdGlvbkNoYW5nZWQoY2hhbmdlKTtcbiAgICAgIH0pO1xuXG4gICAgICB0aGlzLl9vdmVybGF5UmVmID0gdGhpcy5fb3ZlcmxheS5jcmVhdGUoe1xuICAgICAgICBoYXNCYWNrZHJvcDogdGhpcy5oYXNCYWNrZHJvcCxcbiAgICAgICAgYmFja2Ryb3BDbGFzczogJ3J1Zi1kcm9wZG93bi1wYW5lbC13cmFwcGVyJyxcbiAgICAgICAgcG9zaXRpb25TdHJhdGVneVxuICAgICAgfSk7XG5cbiAgICAgIHRoaXMuX292ZXJsYXlSZWYuYmFja2Ryb3BDbGljaygpLnN1YnNjcmliZSgoKSA9PiB0aGlzLmNsb3NlKCkpO1xuICAgICAgdGhpcy5fcG9ydGFsID0gbmV3IFRlbXBsYXRlUG9ydGFsKHRoaXMuY29udGVudCwgdGhpcy5fdmlld0NvbnRhaW5lclJlZik7XG4gICAgfVxuXG4gICAgaWYgKCF0aGlzLl9vdmVybGF5UmVmLmhhc0F0dGFjaGVkKCkpIHtcbiAgICAgIHRoaXMuX292ZXJsYXlSZWYuYXR0YWNoKHRoaXMuX3BvcnRhbCk7XG4gICAgICB0aGlzLm9wZW5lZCA9IHRydWU7XG4gICAgICB0aGlzLnRvZ2dsZS5lbWl0KHRydWUpO1xuICAgIH0gZWxzZSB7XG4gICAgICB0aGlzLmNsb3NlKCk7XG4gICAgICB0aGlzLnRvZ2dsZS5lbWl0KGZhbHNlKTtcbiAgICB9XG4gIH07XG5cbiAgX2dldE9yaWdpbigpOiB7IG1haW46IE9yaWdpbkNvbm5lY3Rpb25Qb3NpdGlvbiwgZmFsbGJhY2s6IE9yaWdpbkNvbm5lY3Rpb25Qb3NpdGlvbn0ge1xuICAgIGxldCBvcmlnaW5Qb3NpdGlvbjogT3JpZ2luQ29ubmVjdGlvblBvc2l0aW9uO1xuICAgIG9yaWdpblBvc2l0aW9uID0gdGhpcy5fZ2V0UG9zaXRpb25TdHJhdGVneSh0aGlzLl9nZXRPcmlnaW5WYWx1ZXMoKSwgdGhpcy5fZ2V0T3ZlcmxheVBvc2l0aW9uVmFsdWVzKCkpLm9yaWdpblBvc2l0aW9uO1xuICAgIGNvbnN0IHt4LCB5fSA9IHRoaXMuX2ludmVydFBvc2l0aW9uKG9yaWdpblBvc2l0aW9uLm9yaWdpblgsIG9yaWdpblBvc2l0aW9uLm9yaWdpblkpO1xuICAgIGlmICh0aGlzLnR5cGUgPT09IFJ1ZkRyb3Bkb3duVHlwZS5Qb3BvdmVyTWVudSB8fCB0aGlzLnR5cGUgPT09IFJ1ZkRyb3Bkb3duVHlwZS5Db250ZXh0TWVudSkge1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgbWFpbjogb3JpZ2luUG9zaXRpb24sXG4gICAgICAgIGZhbGxiYWNrOiB7b3JpZ2luWDogeCwgb3JpZ2luWTogeX1cbiAgICAgIH1cbiAgICB9IGVsc2Uge1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgbWFpbjoge29yaWdpblg6ICdzdGFydCcsIG9yaWdpblk6ICdib3R0b20nfSxcbiAgICAgICAgZmFsbGJhY2s6IHtvcmlnaW5YOiAnZW5kJywgb3JpZ2luWTogJ3RvcCd9XG4gICAgICB9XG4gICAgfVxuICB9XG5cbiAgX2dldE92ZXJsYXlQb3NpdGlvbigpOiB7IG1haW46IE92ZXJsYXlDb25uZWN0aW9uUG9zaXRpb24sIGZhbGxiYWNrOiBPdmVybGF5Q29ubmVjdGlvblBvc2l0aW9ufSB7XG4gICAgY29uc3QgWFBvc2l0aW9uID0gdGhpcy54UG9zaXRpb247XG4gICAgY29uc3QgWVBvc2l0aW9uID0gdGhpcy55UG9zaXRpb247XG4gICAgbGV0IG92ZXJsYXlQb3NpdGlvbjogT3ZlcmxheUNvbm5lY3Rpb25Qb3NpdGlvbjtcbiAgICBvdmVybGF5UG9zaXRpb24gPSB0aGlzLl9nZXRQb3NpdGlvblN0cmF0ZWd5KHRoaXMuX2dldE9yaWdpblZhbHVlcygpLCB0aGlzLl9nZXRPdmVybGF5UG9zaXRpb25WYWx1ZXMoKSkub3ZlcmxheVBvc2l0aW9uO1xuICAgIGNvbnN0IHt4LCB5fSA9IHRoaXMuX2ludmVydFBvc2l0aW9uKG92ZXJsYXlQb3NpdGlvbi5vdmVybGF5WCwgb3ZlcmxheVBvc2l0aW9uLm92ZXJsYXlZKTtcbiAgICBpZiAodGhpcy50eXBlID09PSBSdWZEcm9wZG93blR5cGUuUG9wb3Zlck1lbnUgfHwgdGhpcy50eXBlID09PSBSdWZEcm9wZG93blR5cGUuQ29udGV4dE1lbnUpIHtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIG1haW46IG92ZXJsYXlQb3NpdGlvbixcbiAgICAgICAgZmFsbGJhY2s6IHtvdmVybGF5WDogeCwgb3ZlcmxheVk6IHl9XG4gICAgICB9XG4gICAgfSBlbHNlIHtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIG1haW46IHtvdmVybGF5WDogJ3N0YXJ0Jywgb3ZlcmxheVk6ICd0b3AnfSxcbiAgICAgICAgZmFsbGJhY2s6IHtvdmVybGF5WDogJ2VuZCcsIG92ZXJsYXlZOiAnYm90dG9tJ31cbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICBfZ2V0T3JpZ2luVmFsdWVzKCk6IHsgeENlbnRlcllCb3R0b206IE9yaWdpbkNvbm5lY3Rpb25Qb3NpdGlvbiwgeENlbnRlcllUb3A6IE9yaWdpbkNvbm5lY3Rpb25Qb3NpdGlvblxuICAgICAgICAgICAgICAgICAgeFN0YXJ0WUJvdHRvbTogT3JpZ2luQ29ubmVjdGlvblBvc2l0aW9uLCB4U3RhcnRZVG9wOiBPcmlnaW5Db25uZWN0aW9uUG9zaXRpb24sIHhTdGFydFlDZW50ZXI6IE9yaWdpbkNvbm5lY3Rpb25Qb3NpdGlvbixcbiAgICAgICAgICAgICAgICAgIHhFbmRZQm90dG9tOiBPcmlnaW5Db25uZWN0aW9uUG9zaXRpb24sIHhFbmRZVG9wOiBPcmlnaW5Db25uZWN0aW9uUG9zaXRpb24sIHhFbmRZQ2VudGVyOiBPcmlnaW5Db25uZWN0aW9uUG9zaXRpb259IHtcbiAgICBjb25zdCB4Q2VudGVyWUJvdHRvbTogT3JpZ2luQ29ubmVjdGlvblBvc2l0aW9uID0ge29yaWdpblg6ICdjZW50ZXInLCBvcmlnaW5ZOiAnYm90dG9tJ307XG4gICAgY29uc3QgeENlbnRlcllUb3A6IE9yaWdpbkNvbm5lY3Rpb25Qb3NpdGlvbiA9IHtvcmlnaW5YOiAnY2VudGVyJywgb3JpZ2luWTogJ3RvcCd9O1xuICAgIGNvbnN0IHhTdGFydFlCb3R0b206IE9yaWdpbkNvbm5lY3Rpb25Qb3NpdGlvbiA9IHtvcmlnaW5YOiAnc3RhcnQnLCBvcmlnaW5ZOiAnYm90dG9tJ307XG4gICAgY29uc3QgeFN0YXJ0WVRvcDogT3JpZ2luQ29ubmVjdGlvblBvc2l0aW9uID0ge29yaWdpblg6ICdzdGFydCcsIG9yaWdpblk6ICd0b3AnfTtcbiAgICBjb25zdCB4U3RhcnRZQ2VudGVyOiBPcmlnaW5Db25uZWN0aW9uUG9zaXRpb24gPSB7IG9yaWdpblg6ICdzdGFydCcsIG9yaWdpblk6ICdjZW50ZXInfTtcbiAgICBjb25zdCB4RW5kWUJvdHRvbTogT3JpZ2luQ29ubmVjdGlvblBvc2l0aW9uID0ge29yaWdpblg6ICdlbmQnLCBvcmlnaW5ZOiAnYm90dG9tJ307XG4gICAgY29uc3QgeEVuZFlUb3A6IE9yaWdpbkNvbm5lY3Rpb25Qb3NpdGlvbiA9IHtvcmlnaW5YOiAnZW5kJywgb3JpZ2luWTogJ3RvcCd9O1xuICAgIGNvbnN0IHhFbmRZQ2VudGVyOiBPcmlnaW5Db25uZWN0aW9uUG9zaXRpb24gPSB7IG9yaWdpblg6ICdlbmQnLCBvcmlnaW5ZOiAnY2VudGVyJ307XG5cbiAgICByZXR1cm4ge1xuICAgICAgeENlbnRlcllCb3R0b206IHhDZW50ZXJZQm90dG9tLFxuICAgICAgeENlbnRlcllUb3A6IHhDZW50ZXJZVG9wLFxuICAgICAgeFN0YXJ0WUJvdHRvbTogeFN0YXJ0WUJvdHRvbSxcbiAgICAgIHhTdGFydFlUb3A6IHhTdGFydFlUb3AsXG4gICAgICB4U3RhcnRZQ2VudGVyOiB4U3RhcnRZQ2VudGVyLFxuICAgICAgeEVuZFlCb3R0b206IHhFbmRZQm90dG9tLFxuICAgICAgeEVuZFlUb3A6IHhFbmRZVG9wLFxuICAgICAgeEVuZFlDZW50ZXI6IHhFbmRZQ2VudGVyXG4gICAgfTtcbiAgfVxuXG4gIF9nZXRPdmVybGF5UG9zaXRpb25WYWx1ZXMoKToge1xuICAgICAgICAgIHhDZW50ZXJZVG9wOiBPdmVybGF5Q29ubmVjdGlvblBvc2l0aW9uLCB4Q2VudGVyWUJvdHRvbTogT3ZlcmxheUNvbm5lY3Rpb25Qb3NpdGlvblxuICAgICAgICAgIHhTdGFydFlUb3A6IE92ZXJsYXlDb25uZWN0aW9uUG9zaXRpb24sIHhTdGFydFlCb3R0b206IE92ZXJsYXlDb25uZWN0aW9uUG9zaXRpb24sIHhTdGFydFlDZW50ZXI6IE92ZXJsYXlDb25uZWN0aW9uUG9zaXRpb24sXG4gICAgICAgICAgeEVuZFlUb3A6IE92ZXJsYXlDb25uZWN0aW9uUG9zaXRpb24sIHhFbmRZQm90dG9tOiBPdmVybGF5Q29ubmVjdGlvblBvc2l0aW9uLCB4RW5kWUNlbnRlcjogT3ZlcmxheUNvbm5lY3Rpb25Qb3NpdGlvbn0ge1xuICAgICAgY29uc3QgeENlbnRlcllUb3A6IE92ZXJsYXlDb25uZWN0aW9uUG9zaXRpb24gPSB7b3ZlcmxheVg6ICdjZW50ZXInLCBvdmVybGF5WTogJ3RvcCd9O1xuICAgICAgY29uc3QgeENlbnRlcllCb3R0b206IE92ZXJsYXlDb25uZWN0aW9uUG9zaXRpb24gPSB7b3ZlcmxheVg6ICdjZW50ZXInLCBvdmVybGF5WTogJ2JvdHRvbSd9O1xuICAgICAgY29uc3QgeFN0YXJ0WVRvcDogT3ZlcmxheUNvbm5lY3Rpb25Qb3NpdGlvbiA9IHtvdmVybGF5WDogJ3N0YXJ0Jywgb3ZlcmxheVk6ICd0b3AnfTtcbiAgICAgIGNvbnN0IHhTdGFydFlCb3R0b206IE92ZXJsYXlDb25uZWN0aW9uUG9zaXRpb24gPSB7b3ZlcmxheVg6ICdzdGFydCcsIG92ZXJsYXlZOiAnYm90dG9tJ307XG4gICAgICBjb25zdCB4U3RhcnRZQ2VudGVyOiBPdmVybGF5Q29ubmVjdGlvblBvc2l0aW9uID0ge292ZXJsYXlYOiAnc3RhcnQnLCBvdmVybGF5WTogJ2NlbnRlcid9O1xuICAgICAgY29uc3QgeEVuZFlUb3A6IE92ZXJsYXlDb25uZWN0aW9uUG9zaXRpb24gPSB7b3ZlcmxheVg6ICdlbmQnLCBvdmVybGF5WTogJ3RvcCd9O1xuICAgICAgY29uc3QgeEVuZFlCb3R0b206IE92ZXJsYXlDb25uZWN0aW9uUG9zaXRpb24gPSB7b3ZlcmxheVg6ICdlbmQnLCBvdmVybGF5WTogJ2JvdHRvbSd9O1xuICAgICAgY29uc3QgeEVuZFlDZW50ZXI6IE92ZXJsYXlDb25uZWN0aW9uUG9zaXRpb24gPSB7b3ZlcmxheVg6ICdlbmQnLCBvdmVybGF5WTogJ2NlbnRlcid9O1xuXG4gICAgICByZXR1cm4ge1xuICAgICAgICB4Q2VudGVyWVRvcDogeENlbnRlcllUb3AsXG4gICAgICAgIHhDZW50ZXJZQm90dG9tOiB4Q2VudGVyWUJvdHRvbSxcbiAgICAgICAgeFN0YXJ0WVRvcDogeFN0YXJ0WVRvcCxcbiAgICAgICAgeFN0YXJ0WUJvdHRvbTogeFN0YXJ0WUJvdHRvbSxcbiAgICAgICAgeFN0YXJ0WUNlbnRlcjogeFN0YXJ0WUNlbnRlcixcbiAgICAgICAgeEVuZFlUb3A6IHhFbmRZVG9wLFxuICAgICAgICB4RW5kWUJvdHRvbTogeEVuZFlCb3R0b20sXG4gICAgICAgIHhFbmRZQ2VudGVyOiB4RW5kWUNlbnRlclxuICAgICAgfTtcbiAgfVxuXG4gIF9nZXRQb3NpdGlvblN0cmF0ZWd5KG9yaWdpbiwgb3ZlcmxheSkge1xuICAgIGxldCBvcmlnaW5Qb3NpdGlvbiA9IG9yaWdpbi54Q2VudGVyWUJvdHRvbTtcbiAgICBsZXQgb3ZlcmxheVBvc2l0aW9uID0gb3ZlcmxheS54Q2VudGVyWVRvcDtcbiAgICBpZiAodGhpcy54UG9zaXRpb24gPT09ICdzdGFydCcpIHtcbiAgICAgIGlmICh0aGlzLnlQb3NpdGlvbiA9PT0gJ3RvcCcpIHtcbiAgICAgICAgb3JpZ2luUG9zaXRpb24gPSBvcmlnaW4ueFN0YXJ0WVRvcDtcbiAgICAgICAgb3ZlcmxheVBvc2l0aW9uID0gb3ZlcmxheS54U3RhcnRZQm90dG9tO1xuICAgICAgfSBlbHNlIGlmICh0aGlzLnlQb3NpdGlvbiA9PT0gJ2NlbnRlcicgJiYgdGhpcy50eXBlID09PSBSdWZEcm9wZG93blR5cGUuUG9wb3Zlck1lbnUpIHtcbiAgICAgICAgb3JpZ2luUG9zaXRpb24gPSBvcmlnaW4ueFN0YXJ0WUNlbnRlcjtcbiAgICAgICAgb3ZlcmxheVBvc2l0aW9uID0gb3ZlcmxheS54RW5kWUNlbnRlcjtcbiAgICAgIH0gZWxzZSBpZiAodGhpcy55UG9zaXRpb24gPT09ICdib3R0b20nIHx8ICh0aGlzLnlQb3NpdGlvbiA9PT0gJ2NlbnRlcicgJiYgdGhpcy50eXBlID09PSBSdWZEcm9wZG93blR5cGUuQ29udGV4dE1lbnUpKSB7XG4gICAgICAgIG9yaWdpblBvc2l0aW9uID0gb3JpZ2luLnhTdGFydFlCb3R0b207XG4gICAgICAgIG92ZXJsYXlQb3NpdGlvbiA9IG92ZXJsYXkueFN0YXJ0WVRvcDtcbiAgICAgIH1cbiAgICB9IGVsc2UgaWYgKHRoaXMueFBvc2l0aW9uID09PSAnZW5kJykge1xuICAgICAgaWYgKHRoaXMueVBvc2l0aW9uID09PSAndG9wJykge1xuICAgICAgICBvcmlnaW5Qb3NpdGlvbiA9IG9yaWdpbi54RW5kWVRvcDtcbiAgICAgICAgb3ZlcmxheVBvc2l0aW9uID0gb3ZlcmxheS54RW5kWUJvdHRvbTtcbiAgICAgIH0gZWxzZSBpZiAodGhpcy55UG9zaXRpb24gPT09ICdjZW50ZXInICYmIHRoaXMudHlwZSA9PT0gUnVmRHJvcGRvd25UeXBlLlBvcG92ZXJNZW51KSB7XG4gICAgICAgIG9yaWdpblBvc2l0aW9uID0gb3JpZ2luLnhFbmRZQ2VudGVyO1xuICAgICAgICBvdmVybGF5UG9zaXRpb24gPSBvdmVybGF5LnhTdGFydFlDZW50ZXI7XG4gICAgICB9IGVsc2UgaWYgKHRoaXMueVBvc2l0aW9uID09PSAnYm90dG9tJyB8fCAodGhpcy55UG9zaXRpb24gPT09ICdjZW50ZXInICYmIHRoaXMudHlwZSA9PT0gUnVmRHJvcGRvd25UeXBlLkNvbnRleHRNZW51KSkge1xuICAgICAgICBvcmlnaW5Qb3NpdGlvbiA9IG9yaWdpbi54RW5kWUJvdHRvbTtcbiAgICAgICAgb3ZlcmxheVBvc2l0aW9uID0gb3ZlcmxheS54RW5kWVRvcDtcbiAgICAgIH1cbiAgICB9IGVsc2UgaWYgKHRoaXMueFBvc2l0aW9uID09PSAnY2VudGVyJykge1xuICAgICAgb3JpZ2luUG9zaXRpb24gPSB0aGlzLnlQb3NpdGlvbiA9PT0gJ3RvcCcgPyBvcmlnaW4ueENlbnRlcllUb3AgOiBvcmlnaW4ueENlbnRlcllCb3R0b207XG4gICAgICBvdmVybGF5UG9zaXRpb24gPSB0aGlzLnlQb3NpdGlvbiA9PT0gJ3RvcCcgPyBvdmVybGF5LnhDZW50ZXJZQm90dG9tIDogb3ZlcmxheS54Q2VudGVyWVRvcDtcbiAgICB9XG4gICAgcmV0dXJuIHtcbiAgICAgIG9yaWdpblBvc2l0aW9uOiBvcmlnaW5Qb3NpdGlvbixcbiAgICAgIG92ZXJsYXlQb3NpdGlvbjogb3ZlcmxheVBvc2l0aW9uXG4gICAgfVxuICB9XG5cbiAgX2ludmVydFBvc2l0aW9uKHg6IEhvcml6b250YWxDb25uZWN0aW9uUG9zLCB5OiBWZXJ0aWNhbENvbm5lY3Rpb25Qb3MpIHtcbiAgICBpZiAoeCA9PT0gJ3N0YXJ0Jykge1xuICAgICAgeCA9ICdlbmQnXG4gICAgfSBlbHNlIGlmICh4ID09PSAnZW5kJykge1xuICAgICAgeCA9ICdzdGFydCdcbiAgICB9XG5cbiAgICBpZiAoeSA9PT0gJ3RvcCcpIHtcbiAgICAgIHkgPSAnYm90dG9tJztcbiAgICB9IGVsc2UgaWYgKHkgPT09ICdib3R0b20nKSB7XG4gICAgICB5ID0gJ3RvcCc7XG4gICAgfVxuICAgIHJldHVybiB7eCwgeX07XG4gIH1cblxuICBvblBvc2l0aW9uQ2hhbmdlZCAoJGV2ZW50KSB7XG4gICAgaWYgKHRoaXMudHlwZSA9PT0gUnVmRHJvcGRvd25UeXBlLlBvcG92ZXJNZW51IHx8IHRoaXMudHlwZSA9PT0gUnVmRHJvcGRvd25UeXBlLkNvbnRleHRNZW51KSB7XG4gICAgICBpZiAoJGV2ZW50LmNvbm5lY3Rpb25QYWlyLm92ZXJsYXlZID09PSAndG9wJykge1xuICAgICAgICBpZiAoJGV2ZW50LmNvbm5lY3Rpb25QYWlyLm92ZXJsYXlYID09PSAnY2VudGVyJykge1xuICAgICAgICAgIHRoaXMuY2xhc3NOYW1lID0gJ3J1Zi1kcm9wZG93bi1wYW5lbC1jb250YWluZXIgcnVmLXBvcG92ZXItbWVudSBjZW50ZXItYXJyb3ctdXAnO1xuICAgICAgICB9IGVsc2UgaWYgKCRldmVudC5jb25uZWN0aW9uUGFpci5vdmVybGF5WCA9PT0gJ3N0YXJ0Jykge1xuICAgICAgICAgIHRoaXMuY2xhc3NOYW1lID0gJ3J1Zi1kcm9wZG93bi1wYW5lbC1jb250YWluZXIgcnVmLXBvcG92ZXItbWVudSBsZWZ0LWFycm93LXVwJztcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICB0aGlzLmNsYXNzTmFtZSA9ICdydWYtZHJvcGRvd24tcGFuZWwtY29udGFpbmVyIHJ1Zi1wb3BvdmVyLW1lbnUgcmlnaHQtYXJyb3ctdXAnO1xuICAgICAgICB9XG4gICAgICB9IGVsc2UgaWYgKCRldmVudC5jb25uZWN0aW9uUGFpci5vdmVybGF5WSA9PT0gJ2NlbnRlcicpIHtcbiAgICAgICAgaWYgKCRldmVudC5jb25uZWN0aW9uUGFpci5vdmVybGF5WCA9PT0gJ3N0YXJ0Jykge1xuICAgICAgICAgIHRoaXMuY2xhc3NOYW1lID0gJ3J1Zi1kcm9wZG93bi1wYW5lbC1jb250YWluZXIgcnVmLXBvcG92ZXItbWVudSByaWdodC1hcnJvdy1jZW50ZXInO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIHRoaXMuY2xhc3NOYW1lID0gJ3J1Zi1kcm9wZG93bi1wYW5lbC1jb250YWluZXIgcnVmLXBvcG92ZXItbWVudSBsZWZ0LWFycm93LWNlbnRlcic7XG4gICAgICAgIH1cbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGlmICgkZXZlbnQuY29ubmVjdGlvblBhaXIub3ZlcmxheVggPT09ICdjZW50ZXInKSB7XG4gICAgICAgICAgdGhpcy5jbGFzc05hbWUgPSAncnVmLWRyb3Bkb3duLXBhbmVsLWNvbnRhaW5lciBydWYtcG9wb3Zlci1tZW51IGNlbnRlci1hcnJvdy1kb3duJztcbiAgICAgICAgfSBlbHNlIGlmICgkZXZlbnQuY29ubmVjdGlvblBhaXIub3ZlcmxheVggPT09ICdzdGFydCcpIHtcbiAgICAgICAgICB0aGlzLmNsYXNzTmFtZSA9ICdydWYtZHJvcGRvd24tcGFuZWwtY29udGFpbmVyIHJ1Zi1wb3BvdmVyLW1lbnUgbGVmdC1hcnJvdy1kb3duJztcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICB0aGlzLmNsYXNzTmFtZSA9ICdydWYtZHJvcGRvd24tcGFuZWwtY29udGFpbmVyIHJ1Zi1wb3BvdmVyLW1lbnUgcmlnaHQtYXJyb3ctZG93bic7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9IGVsc2UgaWYgKHRoaXMudHlwZSA9PT0gUnVmRHJvcGRvd25UeXBlLkRyb3Bkb3duKSB7XG4gICAgICB0aGlzLmNsYXNzTmFtZSA9ICdydWYtZHJvcGRvd24tcGFuZWwtY29udGFpbmVyJztcbiAgICB9XG4gIH1cblxuICBjbG9zZSgpIHtcbiAgICBpZiAodGhpcy5vcGVuZWQpIHtcbiAgICAgIHRoaXMub3BlbmVkID0gZmFsc2U7XG4gICAgICB0aGlzLl9vdmVybGF5UmVmLmRldGFjaCgpO1xuICAgICAgdGhpcy5vcGVuZWRDaGFuZ2UuZW1pdCh0aGlzLm9wZW5lZCk7XG4gICAgfVxuICB9XG5cbiAgaGFzUG9wdXAoKTogYm9vbGVhbiB7XG4gICAgcmV0dXJuIHRydWU7XG4gIH1cblxuICBoYW5kbGVLZXlkb3duKGV2ZW50KSB7XG4gICAgc3dpdGNoIChldmVudC5rZXlDb2RlKSB7XG4gICAgICBjYXNlIFNQQUNFOlxuICAgICAgY2FzZSBFTlRFUjpcbiAgICAgICAgdGhpcy5vcGVuKCk7XG4gICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgIGV2ZW50LnN0b3BQcm9wYWdhdGlvbigpO1xuICAgICAgICB0aGlzLnRvZ2dsZS5lbWl0KHRydWUpO1xuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgRVNDQVBFOlxuICAgICAgICB0aGlzLmNsb3NlKCk7XG4gICAgICAgIHRoaXMudG9nZ2xlLmVtaXQoZmFsc2UpO1xuICAgICAgICBldmVudC5zdG9wUHJvcGFnYXRpb24oKTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBkZWZhdWx0OlxuICAgIH1cbiAgfVxuXG4gIEBIb3N0TGlzdGVuZXIoJ2NsaWNrJywgWyckZXZlbnQnXSlcbiAgaGFuZGxlQ2xpY2soZXZlbnQpIHtcbiAgICB0aGlzLm9wZW4oKTtcbiAgfVxuXG59XG4iXX0=