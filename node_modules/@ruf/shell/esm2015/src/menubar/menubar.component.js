import * as tslib_1 from "tslib";
import { Input, Output, EventEmitter, Component, ViewEncapsulation, ChangeDetectionStrategy, ElementRef, Renderer2, HostListener, ContentChildren, QueryList, forwardRef } from '@angular/core';
import { RufMenubarItemComponent } from './menubar-item.component';
import { RufKeyboardNavigation } from '../input/keyboard';
import { BehaviorSubject, from, Subject } from 'rxjs';
import { RufMixinBase } from '../common/color/color';
let RufMenubarComponent = class RufMenubarComponent extends RufMixinBase {
    constructor(_elementRef, _renderer) {
        super(_elementRef);
        this._elementRef = _elementRef;
        this._renderer = _renderer;
        this._selectedPathSubject = new BehaviorSubject(this._selectedPath);
        this._selectedPath$ = from(this._selectedPathSubject);
        this._activatedPathSubject = new Subject();
        this._activatedPath$ = from(this._activatedPathSubject);
        // if true, selecting automatically activates the item
        this.autoActivate = true;
        this.direction = 'row';
        /* tslint:disable:no-output-rename */
        // Renaming output to avoid duplicate `select` identifiers
        this.selectEmitter = new EventEmitter();
    }
    ngAfterViewInit() {
        this.addNewKeyboardNav();
        setTimeout(() => this.addTabIndex());
    }
    ngAfterContentInit() {
        this.menuItems.changes.subscribe(() => {
            this.addNewKeyboardNav();
            if (this._keyboardNav) {
                this._keyboardNav.setActiveItemWithoutFocus(this.selectedIndex(this.selectedPath));
            }
        });
    }
    addNewKeyboardNav() {
        this._keyboardNav = new RufKeyboardNavigation();
        this._keyboardNav.setDirection(this.direction);
        this._keyboardNav.init(this._elementRef, this.menuItems).subscribe(item => this.select(item.path, item.data));
    }
    setActiveItem(path) {
        this._keyboardNav.setActiveItemWithoutFocus(this.selectedIndex(path));
        // if path is null, set tabindex to 0 for first menuitem
        if (!path) {
            this.addTabIndex();
        }
    }
    firstChild() {
        return this.menuItems ? this.menuItems.toArray()[0] : null;
    }
    addTabIndex() {
        if (this.firstChild()) {
            this.firstChild().tabindex = 0;
        }
    }
    selectedIndex(path) {
        let index = 0;
        if (path && this.menuItems) {
            index = this.menuItems.toArray().findIndex(menuItem => {
                return menuItem.matches(path);
            });
        }
        return index;
    }
    select(path, data, event) {
        if (!path) {
            this._selectedPath = null;
            return;
        }
        this.selectEmitter.emit({
            path: path,
            data: data,
            event: event
        });
        if (this.autoActivate) {
            this.activate(path);
        }
        this._keyboardNav.focus(path);
        this._activatedPathSubject.next(path);
    }
    activate(path) {
        this._selectedPath = path;
        this._selectedPathSubject.next(path);
    }
    // Selection of an item is driven by this input if it is used.
    // Otherwise, the select method (which is invoked on click of an item) changes the selectedPath automatically.
    // If this property setter is invoked, it turns off automatic selection.
    // Normally, this should only happen when a selectedPath property binding is used.
    set selectedPath(path) {
        this.autoActivate = false;
        this.activate(path);
    }
    get selectedPath() {
        return this._selectedPath;
    }
    get selectedPath$() {
        return this._selectedPath$;
    }
    get activatedPath$() {
        return this._activatedPath$;
    }
    set inkbarPosition(position) {
        this._updateInkbarPosition(position === 'start' ? position : 'end');
    }
    get inkbarPosition() {
        return this._inkbarPosition;
    }
    getLayoutClass() {
        return {
            'ruf-menubar-layout': true,
            'ruf-layout-row': this.direction !== 'column',
            'ruf-layout-column': this.direction === 'column',
            'ruf-layout-row-xs': this.directionXs === 'row',
            'ruf-layout-column-xs': this.directionXs === 'column',
            'ruf-layout-row-sm': this.directionSm === 'row',
            'ruf-layout-column-sm': this.directionSm === 'column',
            'ruf-layout-row-md': this.directionMd === 'row',
            'ruf-layout-column-md': this.directionMd === 'column',
            'ruf-layout-row-lg': this.directionLg === 'row',
            'ruf-layout-column-lg': this.directionLg === 'column',
            'ruf-layout-row-xl': this.directionXl === 'row',
            'ruf-layout-column-xl': this.directionXl === 'column',
            'ruf-layout-row-gt-xs': this.directionGtXs === 'row',
            'ruf-layout-column-gt-xs': this.directionGtXs === 'column',
            'ruf-layout-row-gt-sm': this.directionGtSm === 'row',
            'ruf-layout-column-gt-sm': this.directionGtSm === 'column',
            'ruf-layout-row-gt-md': this.directionGtMd === 'row',
            'ruf-layout-column-gt-md': this.directionGtMd === 'column',
            'ruf-layout-row-gt-lg': this.directionGtLg === 'row',
            'ruf-layout-column-gt-lg': this.directionGtLg === 'column',
            'ruf-layout-row-lt-sm': this.directionLtSm === 'row',
            'ruf-layout-column-lt-sm': this.directionLtSm === 'column',
            'ruf-layout-row-lt-md': this.directionLtMd === 'row',
            'ruf-layout-column-lt-md': this.directionLtMd === 'column',
            'ruf-layout-row-lt-lg': this.directionLtLg === 'row',
            'ruf-layout-column-lt-lg': this.directionLtLg === 'column',
            'ruf-layout-row-lt-xl': this.directionLtXl === 'row',
            'ruf-layout-column-lt-xl': this.directionLtXl === 'column'
        };
    }
    _updateInkbarPosition(position) {
        this._renderer.removeClass(this._elementRef.nativeElement, `ruf-menubar-inkbar-${this._inkbarPosition}`);
        this._renderer.addClass(this._elementRef.nativeElement, `ruf-menubar-inkbar-${position}`);
        this._inkbarPosition = position;
    }
    onKey(event) {
        if (this._keyboardNav && this._keyboardNav.isActive()) {
            this._keyboardNav.onKeyDown(event);
        }
    }
};
tslib_1.__decorate([
    Input('activeColor'),
    tslib_1.__metadata("design:type", Object)
], RufMenubarComponent.prototype, "color", void 0);
tslib_1.__decorate([
    Input(),
    tslib_1.__metadata("design:type", Object)
], RufMenubarComponent.prototype, "direction", void 0);
tslib_1.__decorate([
    Input('direction.xs'),
    tslib_1.__metadata("design:type", Object)
], RufMenubarComponent.prototype, "directionXs", void 0);
tslib_1.__decorate([
    Input('direction.sm'),
    tslib_1.__metadata("design:type", Object)
], RufMenubarComponent.prototype, "directionSm", void 0);
tslib_1.__decorate([
    Input('direction.md'),
    tslib_1.__metadata("design:type", Object)
], RufMenubarComponent.prototype, "directionMd", void 0);
tslib_1.__decorate([
    Input('direction.lg'),
    tslib_1.__metadata("design:type", Object)
], RufMenubarComponent.prototype, "directionLg", void 0);
tslib_1.__decorate([
    Input('direction.xl'),
    tslib_1.__metadata("design:type", Object)
], RufMenubarComponent.prototype, "directionXl", void 0);
tslib_1.__decorate([
    Input('direction.gt-xs'),
    tslib_1.__metadata("design:type", Object)
], RufMenubarComponent.prototype, "directionGtXs", void 0);
tslib_1.__decorate([
    Input('direction.gt-sm'),
    tslib_1.__metadata("design:type", Object)
], RufMenubarComponent.prototype, "directionGtSm", void 0);
tslib_1.__decorate([
    Input('direction.gt-md'),
    tslib_1.__metadata("design:type", Object)
], RufMenubarComponent.prototype, "directionGtMd", void 0);
tslib_1.__decorate([
    Input('direction.gt-lg'),
    tslib_1.__metadata("design:type", Object)
], RufMenubarComponent.prototype, "directionGtLg", void 0);
tslib_1.__decorate([
    Input('direction.lt-sm'),
    tslib_1.__metadata("design:type", Object)
], RufMenubarComponent.prototype, "directionLtSm", void 0);
tslib_1.__decorate([
    Input('direction.lt-md'),
    tslib_1.__metadata("design:type", Object)
], RufMenubarComponent.prototype, "directionLtMd", void 0);
tslib_1.__decorate([
    Input('direction.lt-lg'),
    tslib_1.__metadata("design:type", Object)
], RufMenubarComponent.prototype, "directionLtLg", void 0);
tslib_1.__decorate([
    Input('direction.lt-xl'),
    tslib_1.__metadata("design:type", Object)
], RufMenubarComponent.prototype, "directionLtXl", void 0);
tslib_1.__decorate([
    Output('select'),
    tslib_1.__metadata("design:type", Object)
], RufMenubarComponent.prototype, "selectEmitter", void 0);
tslib_1.__decorate([
    ContentChildren(forwardRef(() => RufMenubarItemComponent)),
    tslib_1.__metadata("design:type", QueryList)
], RufMenubarComponent.prototype, "menuItems", void 0);
tslib_1.__decorate([
    Input(),
    tslib_1.__metadata("design:type", String),
    tslib_1.__metadata("design:paramtypes", [String])
], RufMenubarComponent.prototype, "selectedPath", null);
tslib_1.__decorate([
    Input(),
    tslib_1.__metadata("design:type", String),
    tslib_1.__metadata("design:paramtypes", [String])
], RufMenubarComponent.prototype, "inkbarPosition", null);
tslib_1.__decorate([
    HostListener('keydown', ['$event']),
    tslib_1.__metadata("design:type", Function),
    tslib_1.__metadata("design:paramtypes", [KeyboardEvent]),
    tslib_1.__metadata("design:returntype", void 0)
], RufMenubarComponent.prototype, "onKey", null);
RufMenubarComponent = tslib_1.__decorate([
    Component({
        selector: 'ruf-menubar',
        template: "<div [ngClass]=\"getLayoutClass()\" role=\"menubar\">\n  <ng-content></ng-content>\n</div>\n",
        encapsulation: ViewEncapsulation.None,
        changeDetection: ChangeDetectionStrategy.OnPush,
        styles: ["ruf-menubar{-ms-grid-row-align:stretch;align-self:stretch;display:block}.ruf-menubar-layout{-webkit-box-align:stretch;align-items:stretch;height:100%}.ruf-menu-item{-webkit-box-align:center;align-items:center;border-color:transparent;cursor:pointer;display:-webkit-box;display:flex;-webkit-box-flex:1;flex:1 auto;-webkit-transition:background-color .2s;transition:background-color .2s}.ruf-menu-item:focus{outline:0}.ruf-layout-row{display:-webkit-box;display:flex;-webkit-box-orient:horizontal;-webkit-box-direction:normal;flex-direction:row}.ruf-layout-row>ul{padding-left:0;display:-webkit-box;display:flex;-webkit-box-orient:horizontal;-webkit-box-direction:normal;flex-direction:row;flex-wrap:wrap;width:100%}.ruf-layout-row .ruf-menu-item{border-bottom-width:.125rem;border-top-width:.125rem;-webkit-box-pack:center;justify-content:center;border-style:solid none;padding:.125rem .9375rem}.ruf-menubar-layout.ruf-layout-column{display:-webkit-box;display:flex;-webkit-box-orient:vertical;-webkit-box-direction:normal;flex-direction:column}.ruf-menubar-layout.ruf-layout-column>ul{padding-left:0}.ruf-menubar-layout.ruf-layout-column .ruf-menu-item{border-left-width:.125rem;border-right-width:.125rem;-webkit-box-pack:start;justify-content:flex-start;border-style:none solid;padding:.5rem .9375rem}@media (min-width:0) and (max-width:599px){.ruf-layout-row-xs{display:-webkit-box;display:flex;-webkit-box-orient:horizontal;-webkit-box-direction:normal;flex-direction:row}.ruf-layout-row-xs>ul{padding-left:0;display:-webkit-box;display:flex;-webkit-box-orient:horizontal;-webkit-box-direction:normal;flex-direction:row;flex-wrap:wrap;width:100%}.ruf-layout-row-xs .ruf-menu-item{border-bottom-width:.125rem;border-top-width:.125rem;-webkit-box-pack:center;justify-content:center;border-style:solid none;padding:.125rem .9375rem}.ruf-layout-column-xs{display:-webkit-box;display:flex;-webkit-box-orient:vertical;-webkit-box-direction:normal;flex-direction:column}.ruf-layout-column-xs>ul{padding-left:0}.ruf-layout-column-xs .ruf-menu-item{border-left-width:.125rem;border-right-width:.125rem;-webkit-box-pack:start;justify-content:flex-start;border-style:none solid;padding:.5rem .9375rem}}@media (min-width:600px) and (max-width:959px){.ruf-layout-row-sm{display:-webkit-box;display:flex;-webkit-box-orient:horizontal;-webkit-box-direction:normal;flex-direction:row}.ruf-layout-row-sm>ul{padding-left:0;display:-webkit-box;display:flex;-webkit-box-orient:horizontal;-webkit-box-direction:normal;flex-direction:row;flex-wrap:wrap;width:100%}.ruf-layout-row-sm .ruf-menu-item{border-bottom-width:.125rem;border-top-width:.125rem;-webkit-box-pack:center;justify-content:center;border-style:solid none;padding:.125rem .9375rem}.ruf-layout-column-sm{display:-webkit-box;display:flex;-webkit-box-orient:vertical;-webkit-box-direction:normal;flex-direction:column}.ruf-layout-column-sm>ul{padding-left:0}.ruf-layout-column-sm .ruf-menu-item{border-left-width:.125rem;border-right-width:.125rem;-webkit-box-pack:start;justify-content:flex-start;border-style:none solid;padding:.5rem .9375rem}}@media (min-width:960px) and (max-width:1279px){.ruf-layout-row-md{display:-webkit-box;display:flex;-webkit-box-orient:horizontal;-webkit-box-direction:normal;flex-direction:row}.ruf-layout-row-md>ul{padding-left:0;display:-webkit-box;display:flex;-webkit-box-orient:horizontal;-webkit-box-direction:normal;flex-direction:row;flex-wrap:wrap;width:100%}.ruf-layout-row-md .ruf-menu-item{border-bottom-width:.125rem;border-top-width:.125rem;-webkit-box-pack:center;justify-content:center;border-style:solid none;padding:.125rem .9375rem}.ruf-layout-column-md{display:-webkit-box;display:flex;-webkit-box-orient:vertical;-webkit-box-direction:normal;flex-direction:column}.ruf-layout-column-md>ul{padding-left:0}.ruf-layout-column-md .ruf-menu-item{border-left-width:.125rem;border-right-width:.125rem;-webkit-box-pack:start;justify-content:flex-start;border-style:none solid;padding:.5rem .9375rem}}@media (min-width:1280px) and (max-width:1919px){.ruf-layout-row-lg{display:-webkit-box;display:flex;-webkit-box-orient:horizontal;-webkit-box-direction:normal;flex-direction:row}.ruf-layout-row-lg>ul{padding-left:0;display:-webkit-box;display:flex;-webkit-box-orient:horizontal;-webkit-box-direction:normal;flex-direction:row;flex-wrap:wrap;width:100%}.ruf-layout-row-lg .ruf-menu-item{border-bottom-width:.125rem;border-top-width:.125rem;-webkit-box-pack:center;justify-content:center;border-style:solid none;padding:.125rem .9375rem}.ruf-layout-column-lg{display:-webkit-box;display:flex;-webkit-box-orient:vertical;-webkit-box-direction:normal;flex-direction:column}.ruf-layout-column-lg>ul{padding-left:0}.ruf-layout-column-lg .ruf-menu-item{border-left-width:.125rem;border-right-width:.125rem;-webkit-box-pack:start;justify-content:flex-start;border-style:none solid;padding:.5rem .9375rem}}@media (min-width:1920px){.ruf-layout-row-xl{display:-webkit-box;display:flex;-webkit-box-orient:horizontal;-webkit-box-direction:normal;flex-direction:row}.ruf-layout-row-xl>ul{padding-left:0;display:-webkit-box;display:flex;-webkit-box-orient:horizontal;-webkit-box-direction:normal;flex-direction:row;flex-wrap:wrap;width:100%}.ruf-layout-row-xl .ruf-menu-item{border-bottom-width:.125rem;border-top-width:.125rem;-webkit-box-pack:center;justify-content:center;border-style:solid none;padding:.125rem .9375rem}.ruf-layout-column-xl{display:-webkit-box;display:flex;-webkit-box-orient:vertical;-webkit-box-direction:normal;flex-direction:column}.ruf-layout-column-xl>ul{padding-left:0}.ruf-layout-column-xl .ruf-menu-item{border-left-width:.125rem;border-right-width:.125rem;-webkit-box-pack:start;justify-content:flex-start;border-style:none solid;padding:.5rem .9375rem}}@media (min-width:600px){.ruf-layout-row-gt-xs{display:-webkit-box;display:flex;-webkit-box-orient:horizontal;-webkit-box-direction:normal;flex-direction:row}.ruf-layout-row-gt-xs>ul{padding-left:0;display:-webkit-box;display:flex;-webkit-box-orient:horizontal;-webkit-box-direction:normal;flex-direction:row;flex-wrap:wrap;width:100%}.ruf-layout-row-gt-xs .ruf-menu-item{border-bottom-width:.125rem;border-top-width:.125rem;-webkit-box-pack:center;justify-content:center;border-style:solid none;padding:.125rem .9375rem}.ruf-layout-column-gt-xs{display:-webkit-box;display:flex;-webkit-box-orient:vertical;-webkit-box-direction:normal;flex-direction:column}.ruf-layout-column-gt-xs>ul{padding-left:0}.ruf-layout-column-gt-xs .ruf-menu-item{border-left-width:.125rem;border-right-width:.125rem;-webkit-box-pack:start;justify-content:flex-start;border-style:none solid;padding:.5rem .9375rem}}@media (min-width:960px){.ruf-layout-row-gt-sm{display:-webkit-box;display:flex;-webkit-box-orient:horizontal;-webkit-box-direction:normal;flex-direction:row}.ruf-layout-row-gt-sm>ul{padding-left:0;display:-webkit-box;display:flex;-webkit-box-orient:horizontal;-webkit-box-direction:normal;flex-direction:row;flex-wrap:wrap;width:100%}.ruf-layout-row-gt-sm .ruf-menu-item{border-bottom-width:.125rem;border-top-width:.125rem;-webkit-box-pack:center;justify-content:center;border-style:solid none;padding:.125rem .9375rem}.ruf-layout-column-gt-sm{display:-webkit-box;display:flex;-webkit-box-orient:vertical;-webkit-box-direction:normal;flex-direction:column}.ruf-layout-column-gt-sm>ul{padding-left:0}.ruf-layout-column-gt-sm .ruf-menu-item{border-left-width:.125rem;border-right-width:.125rem;-webkit-box-pack:start;justify-content:flex-start;border-style:none solid;padding:.5rem .9375rem}}@media (min-width:1280px){.ruf-layout-row-gt-md{display:-webkit-box;display:flex;-webkit-box-orient:horizontal;-webkit-box-direction:normal;flex-direction:row}.ruf-layout-row-gt-md>ul{padding-left:0;display:-webkit-box;display:flex;-webkit-box-orient:horizontal;-webkit-box-direction:normal;flex-direction:row;flex-wrap:wrap;width:100%}.ruf-layout-row-gt-md .ruf-menu-item{border-bottom-width:.125rem;border-top-width:.125rem;-webkit-box-pack:center;justify-content:center;border-style:solid none;padding:.125rem .9375rem}.ruf-layout-column-gt-md{display:-webkit-box;display:flex;-webkit-box-orient:vertical;-webkit-box-direction:normal;flex-direction:column}.ruf-layout-column-gt-md>ul{padding-left:0}.ruf-layout-column-gt-md .ruf-menu-item{border-left-width:.125rem;border-right-width:.125rem;-webkit-box-pack:start;justify-content:flex-start;border-style:none solid;padding:.5rem .9375rem}}@media (min-width:1920px){.ruf-layout-row-gt-lg{display:-webkit-box;display:flex;-webkit-box-orient:horizontal;-webkit-box-direction:normal;flex-direction:row}.ruf-layout-row-gt-lg>ul{padding-left:0;display:-webkit-box;display:flex;-webkit-box-orient:horizontal;-webkit-box-direction:normal;flex-direction:row;flex-wrap:wrap;width:100%}.ruf-layout-row-gt-lg .ruf-menu-item{border-bottom-width:.125rem;border-top-width:.125rem;-webkit-box-pack:center;justify-content:center;border-style:solid none;padding:.125rem .9375rem}.ruf-layout-column-gt-lg{display:-webkit-box;display:flex;-webkit-box-orient:vertical;-webkit-box-direction:normal;flex-direction:column}.ruf-layout-column-gt-lg>ul{padding-left:0}.ruf-layout-column-gt-lg .ruf-menu-item{border-left-width:.125rem;border-right-width:.125rem;-webkit-box-pack:start;justify-content:flex-start;border-style:none solid;padding:.5rem .9375rem}}"]
    }),
    tslib_1.__metadata("design:paramtypes", [ElementRef, Renderer2])
], RufMenubarComponent);
export { RufMenubarComponent };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibWVudWJhci5jb21wb25lbnQuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9AcnVmL3NoZWxsLyIsInNvdXJjZXMiOlsic3JjL21lbnViYXIvbWVudWJhci5jb21wb25lbnQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IjtBQUFBLE9BQU8sRUFDTCxLQUFLLEVBQ0wsTUFBTSxFQUNOLFlBQVksRUFDWixTQUFTLEVBQ1QsaUJBQWlCLEVBQ2pCLHVCQUF1QixFQUV2QixVQUFVLEVBQ1YsU0FBUyxFQUNULFlBQVksRUFHWixlQUFlLEVBQ2YsU0FBUyxFQUNULFVBQVUsRUFDWCxNQUFNLGVBQWUsQ0FBQztBQUV2QixPQUFPLEVBQWlCLHVCQUF1QixFQUFDLE1BQU0sMEJBQTBCLENBQUM7QUFDakYsT0FBTyxFQUFDLHFCQUFxQixFQUFDLE1BQU0sbUJBQW1CLENBQUM7QUFDeEQsT0FBTyxFQUFDLGVBQWUsRUFBRSxJQUFJLEVBQWMsT0FBTyxFQUFDLE1BQU0sTUFBTSxDQUFDO0FBRWhFLE9BQU8sRUFBRSxZQUFZLEVBQWUsTUFBTSx1QkFBdUIsQ0FBQztBQVNsRSxJQUFhLG1CQUFtQixHQUFoQyxNQUFhLG1CQUFvQixTQUFRLFlBQVk7SUErQ25ELFlBQW1CLFdBQXVCLEVBQVksU0FBb0I7UUFDeEUsS0FBSyxDQUFDLFdBQVcsQ0FBQyxDQUFDO1FBREYsZ0JBQVcsR0FBWCxXQUFXLENBQVk7UUFBWSxjQUFTLEdBQVQsU0FBUyxDQUFXO1FBM0NsRSx5QkFBb0IsR0FBb0IsSUFBSSxlQUFlLENBQUMsSUFBSSxDQUFDLGFBQWEsQ0FBQyxDQUFDO1FBQ2hGLG1CQUFjLEdBQXVCLElBQUksQ0FBQyxJQUFJLENBQUMsb0JBQW9CLENBQUMsQ0FBQztRQUVyRSwwQkFBcUIsR0FBb0IsSUFBSSxPQUFPLEVBQUUsQ0FBQztRQUN2RCxvQkFBZSxHQUF1QixJQUFJLENBQUMsSUFBSSxDQUFDLHFCQUFxQixDQUFDLENBQUM7UUFLL0Usc0RBQXNEO1FBQzlDLGlCQUFZLEdBQUcsSUFBSSxD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O0FBRVQ7SUFBekIsS0FBSyxDQUFDLGlCQUFpQixDQUFDOzswREFBZTtBQUNkO0lBQXpCLEtBQUssQ0FBQyxpQkFBaUIsQ0FBQzs7MERBQWU7QUFDZDtJQUF6QixLQUFLLENBQUMsaUJBQWlCLENBQUM7OzBEQUFlO0FBQ2Q7SUFBekIsS0FBSyxDQUFDLGlCQUFpQixDQUFDOzswREFBZTtBQUVkO0lBQXpCLEtBQUssQ0FBQyxpQkFBaUIsQ0FBQzs7MERBQWU7QUFDZDtJQUF6QixLQUFLLENBQUMsaUJBQWlCLENBQUM7OzBEQUFlO0FBQ2Q7SUFBekIsS0FBSyxDQUFDLGlCQUFpQixDQUFDOzswREFBZTtBQUNkO0lBQXpCLEtBQUssQ0FBQyxpQkFBaUIsQ0FBQzs7MERBQWU7QUFJdEI7SUFBakIsTUFBTSxDQUFDLFFBQVEsQ0FBQzs7MERBQW9EO0FBR3JFO0lBREMsZUFBZSxDQUFDLFVBQVUsQ0FBQyxHQUFHLEVBQUUsQ0FBQyx1QkFBdUIsQ0FBQyxDQUFDO3NDQUNoRCxTQUFTO3NEQUEwQjtBQW9GOUM7SUFEQyxLQUFLLEVBQUU7Ozt1REFJUDtBQWVEO0lBREMsS0FBSyxFQUFFOzs7eURBR1A7QUErQ0Q7SUFEQyxZQUFZLENBQUMsU0FBUyxFQUFFLENBQUMsUUFBUSxDQUFDLENBQUM7OzZDQUN2QixhQUFhOztnREFJekI7QUF4TVUsbUJBQW1CO0lBUC9CLFNBQVMsQ0FBQztRQUNULFFBQVEsRUFBRSxhQUFhO1FBQ3ZCLHdHQUF1QztRQUV2QyxhQUFhLEVBQUUsaUJBQWlCLENBQUMsSUFBSTtRQUNyQyxlQUFlLEVBQUUsdUJBQXVCLENBQUMsTUFBTTs7S0FDaEQsQ0FBQzs2Q0FnRGdDLFVBQVUsRUFBdUIsU0FBUztHQS9DL0QsbUJBQW1CLENBeU0vQjtTQXpNWSxtQkFBbUIiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQge1xuICBJbnB1dCxcbiAgT3V0cHV0LFxuICBFdmVudEVtaXR0ZXIsXG4gIENvbXBvbmVudCxcbiAgVmlld0VuY2Fwc3VsYXRpb24sXG4gIENoYW5nZURldGVjdGlvblN0cmF0ZWd5LFxuICBIb3N0QmluZGluZyxcbiAgRWxlbWVudFJlZixcbiAgUmVuZGVyZXIyLFxuICBIb3N0TGlzdGVuZXIsXG4gIEFmdGVyVmlld0luaXQsXG4gIEFmdGVyQ29udGVudEluaXQsXG4gIENvbnRlbnRDaGlsZHJlbixcbiAgUXVlcnlMaXN0LFxuICBmb3J3YXJkUmVmXG59IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuXG5pbXBvcnQge1J1Zk1lbnViYXJJdGVtLCBSdWZNZW51YmFySXRlbUNvbXBvbmVudH0gZnJvbSAnLi9tZW51YmFyLWl0ZW0uY29tcG9uZW50JztcbmltcG9ydCB7UnVmS2V5Ym9hcmROYXZpZ2F0aW9ufSBmcm9tICcuLi9pbnB1dC9rZXlib2FyZCc7XG5pbXBvcnQge0JlaGF2aW9yU3ViamVjdCwgZnJvbSwgT2JzZXJ2YWJsZSwgU3ViamVjdH0gZnJvbSAncnhqcyc7XG5cbmltcG9ydCB7IFJ1Zk1peGluQmFzZSwgUnVmQ2FuQ29sb3IgfSBmcm9tICcuLi9jb21tb24vY29sb3IvY29sb3InO1xuXG5AQ29tcG9uZW50KHtcbiAgc2VsZWN0b3I6ICdydWYtbWVudWJhcicsXG4gIHRlbXBsYXRlVXJsOiAnLi9tZW51YmFyLmNvbXBvbmVudC5odG1sJyxcbiAgc3R5bGVVcmxzOiBbJy4vbWVudWJhci5jb21wb25lbnQuc2NzcyddLFxuICBlbmNhcHN1bGF0aW9uOiBWaWV3RW5jYXBzdWxhdGlvbi5Ob25lLFxuICBjaGFuZ2VEZXRlY3Rpb246IENoYW5nZURldGVjdGlvblN0cmF0ZWd5Lk9uUHVzaFxufSlcbmV4cG9ydCBjbGFzcyBSdWZNZW51YmFyQ29tcG9uZW50IGV4dGVuZHMgUnVmTWl4aW5CYXNlIGltcGxlbWVudHMgQWZ0ZXJWaWV3SW5pdCwgQWZ0ZXJDb250ZW50SW5pdCwgUnVmQ2FuQ29sb3Ige1xuXG4gIC8vIGRlZmluZXMgd2hpY2ggaXRlbSBpcyBzZWxlY3RlZFxuICBwcml2YXRlIF9zZWxlY3RlZFBhdGg6IHN0cmluZztcbiAgcHJpdmF0ZSBfc2VsZWN0ZWRQYXRoU3ViamVjdDogU3ViamVjdDxzdHJpbmc+ID0gbmV3IEJlaGF2aW9yU3ViamVjdCh0aGlzLl9zZWxlY3RlZFBhdGgpO1xuICBwcml2YXRlIF9zZWxlY3RlZFBhdGgkOiBPYnNlcnZhYmxlPHN0cmluZz4gPSBmcm9tKHRoaXMuX3NlbGVjdGVkUGF0aFN1YmplY3QpO1xuXG4gIHByaXZhdGUgX2FjdGl2YXRlZFBhdGhTdWJqZWN0OiBTdWJqZWN0PHN0cmluZz4gPSBuZXcgU3ViamVjdCgpO1xuICBwcml2YXRlIF9hY3RpdmF0ZWRQYXRoJDogT2JzZXJ2YWJsZTxzdHJpbmc+ID0gZnJvbSh0aGlzLl9hY3RpdmF0ZWRQYXRoU3ViamVjdCk7XG5cbiAgLy8gZGVmaW5lcyB0aGUgcG9zaXRpb24gb2YgdGhlIGlua2JhciByZWxhdGl2ZSB0byB0aGUgZGlyZWN0aW9uIG9mIHRoZSBtZW51YmFyXG4gIHByaXZhdGUgX2lua2JhclBvc2l0aW9uOiBzdHJpbmc7XG5cbiAgLy8gaWYgdHJ1ZSwgc2VsZWN0aW5nIGF1dG9tYXRpY2FsbHkgYWN0aXZhdGVzIHRoZSBpdGVtXG4gIHByaXZhdGUgYXV0b0FjdGl2YXRlID0gdHJ1ZTtcblxuICBwcml2YXRlIF9rZXlib2FyZE5hdjogUnVmS2V5Ym9hcmROYXZpZ2F0aW9uO1xuXG4gIC8qIHRzbGludDpkaXNhYmxlOm5vLWlucHV0LXJlbmFtZSAqL1xuICBASW5wdXQoJ2FjdGl2ZUNvbG9yJykgY29sb3I7XG5cbiAgQElucHV0KCkgZGlyZWN0aW9uID0gJ3Jvdyc7XG5cbiAgLyogdHNsaW50OmRpc2FibGU6bm8taW5wdXQtcmVuYW1lICovXG4gIEBJbnB1dCgnZGlyZWN0aW9uLnhzJykgZGlyZWN0aW9uWHM7XG4gIEBJbnB1dCgnZGlyZWN0aW9uLnNtJykgZGlyZWN0aW9uU207XG4gIEBJbnB1dCgnZGlyZWN0aW9uLm1kJykgZGlyZWN0aW9uTWQ7XG4gIEBJbnB1dCgnZGlyZWN0aW9uLmxnJykgZGlyZWN0aW9uTGc7XG4gIEBJbnB1dCgnZGlyZWN0aW9uLnhsJykgZGlyZWN0aW9uWGw7XG5cbiAgQElucHV0KCdkaXJlY3Rpb24uZ3QteHMnKSBkaXJlY3Rpb25HdFhzO1xuICBASW5wdXQoJ2RpcmVjdGlvbi5ndC1zbScpIGRpcmVjdGlvbkd0U207XG4gIEBJbnB1dCgnZGlyZWN0aW9uLmd0LW1kJykgZGlyZWN0aW9uR3RNZDtcbiAgQElucHV0KCdkaXJlY3Rpb24uZ3QtbGcnKSBkaXJlY3Rpb25HdExnO1xuXG4gIEBJbnB1dCgnZGlyZWN0aW9uLmx0LXNtJykgZGlyZWN0aW9uTHRTbTtcbiAgQElucHV0KCdkaXJlY3Rpb24ubHQtbWQnKSBkaXJlY3Rpb25MdE1kO1xuICBASW5wdXQoJ2RpcmVjdGlvbi5sdC1sZycpIGRpcmVjdGlvbkx0TGc7XG4gIEBJbnB1dCgnZGlyZWN0aW9uLmx0LXhsJykgZGlyZWN0aW9uTHRYbDtcblxuICAvKiB0c2xpbnQ6ZGlzYWJsZTpuby1vdXRwdXQtcmVuYW1lICovXG4gIC8vIFJlbmFtaW5nIG91dHB1dCB0byBhdm9pZCBkdXBsaWNhdGUgYHNlbGVjdGAgaWRlbnRpZmllcnNcbiAgQE91dHB1dCgnc2VsZWN0Jykgc2VsZWN0RW1pdHRlciA9IG5ldyBFdmVudEVtaXR0ZXI8UnVmTWVudWJhckl0ZW0+KCk7XG5cbiAgQENvbnRlbnRDaGlsZHJlbihmb3J3YXJkUmVmKCgpID0+IFJ1Zk1lbnViYXJJdGVtQ29tcG9uZW50KSlcbiAgbWVudUl0ZW1zOiBRdWVyeUxpc3Q8UnVmTWVudWJhckl0ZW1Db21wb25lbnQ+O1xuXG4gIGNvbnN0cnVjdG9yKHB1YmxpYyBfZWxlbWVudFJlZjogRWxlbWVudFJlZiwgcHJvdGVjdGVkIF9yZW5kZXJlcjogUmVuZGVyZXIyKSB7XG4gICAgc3VwZXIoX2VsZW1lbnRSZWYpO1xuICB9XG5cbiAgbmdBZnRlclZpZXdJbml0KCkge1xuICAgIHRoaXMuYWRkTmV3S2V5Ym9hcmROYXYoKTtcbiAgICBzZXRUaW1lb3V0KCgpID0+IHRoaXMuYWRkVGFiSW5kZXgoKSk7XG4gIH1cblxuICBuZ0FmdGVyQ29udGVudEluaXQoKSB7XG4gICAgdGhpcy5tZW51SXRlbXMuY2hhbmdlcy5zdWJzY3JpYmUoKCkgPT4ge1xuICAgICAgdGhpcy5hZGROZXdLZXlib2FyZE5hdigpO1xuICAgICAgaWYgKHRoaXMuX2tleWJvYXJkTmF2KSB7XG4gICAgICAgIHRoaXMuX2tleWJvYXJkTmF2LnNldEFjdGl2ZUl0ZW1XaXRob3V0Rm9jdXModGhpcy5zZWxlY3RlZEluZGV4KHRoaXMuc2VsZWN0ZWRQYXRoKSk7XG4gICAgICB9XG4gICAgfSk7XG4gIH1cblxuICBhZGROZXdLZXlib2FyZE5hdigpIHtcbiAgICB0aGlzLl9rZXlib2FyZE5hdiA9IG5ldyBSdWZLZXlib2FyZE5hdmlnYXRpb24oKTtcbiAgICB0aGlzLl9rZXlib2FyZE5hdi5zZXREaXJlY3Rpb24odGhpcy5kaXJlY3Rpb24pO1xuICAgIHRoaXMuX2tleWJvYXJkTmF2LmluaXQodGhpcy5fZWxlbWVudFJlZiwgdGhpcy5tZW51SXRlbXMpLnN1YnNjcmliZShpdGVtID0+IHRoaXMuc2VsZWN0KGl0ZW0ucGF0aCwgaXRlbS5kYXRhKSk7XG4gIH1cblxuICBzZXRBY3RpdmVJdGVtKHBhdGg6IHN0cmluZykge1xuICAgIHRoaXMuX2tleWJvYXJkTmF2LnNldEFjdGl2ZUl0ZW1XaXRob3V0Rm9jdXModGhpcy5zZWxlY3RlZEluZGV4KHBhdGgpKTtcbiAgICAvLyBpZiBwYXRoIGlzIG51bGwsIHNldCB0YWJpbmRleCB0byAwIGZvciBmaXJzdCBtZW51aXRlbVxuICAgIGlmICghcGF0aCkge1xuICAgICAgdGhpcy5hZGRUYWJJbmRleCgpO1xuICAgIH1cbiAgfVxuXG4gIGZpcnN0Q2hpbGQoKTogUnVmTWVudWJhckl0ZW1Db21wb25lbnQge1xuICAgIHJldHVybiB0aGlzLm1lbnVJdGVtcyA/IHRoaXMubWVudUl0ZW1zLnRvQXJyYXkoKVswXSA6IG51bGw7XG4gIH1cblxuICBhZGRUYWJJbmRleCgpIHtcbiAgICBpZiAodGhpcy5maXJzdENoaWxkKCkpIHtcbiAgICAgIHRoaXMuZmlyc3RDaGlsZCgpLnRhYmluZGV4ID0gMDtcbiAgICB9XG4gIH1cblxuICBzZWxlY3RlZEluZGV4KHBhdGg6IHN0cmluZyk6IG51bWJlciB7XG4gICAgbGV0IGluZGV4ID0gMDtcbiAgICBpZiAocGF0aCAmJiB0aGlzLm1lbnVJdGVtcykge1xuICAgICAgaW5kZXggPSB0aGlzLm1lbnVJdGVtcy50b0FycmF5KCkuZmluZEluZGV4KG1lbnVJdGVtID0+IHtcbiAgICAgICAgcmV0dXJuIG1lbnVJdGVtLm1hdGNoZXMocGF0aCk7XG4gICAgICB9KTtcbiAgICB9XG4gICAgcmV0dXJuIGluZGV4O1xuICB9XG5cbiAgc2VsZWN0KHBhdGg/OiBzdHJpbmcsIGRhdGE/OiBhbnksIGV2ZW50PzogYW55KSB7XG4gICAgaWYgKCFwYXRoKSB7XG4gICAgICB0aGlzLl9zZWxlY3RlZFBhdGggPSBudWxsO1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIHRoaXMuc2VsZWN0RW1pdHRlci5lbWl0KHtcbiAgICAgIHBhdGg6IHBhdGgsXG4gICAgICBkYXRhOiBkYXRhLFxuICAgICAgZXZlbnQ6IGV2ZW50XG4gICAgfSk7XG5cbiAgICBpZiAodGhpcy5hdXRvQWN0aXZhdGUpIHtcbiAgICAgIHRoaXMuYWN0aXZhdGUocGF0aCk7XG4gICAgfVxuXG4gICAgdGhpcy5fa2V5Ym9hcmROYXYuZm9jdXMocGF0aCk7XG4gICAgdGhpcy5fYWN0aXZhdGVkUGF0aFN1YmplY3QubmV4dChwYXRoKTtcbiAgfVxuXG4gIGFjdGl2YXRlKHBhdGg6IHN0cmluZykge1xuICAgIHRoaXMuX3NlbGVjdGVkUGF0aCA9IHBhdGg7XG4gICAgdGhpcy5fc2VsZWN0ZWRQYXRoU3ViamVjdC5uZXh0KHBhdGgpO1xuICB9XG5cbiAgLy8gU2VsZWN0aW9uIG9mIGFuIGl0ZW0gaXMgZHJpdmVuIGJ5IHRoaXMgaW5wdXQgaWYgaXQgaXMgdXNlZC5cbiAgLy8gT3RoZXJ3aXNlLCB0aGUgc2VsZWN0IG1ldGhvZCAod2hpY2ggaXMgaW52b2tlZCBvbiBjbGljayBvZiBhbiBpdGVtKSBjaGFuZ2VzIHRoZSBzZWxlY3RlZFBhdGggYXV0b21hdGljYWxseS5cbiAgLy8gSWYgdGhpcyBwcm9wZXJ0eSBzZXR0ZXIgaXMgaW52b2tlZCwgaXQgdHVybnMgb2ZmIGF1dG9tYXRpYyBzZWxlY3Rpb24uXG4gIC8vIE5vcm1hbGx5LCB0aGlzIHNob3VsZCBvbmx5IGhhcHBlbiB3aGVuIGEgc2VsZWN0ZWRQYXRoIHByb3BlcnR5IGJpbmRpbmcgaXMgdXNlZC5cbiAgQElucHV0KClcbiAgc2V0IHNlbGVjdGVkUGF0aChwYXRoOiBzdHJpbmcpIHtcbiAgICB0aGlzLmF1dG9BY3RpdmF0ZSA9IGZhbHNlO1xuICAgIHRoaXMuYWN0aXZhdGUocGF0aCk7XG4gIH1cblxuICBnZXQgc2VsZWN0ZWRQYXRoKCkge1xuICAgIHJldHVybiB0aGlzLl9zZWxlY3RlZFBhdGg7XG4gIH1cblxuICBnZXQgc2VsZWN0ZWRQYXRoJCgpIHtcbiAgICByZXR1cm4gdGhpcy5fc2VsZWN0ZWRQYXRoJDtcbiAgfVxuXG4gIGdldCBhY3RpdmF0ZWRQYXRoJCgpIHtcbiAgICByZXR1cm4gdGhpcy5fYWN0aXZhdGVkUGF0aCQ7XG4gIH1cblxuICBASW5wdXQoKVxuICBzZXQgaW5rYmFyUG9zaXRpb24ocG9zaXRpb246IHN0cmluZykge1xuICAgIHRoaXMuX3VwZGF0ZUlua2JhclBvc2l0aW9uKHBvc2l0aW9uID09PSAnc3RhcnQnID8gcG9zaXRpb24gOiAnZW5kJyk7XG4gIH1cblxuICBnZXQgaW5rYmFyUG9zaXRpb24oKSB7XG4gICAgcmV0dXJuIHRoaXMuX2lua2JhclBvc2l0aW9uO1xuICB9XG5cbiAgZ2V0TGF5b3V0Q2xhc3MoKSB7XG4gICAgcmV0dXJuIHtcbiAgICAgICdydWYtbWVudWJhci1sYXlvdXQnOiB0cnVlLFxuICAgICAgJ3J1Zi1sYXlvdXQtcm93JzogdGhpcy5kaXJlY3Rpb24gIT09ICdjb2x1bW4nLFxuICAgICAgJ3J1Zi1sYXlvdXQtY29sdW1uJzogdGhpcy5kaXJlY3Rpb24gPT09ICdjb2x1bW4nLFxuICAgICAgJ3J1Zi1sYXlvdXQtcm93LXhzJzogdGhpcy5kaXJlY3Rpb25YcyA9PT0gJ3JvdycsXG4gICAgICAncnVmLWxheW91dC1jb2x1bW4teHMnOiB0aGlzLmRpcmVjdGlvblhzID09PSAnY29sdW1uJyxcbiAgICAgICdydWYtbGF5b3V0LXJvdy1zbSc6IHRoaXMuZGlyZWN0aW9uU20gPT09ICdyb3cnLFxuICAgICAgJ3J1Zi1sYXlvdXQtY29sdW1uLXNtJzogdGhpcy5kaXJlY3Rpb25TbSA9PT0gJ2NvbHVtbicsXG4gICAgICAncnVmLWxheW91dC1yb3ctbWQnOiB0aGlzLmRpcmVjdGlvbk1kID09PSAncm93JyxcbiAgICAgICdydWYtbGF5b3V0LWNvbHVtbi1tZCc6IHRoaXMuZGlyZWN0aW9uTWQgPT09ICdjb2x1bW4nLFxuICAgICAgJ3J1Zi1sYXlvdXQtcm93LWxnJzogdGhpcy5kaXJlY3Rpb25MZyA9PT0gJ3JvdycsXG4gICAgICAncnVmLWxheW91dC1jb2x1bW4tbGcnOiB0aGlzLmRpcmVjdGlvbkxnID09PSAnY29sdW1uJyxcbiAgICAgICdydWYtbGF5b3V0LXJvdy14bCc6IHRoaXMuZGlyZWN0aW9uWGwgPT09ICdyb3cnLFxuICAgICAgJ3J1Zi1sYXlvdXQtY29sdW1uLXhsJzogdGhpcy5kaXJlY3Rpb25YbCA9PT0gJ2NvbHVtbicsXG4gICAgICAncnVmLWxheW91dC1yb3ctZ3QteHMnOiB0aGlzLmRpcmVjdGlvbkd0WHMgPT09ICdyb3cnLFxuICAgICAgJ3J1Zi1sYXlvdXQtY29sdW1uLWd0LXhzJzogdGhpcy5kaXJlY3Rpb25HdFhzID09PSAnY29sdW1uJyxcbiAgICAgICdydWYtbGF5b3V0LXJvdy1ndC1zbSc6IHRoaXMuZGlyZWN0aW9uR3RTbSA9PT0gJ3JvdycsXG4gICAgICAncnVmLWxheW91dC1jb2x1bW4tZ3Qtc20nOiB0aGlzLmRpcmVjdGlvbkd0U20gPT09ICdjb2x1bW4nLFxuICAgICAgJ3J1Zi1sYXlvdXQtcm93LWd0LW1kJzogdGhpcy5kaXJlY3Rpb25HdE1kID09PSAncm93JyxcbiAgICAgICdydWYtbGF5b3V0LWNvbHVtbi1ndC1tZCc6IHRoaXMuZGlyZWN0aW9uR3RNZCA9PT0gJ2NvbHVtbicsXG4gICAgICAncnVmLWxheW91dC1yb3ctZ3QtbGcnOiB0aGlzLmRpcmVjdGlvbkd0TGcgPT09ICdyb3cnLFxuICAgICAgJ3J1Zi1sYXlvdXQtY29sdW1uLWd0LWxnJzogdGhpcy5kaXJlY3Rpb25HdExnID09PSAnY29sdW1uJyxcbiAgICAgICdydWYtbGF5b3V0LXJvdy1sdC1zbSc6IHRoaXMuZGlyZWN0aW9uTHRTbSA9PT0gJ3JvdycsXG4gICAgICAncnVmLWxheW91dC1jb2x1bW4tbHQtc20nOiB0aGlzLmRpcmVjdGlvbkx0U20gPT09ICdjb2x1bW4nLFxuICAgICAgJ3J1Zi1sYXlvdXQtcm93LWx0LW1kJzogdGhpcy5kaXJlY3Rpb25MdE1kID09PSAncm93JyxcbiAgICAgICdydWYtbGF5b3V0LWNvbHVtbi1sdC1tZCc6IHRoaXMuZGlyZWN0aW9uTHRNZCA9PT0gJ2NvbHVtbicsXG4gICAgICAncnVmLWxheW91dC1yb3ctbHQtbGcnOiB0aGlzLmRpcmVjdGlvbkx0TGcgPT09ICdyb3cnLFxuICAgICAgJ3J1Zi1sYXlvdXQtY29sdW1uLWx0LWxnJzogdGhpcy5kaXJlY3Rpb25MdExnID09PSAnY29sdW1uJyxcbiAgICAgICdydWYtbGF5b3V0LXJvdy1sdC14bCc6IHRoaXMuZGlyZWN0aW9uTHRYbCA9PT0gJ3JvdycsXG4gICAgICAncnVmLWxheW91dC1jb2x1bW4tbHQteGwnOiB0aGlzLmRpcmVjdGlvbkx0WGwgPT09ICdjb2x1bW4nXG4gICAgfVxuICB9XG5cbiAgcHJpdmF0ZSBfdXBkYXRlSW5rYmFyUG9zaXRpb24ocG9zaXRpb246IHN0cmluZykge1xuICAgIHRoaXMuX3JlbmRlcmVyLnJlbW92ZUNsYXNzKHRoaXMuX2VsZW1lbnRSZWYubmF0aXZlRWxlbWVudCwgYHJ1Zi1tZW51YmFyLWlua2Jhci0ke3RoaXMuX2lua2JhclBvc2l0aW9ufWApO1xuICAgIHRoaXMuX3JlbmRlcmVyLmFkZENsYXNzKHRoaXMuX2VsZW1lbnRSZWYubmF0aXZlRWxlbWVudCwgYHJ1Zi1tZW51YmFyLWlua2Jhci0ke3Bvc2l0aW9ufWApO1xuICAgIHRoaXMuX2lua2JhclBvc2l0aW9uID0gcG9zaXRpb247XG4gIH1cblxuICBASG9zdExpc3RlbmVyKCdrZXlkb3duJywgWyckZXZlbnQnXSlcbiAgb25LZXkoZXZlbnQ6IEtleWJvYXJkRXZlbnQpIHtcbiAgICBpZiAodGhpcy5fa2V5Ym9hcmROYXYgJiYgdGhpcy5fa2V5Ym9hcmROYXYuaXNBY3RpdmUoKSkge1xuICAgICAgdGhpcy5fa2V5Ym9hcmROYXYub25LZXlEb3duKGV2ZW50KTtcbiAgICB9XG4gIH1cbn1cbiJdfQ==