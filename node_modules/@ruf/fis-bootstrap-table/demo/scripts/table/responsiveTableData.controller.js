(function () {
  'use strict';

  angular
    .module('demo-fisBootstrapTable.table')
    .controller('responsiveTableData', responsiveTableData);

  responsiveTableData.$inject = ['$scope', 'TableDataService'];

  function responsiveTableData($scope, TableDataService) {
    $scope.displayDataCollection = [];
    $scope.roles = [];
    $scope.init = function (name) {
      $scope.tablename = name;
    };

    $scope.loadServerData = function () {
      TableDataService.getTableContent('all').then(function (data) {
        var dataArray = data.tableRowData;

        $scope.tableDataArr = dataArray.slice(0, 9); // to show less records in
        // demo content of table
        // as per KIm's request

        $scope.roles = [{
          id: 0,
          name: $scope.tableDataArr[0].title2,
          checkValue: true
        }, {
          id: 1,
          name: $scope.tableDataArr[0].title3,
          checkValue: true
        }, {
          id: 2,
          name: $scope.tableDataArr[0].title4,
          checkValue: true
        }];

        // make first time sort as sort by first row
        $scope.tableDataArr.sort(function (a, b) {
          return a.data1.localeCompare(b.data1);
        });

        // copy the references (you could clone
        // ie angular.copy but then have to go
        // through a dirty checking for the
        // matches)
        $scope.displayDataCollection = [].concat($scope.tableDataArr);
      }, function (ex) {
        if (ex.status !== 401 && ex.status !== 403) {
          alert('Error retrieving the table json data!!');
        }
      });
    };
    $scope.loadServerData();
    // for toggling the expand/collapse row
    // icon
    $scope.toggleDetail = function ($index) {
      $scope.activePosition = ($scope.activePosition === $index) ? -1 : $index;
    };
    // to remove the row item on the table
    $scope.removeRow = function removeRow(row) {
      var index = $scope.displayDataCollection.indexOf(row);
      if (index !== -1) {
        $scope.displayDataCollection.splice(index, 1);
      }
    };

    // for adding a new row on the table
    $scope.addRow = function () {
      var newData = {
        title1: 'Name',
        title2: 'Phone',
        title3: 'Date of Birth',
        title4: 'Type',
        data1: 'New',
        data2: 'Record',
        data3: '610-55-1212',
        data4: '30/06/1975',
        data5: 'Individual',
        taxid: '234-987-4567',
        role: 'Customer',
        license: '9876123456-123',
        alias: 'New',
        amount: '199'
      };
      $scope.displayDataCollection.push(newData);
    };

    $scope.showMessage = function showMessage(row) {
      alert('Hi... ' + row.alias);
    };

    $scope.addAmount = function () {
      var totalAmount = 0.0;
      for (var i = 0; i < $scope.displayDataCollection.length; i++) {
        if ($scope.displayDataCollection[i]) {
          totalAmount = parseFloat($scope.displayDataCollection[i].amount) + parseFloat(totalAmount);
        }
      }

      return totalAmount;
    };
  }
})();
