# Theming

RUF builds on top of the Angular Material library themes feature to provide a powerful way to create different themes for your application.

The `@ruf/theming` package provides Sass mixins and functions to help you create your own theme. If your project already has a dependency on the `@ruf/shell` package, these are also available under the `node_modules/@ruf/shell/theming/styles` folder.

## How it works

A theme is a collection of 6 color palettes:

* primary
* accent
* emphasis
* warn
* foreground
* background

These palettes contain the only colors you should be using in your application and your stylesheets should pick the colors from these palettes instead of hard-coding them (e.g. ruf-color($primary) instead of ##00565b).

Each RUF component and any other component compatible with our themes like all @angular/material components define a separate SCSS stylesheet specifically for colors. For example:

```bash
src/app/menubar
├── _menubar.theme.scss
├── menubar.component.html
├── menubar.component.scss
├── menubar.component.ts
└── ...
```

As you can see in the above folder, we have a `_menubar.theme.scss` file. It is in this file that we define all the CSS rules that are related to color like border-color, color, background-color, etc...

The underscore denotes that this file doesn't actually produce any CSS output by itself. It simply declares a Sass mixin:

```scss
@import 'node_modules/@ruf/theming/styles/theming/theming';

@mixin ruf-menubar-theme($theme) {

  /* this is not the actual theme file of menubar */
  $primary: map-get($theme, primary); // here we grab the primary color palette from the theme
  $background: map-get($theme, background);

  .ruf-menubar {
    border-bottom-color: ruf-color($primary);
    border-right-color: ruf-color($primary, default); // same as above
    border-left-color: ruf-color($primary, lighter);
    border-top-color: ruf-color($primary, darker);
  }

  .ruf-menubar-selected {
    background-color: ruf-color($background, hover); // we use the hover color from the background palette
  }
}
```

The `menubar.component.scss` file only include what we call the structural styles of the component and is the file that is linked to by the component's styleUrls property. For example:

```scss
  .ruf-menubar {
    border-width: 1px;
    border-style: solid;
    /* no border color here since this file doesn't know about themes */
  }
```

If you want to create themable components that are compatible with RUF and Angular Material, this is also how you should structure your styles. You generally do not need this for container components but you do for reusable presentational components.

## Create a theme for your application

Creating a theme consists in creating the `$theme` object that gets passed to each of the component's theme mixins. We have Sass functions to help you do that:

```scss
/* Import @angular/material theme */
@import 'node_modules/@angular/material/_theming.scss';

/* Import ruf-theme.scss which contains utility mixins and functions for theming and all the mixins for RUF components */
@import 'node_modules/@ruf/theming/styles/ruf-theme';

// Define the palettes
// The ruf-quick-palette does this quickly for you
$primary: ruf-quick-palette(#872b62);
$accent: ruf-quick-palette(#00a4b6);

/* Create the theme object */
/* default values will be used for other palettes if not provided like in this example */
$theme: ruf-light-theme($primary, $accent);

/* Create the typography object */
/* This is optional parameter. If not passed @ruf/theming uses default configuration*/
$config : ( font-family : 'Roboto, monospace');


/* Include all RUF component's themes */
/* You could also pick and choose only the ones you want */
@include ruf-theme($theme, $config);

/* Include the @angular/material themes */
@include mat-core();
@include angular-material-theme($theme);

/* Include your own component themes below */
```

Once you have that file created, make sure your app knows about it by adding it to the `angular.json` file:

```json
{
  ...

  "projects": {
    "<app-name>": {
    "architect": {
      "build": {
        "styles": [
          ...
          "app/mytheme.scss"
          ]
        }
      }
    }
   }
}
```

You can see an example of a theme in the `node_modules/@ruf/prebuilt-themes/themes` folder. These prebuilt themes provide colors for all @ruf/shell and @angular/material components but if you create your own themable components, you will need to also invoke your application's theme mixins:

```scss
@import './mycomponent/_mycomponent.theme.scss';
@import 'node_modules/@ruf/prebuilt-themes/fis-gold.scss';

// The $theme object was created by the fis-gold prebuilt theme.
@include mycomponent-theme($theme);
```

## Typography

The @ruf/theming library uses and extends the configurable typography feature of the Angular Material2 library.

### Configuring Typography

All components using configurable typography will only use typography levels defined in a provided Sass map. The `ruf-typography-config` function lets you create such a map.

```scss
$config: ruf-typography-config();
```

When invoked without any argument like above, the configuration will only contain RUF's default typography config. See the `ruf-typography-config` documentation below for a list of the default levels.

You can provide an argument if you want to override specific levels:

```scss
$config: ruf-typography-config((
  // if you change the font, make sure your app loads the appropriate font files
  font-family: 'Roboto, "Helvetica Neue", sans-serif',
  title: ruf-typography-level(24px, 1.2, 400)
))
```

We recommend using the provided levels in order to keep typography consistent across your app but if you feel you need to add more for your own components, you can by providing your own levels in the config.

Once you have a typography config map, you can pass it to a library's theme mixin as the second argument.

```scss
// in the case of material mixins, you can pass it to the `mat-core` mixin only
@include mat-core($config);
@include angular-material-theme($theme);

// @ruf/shell library
@include ruf-theme($theme, $config);

// @ruf/material library
@include ruf-material-theme($theme, $config);

// Your own library
@include your-library-theme($theme, $config);
```


### Using the Typography Config

In your component's theme.scss files, you need to create a separate mixin that will contain your component's typography related  CSS rules. This includes font-family, font-size, font weight and line-height.

```scss
@import 'node_modules/@ruf/theming/styles/theming/typography';

@mixin my-component-theme($theme) {
  // deal with colors here
  my-component {
    ...
  }
}

@mixin my-component-typography($config) {
  // deal with typography here
  my-component {
    h1 {
      @include ruf-typography-level-to-styles($config, 'display-4');
    }
  }
}
```

In the above example, `ruf-typography-level-to-styles` is used to generate the appropriate styles for the `display-4` typography level. This will make the text inside your component's h1 tags very big.

Then, in your library's root theme.scss file:

```scss
@import 'node_modules/@ruf/theming/styles/theming/typography';
@import 'my-component.theme.scss';

@mixin my-library-theme($theme, $config: ruf-typography-config()) {
  // here you aggregate all of your components' theme mixins
  @include my-component-theme($theme);

  // and in the end, include the typography mixin defined further down
  @include my-library-typography($config);
}

@mixin my-library-typography($config) {
  // here you aggregate all of your components' typography mixins
  @include my-component-typography($config);
}
```

## Switching themes

Adding the theme to the `angular.json` file is good for development, but if you want your application to be able to switch themes, you need to be able to serve multiple theme files compiled down to CSS. It is then a matter of inserting the CSS you want based on the tenant of your application.

There are different ways of doing this and it depends on how your application knows about tenants which is not something RUF can know. All you need to do however is to add a `link` tag in your index.html that will return the CSS for the current tenant.

```html
<link rel="stylesheet" href="/theme.css">
<!-- backend gets the tenant from URL fragment or session and returns correct theme file -->
```

## _theming.scss

This file is the only one you should need in your component theme files. It also includes the _palette.scss file.

Here are the main functions and mixins defined in this file. Have a look at the code if you want more low level utilities.

### map-get

Signature:

```scss
map-get($map, $key)
```


This is a core Sass function but is needed for grabbing a palette from a $theme map. Available keys in the $theme map are:

* primary
* accent
* emphasis
* warn
* foreground
* background

### ruf-light-theme

Signature:

```scss
ruf-light-theme($primary: ruf-palette($ruf-teal), $accent: ruf-palette($ruf-gold), $emphasis: ruf-palette($ruf-plum), $warn: ruf-palette($ruf-error), $foreground: $ruf-light-theme-foreground, $background: $ruf-light-theme-background)
```


This function will create a $theme object with light backgrounds. All arguments are optional and default colors will be provided for each. You will generally just want to provide the primary, accent, emphasis and warn palettes as argument and omit the last two.

### ruf-color

Signature:

```scss
ruf-color($palette, $hue: default, $opacity: 1)
```


Returns a color from the provided palette.

```scss
$primary: map-get($theme, primary);
...
background-color: ruf-color($primary); // grabs the default color for that palette
color: ruf-color($primary, default-contrast); // grabs the default color's contrast color
```

For the primary, accent, emphasis and warn palettes, the $hue can be one of `default, lighter, darker, 50, 100, 200, 300, 400, 500, 600, 700, 800, 900, A100, A200, A400, A700`. You can append `-contrast` to get the contrast color for any of those.

The foreground and background palettes have different values which are more specific to parts of the UI. You can find their definition in the `$ruf-light-theme-foreground` and `$ruf-light-theme-background` variables of the _palette.scss file.

Foreground             | Background
---------------------- | ----------
base                   | status-bar
divider                | app-bar
dividers               | app-canvas
disabled               | background
disabled-button        | hover
disabled-text          | card
hint-text              | dialog
secondary-text         | disabled-button
icon                   | page-header
icons                  | raised-button
text                   | side-megamenu
slider-min             | footer
slider-off             | nav-bar
slider-off-active      | focused-button
link                   | selected-button
link-visited           | selected-disabled-button
soft-link              | disabled-button-toggle
subtle-divider         | card-canvas
shadow                 | unselected-chip
box-input              | disabled-list-option
                       | error
                       | success
                       | info
### ruf-quick-palette function

Signature:

```scss
ruf-quick-palette($base-color, $base-lighter, $base-darker)
```


Creates a palette derived from a single @base-color. $base-lighter and $base-darker are optional arguments and let you specify the color that in that palette that will be used for "lighter" and the color that will be used for "darker".

## _all-theme.scss

This file imports all of the component's theme.scss files and includes all mixins inside one big mixin called `ruf-theme`. In your own theme's you can import this file and then include this mixin.

```scss
@import 'node_modules/@ruf/shell/styles/all-theme';
...
@include ruf-theme($theme);
```

If you do not want to include all of our component's theme files, you can invoke each mixin individually. Have a look at this file to see each mixin that you can include yourself.

## _base.theme.scss

The base theme includes some utility classes to help you assign background or foreground colors in your application. It gets included when you use the `ruf-theme` mixin mentioned in the _all-theme.scss section above.

You should avoid using these classes in presentational components and use a theme file as described above for those. These classes can be useful in your container components (the ones which assemble multiple components and manage their state). For example, if you have an area that contains two components and you want the full area to have a specific background color, you can assign one of the background classes to the wrapping element.

These classes use `!important` to ensure it will override the element's background color. This makes customization harder and is another reason why it should be avoided in reusable components.

Each of the classes that refer to one of the palettes (primary, accent, emphasis and warn) also have variants with the `-light` and `-dark` suffix. Use those sparingly since the FIS UX Guidelines does not call for many variations of these colors.

## ruf-theme.scss

This file imports all utility mixins and functions for theming and also includes mixins for all RUF components (all-theme.scss). In your theme file, you can also import this file (instead of importing theming.scss and all-theme.scss separately) and then include the `ruf-theme` mixin.


### Background

Class name               | Description
------------------------ | -----------
ruf-background-darker    | Applies a black and 40% opaque background to the element which will have the effect of making the parent's background color darker.
ruf-background-dark      | Applies a black and 18% opaque background to the element which will have the effect of making the parent's background color a bit darker.
ruf-background-transparent| Simple way to remove the background of a component.
ruf-background-light     | Applies a white and 18% opaque background to the element which will have the effect of making the parent's background color a bit lighter.
ruf-background-lighter   | Applies a white and 40% opaque background to the element which will have the effect of making the parent's background color lighter.
ruf-background-primary   | Assigns the primary color to the background and its contrast color to the foreground.
ruf-background-accent    | Assigns the accent color to the background and its contrast color to the foreground.
ruf-background-emphasis  | Assigns the emphasis color to the background and its contrast color to the foreground.
ruf-background-warn      | Assigns the warn color to the background and its contrast color to the foreground.
ruf-background-error     | Assigns the error color to the background
ruf-background-success   | Assigns the success color to the background
ruf-background-info      | Assigns the info color to the background

### Foreground

Class name               | Description
------------------------ | -----------
ruf-foreground-primary   | Assigns the primary color to the foreground.
ruf-foreground-accent    | Assigns the accent color to the foreground.
ruf-foreground-emphasis  | Assigns the emphasis color to the foreground.
ruf-foreground-warn      | Assigns the warn color to the foreground.
### Icons

For use on the parent of one or many icons. This can be useful if you want all the icons of a sidemenu to have a different color for example.

Class name               | Description
------------------------ | -----------
ruf-icon-primary         | Assigns the primary color to the mat-icon descendants.
ruf-icon-accent          | Assigns the accent color to the mat-icon descendants.
ruf-icon-emphasis        | Assigns the emphasis color to the mat-icon descendants.
ruf-icon-warn            | Assigns the warn color to the mat-icon descendants.
ruf-icon-error           | Assigns the error color to the mat-icon descendants.
ruf-icon-success         | Assigns the success color to the mat-icon descendants.

## _core.variables.scss

This file contains variables and functions used throughout RUF's stylesheets but can also be useful in your stylesheets. A notable member is the ruf-to-rem function described below.

### ruf-to-rem

Signature:

```scss
ruf-to-rem($size)
```


This function takes a pixel size and transforms it into a rem value. We use rems as our measurement unit in RUF. This is useful for people who use browser zooming features to enhance readability. A rem is equal to the font size of the document element. In RUF (set in our reset.scss file) we use `$ruf-root-font-size` as the rem size which is set to 16px.

```scss
padding: ruf-to-rem(16px); /* outputs 1rem unless you change the root font-size */
```

## reset.scss

This file sets the root styles to create a uniform base across browsers. This file is added by RUF's index.scss so you likely don't need to do it yourself. All our styling uses this as a base.

If you are creating a library of components that doesn't have a dependency on RUF, you should include this file so that you use the same basis as RUF. We have put a lot of comments in the file to explain the reason for each selector.

## index.scss

This is the framework's main structural stylesheet. It includes the _core.variables.scss and other styling for some of our directives. Angular automatically inlines the styles for each component as it is being used, but this one needs to be added to your application separately. If you used RUF CLI, this has been done for you.
```scss
@import 'node_modules/@ruf/shell/styles/index.scss';
```

## _typography.scss

This file provides typography utility functions and mixins.

### ruf-typography-config

Signature:

```scss
ruf-typography-config(config: null)
```


Returns complete typography configuration. If custom configuration is provided as an argument, it merges it with the base configuration provided.

```scss
@import 'node_modules/@ruf/theming/styles/theming/typography';

$typography-config: ruf-typography-config(
  (
    font-family: 'serif'
  )
);

```

Default typography configuration provided by @ruf/theming.

The following are specific shared between Material and RUF components.

Level                  | Value
---------------------- | ----------
font-family            | 'arial, helvetica, sans-serif'
display-4              | ruf-typography-level(112px, 112px, 300),
display-3              | ruf-typography-level(56px, 56px, 400)
display-2              | ruf-typography-level(45px, 48px, 400),
display-1              | ruf-typography-level(34px, 40px, 400),
headline               | ruf-typography-level(24px, 32px, 400)
title                  | ruf-typography-level(20px, 32px, 500),
subheading-2           | ruf-typography-level(16px, 28px, 400),
subheading-1           | ruf-typography-level(15px, 24px, 400),
body-2                 | ruf-typography-level(14px, 24px, 500),
body-1                 | ruf-typography-level(14px, 20px, 400),
caption                | ruf-typography-level(12px, 20px, 400),
button                 | ruf-typography-level(14px, 1.2, 500),
input                  | ruf-typography-level(inherit, 1.125, 400),
bold                   | ruf-typography-level($font-size: null, $font-weight: 700),

The following are specific to RUF components.

Level                  | Value
---------------------- | ----------
dialog-title           | ruf-typography-level( 18px, 1.125, 400),
expansion-panel        | ruf-typography-level(15px, 20px, 700),
tab-label              | ruf-typography-level($font-size: 0.875rem),
banner-brand-title     | ruf-typography-level( ruf-to-rem($ruf-vunit * 23px)),
menu-label             | ruf-typography-level( $font-size: ruf-to-rem(14px), $line-height: 44px),
ellipsis               | ruf-typography-level(inherit, 16px),
sitemap-title          | ruf-typography-level($font-size: 14px, $font-weight: bold),
dynamic-menubar        | ruf-typography-level($font-size: null, $line-height: 44px),

The following are specific to ngx-charts components.

Level                  | Value
---------------------- | ----------
chart                  | ruf-typography-level(11px, 32px, 500, 'Roboto'),
chart-label            | ruf-typography-level($font-size: 14px, $font-weight: bold)

### Typography Utility Functions

#### ruf-font-size

Signature:

```scss
ruf-font-size($config, $level)
```


Returns font-size for the specified level in the typography configuration.

```scss
my-component {
  font-size: ruf-font-size($config, subtitle);
  ...
}

```

#### ruf-font-weight

Signature:

```scss
ruf-font-weight($config, $level)
```


Returns font-weight for the specified level in the typography configuration.

```scss
my-component {
  font-weight: ruf-font-weight($config, title);
  ...
}

```

#### ruf-line-height

Signature:

```scss
ruf-line-height($config, $level)
```


Returns line-height for the specified level in the typography configuration.

```scss
my-company {
  line-height: ruf-line-height($config, display-4);
  ...
}

```

#### ruf-font-family

Signature:

```scss
ruf-font-family($config, $level)
```


Returns font-family for the specified level in the typography configuration.

```scss
my-component {
  font-family: ruf-font-family($config, title);
  ...
}

```


#### ruf-typography-level-to-styles

Signature:

```scss
ruf-typography-level-to-styles($config, $level)
```


Converts a typography level into CSS styles.

```scss
my-component {
  ruf-typography-level-to-styles($config, banner-brand-title);
  ...
}

```

###  Detection of Light/Dark Background at Runtime
Some of the RUF components (e.g., `ruf-sidemenu`) do not add any background or foreground colors but inherit them from parent. However, the container holding these components can have a lighter or darker background irrespective of whether the overall application uses `light` or `dark` theme.
Sometimes these components have to add specific styling depending on parent's background color at runtime.

RUF uses `light` attribute for such cases. The presence of `light` background suggests that this component has a dark background and styles like hover color etc. should be applied accordingly.

This is just a css selector. It does not add any functionality.

e.g.,
```html
<ruf-sidemenu class="ruf-background-primary-dark" rufId [selectedPath]="selectedPath" (select)="openbasic($event.path)" light>
  <a rufId rufSidemenuItem path="demo/item1">Item 1</a>
  <a rufId rufSidemenuItem path="demo/item2">Item 2</a>
</ruf-sidemenu>
```

**NOTE:** This attribute takes effect only in certain RUF components. Check the corresponding component documentation for details.


## Fonts
RUF uses `Roboto` as default and `Arial` as fallback font.

There are two ways to use roboto font in your application.

### 1. Use @ruf/fis-ux-assets package

The `@ruf/fis-ux-assets` package provides `Roboto` font with minimum styles (400 and 700).
To use `Roboto` font from `@ruf/fis-ux-assets`, 

* Install the package

```sh
npm install --save @ruf/fis-ux-assets
```

* Add `roboto_font.css` file into the angular.json file

```json
style: [
  'node_modules/@ruf/fis-ux-assets/roboto_font.css'
]
```

*Note:* This method can be used for internally deployed apps where internet access may be blocked or all URLs are not whitelisted.

### 2. Google CDN
It is recommended to use CDN directly to download the font. With this, you can select appropriate styles for you application from the available ones.
To use Roboto font from google CDN, copy this code into the `<head>` of your HTML document.

`<link href="https://fonts.googleapis.com/css?family=Roboto:400,700" rel="stylesheet">`

*Note:* This example uses 400 and 700 styles but you can select anything from the available styles. Check [Google Fonts](https://fonts.google.com/) for available options.
