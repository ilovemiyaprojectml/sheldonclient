(function () {
  'use strict';

  angular
    .module('fis.bootstrap.dialog')
    .directive('fisBsOpenDialogOnclick', openDialogOnclick);

  openDialogOnclick.$inject = ['$uibModal', '$parse'];

  function openDialogOnclick($uibModal, $parse) {
    'use strict';
    return {
      restrict: 'A',
      scope: {
        fisBsDialogSize: '@',
        fisBsDialogType: '@',
        fisBsDialogTemplate: '@',
        fisBsDialogCtrl: '@'
      },
      compile: function () {
        return function (scope, elm) {
          scope.fxn = function () {
            scope.openModal(scope.fisBsDialogSize, scope.fisBsDialogType,
              scope.fisBsDialogTemplate, scope.fisBsDialogCtrl);
          };

          scope.items = [scope.fisBsDialogType];

          scope.openModal = function (modalSize, modalType, modalTemplate, modalCtrl) {
            var backdropClass = 'fis-bs-modal-backdrop';
            var backdrop = 'static';
            var windowTemplateUrl = 'dialog/dialog.modal.directive.html';

            if (modalType === 'non-modal') {
              backdropClass = '';
              backdrop = false;
              windowTemplateUrl = 'dialog/dialog.non-modal.directive.html';
            }

            var modalInstance = $uibModal.open({
              templateUrl: modalTemplate,
              controller: modalCtrl,
              windowTemplateUrl: windowTemplateUrl,
              size: modalSize,
              backdropClass: backdropClass,
              backdrop: backdrop,
              resolve: {
                items: function () {
                  return scope.items;
                }
              }
            });

            return modalInstance;
          };

          var exp = $parse('fxn()');

          elm.bind('click', function () {
            exp(scope);
          });
        };
      }
    };
  }
})();

