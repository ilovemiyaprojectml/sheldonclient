!function(){"use strict";var a=["shell"];angular.module("fis.megamenu",a)}(),angular.module("fis.megamenu").controller("fisMain",["$scope",function(a){}]);var fisMegamenuModule=angular.module("fis.megamenu"),shellModule=angular.module("shell");shellModule.config(["fisStartMenuServiceProvider",function(a){a.menuDirectiveName="fis-mega-menu"}]),fisMegamenuModule.directive("fisMegaMenu",["fisPubSubService","$timeout","$filter","fisMegaMenuSearchService","fisI18nService","fisResponsiveService",function(a,b,c,d,e,f){var g=null,h=function(a){g=a};return window.Masonry?h(window.Masonry):"function"==typeof define&&define.amd&&require(["masonry"],function(a){h(a)}),{restrict:"A",scope:!0,require:"^fisStartMenu",template:'<div class="fis-mega-menu"><div class="fis-start-menu-left"><ul class="fis-start-menu-list"><li ng-repeat="item in startMenuModel.menuItems.children" ng-if="item.isPrimaryNav" ng-click="viewModel.menuListItemClicked(item)" class="{{item.view.cls}}" ng-class="{ \'fis-selected\': startMenuModel.selectedMenuItem === item, \'fis-search\': item.view.id === \'SearchItem\' }" fis-unique-id="menu_level_1_{{ item.view.id }}"><div ng-if="item.view.id !== \'SearchItem\'">{{ item.view.label }}</div><div ng-if="item.view.id === \'SearchItem\' && startMenuModel.searchable"><form><input class="fis-icon fis-i-b_lightsearch" type="search" placeholder="{{ getSearchLabel() }}" ng-keyup="searchKeyUp($event)" fis-unique-id="searchbox"  title="{{ getSearchLabel(true) }}"/></form></div></li></ul><div class="fis-start-menu-quick-links-area" ng-show="startMenuModel.selectedMenuItem.view.quickLinks.length > 0"><ul ng-repeat="links in startMenuModel.selectedMenuItem.view.quickLinks" class="fis-navitems"><li class="fis-navitem"><span class="fis-title">{{ links.label }}</span><ul><li fis-unique-id ng-repeat="link in links.children" fis-apply-class-directive="link.cls"><div fis-navigation-link fis-model="link"></div></li></ul></li></ul></div></div><div class="fis-start-menu-content-area" fis-watch-suspend><div><div class="fis-sitemap"><p ng-if="tooShortTerm()" class="fis-notification">{{ getSearchLabel(true) }}</p><ul class="fis-navitems" ng-repeat="tierOneItem in viewModel.flattenViews" ng-if="::tierOneItem.showMenu" data-parent-path="{{::tierOneItem.parent.id }}"><li class="branch {{::tierOneItem.view.cls }}" fis-unique-id="{{::tierOneItem.view.id }}"><span class="fis-title">{{::tierOneItem.view.label }}</span><ul><li ng-repeat="tierTwoItem in ::tierOneItem.children" ng-if="::tierTwoItem.showMenu" ng-class="::{ \'leaf\': tierTwoItem.children.length === 0, \'branch\': tierTwoItem.children.length > 0 }" class="{{::tierTwoItem.view.cls }}" fis-unique-id="{{::tierTwoItem.view.id }}"><span ng-value="::tierTwoItem.view.matched"></span><div ng-if="::(tierTwoItem.children.length === 0)" fis-navigation-link fis-model="::tierTwoItem.view"  ng-class="::{\'fis-search-matched\': tierTwoItem.view.matched === 100}"></div><div ng-if="::(tierTwoItem.children.length > 0)" ><span class="fis-title">{{::tierTwoItem.view.label }}</span><ul><li ng-repeat="tierThreeItem in ::tierTwoItem.children" ng-if="::tierThreeItem.showMenu"  ng-class="::{ \'leaf\': tierThreeItem.children.length === 0, \'branch\': tierThreeItem.children.length > 0 }" class="{{::tierThreeItem.view.cls }}" fis-unique-id="{{::tierThreeItem.view.id }}"><div ng-if="::(tierThreeItem.children.length === 0)" fis-navigation-link fis-model="::tierThreeItem.view" ng-class="::{\'fis-search-matched\': tierThreeItem.view.matched === 100}"></div><div ng-if="::(tierThreeItem.children.length > 0)" ng-class="::{\'fis-search-matched\': tierThreeItem.view.matched === 100}"><span class="fis-title">{{::tierThreeItem.view.label }}</span><ul><li class="leaf {{::tierFourItem.view.cls }}" ng-repeat="tierFourItem in ::tierThreeItem.children" fis-unique-id="{{::tierFourItem.view.id }}" ><div fis-navigation-link fis-model="::tierFourItem.view" ng-class="::{\'fis-search-matched\': tierFourItem.view.matched === 100}"></div><span class="fis-clear-float"></span></li></ul></div><span class="fis-clear-float"></span></li></ul></div><span class="fis-clear-float"></span></li></ul></li></ul></div></div></div></div>',controller:["$scope",function(c){c.viewModel={closingTimeout:null,navLinkClicked:function(){},searchTimeout:null,flattenViews:null,mason:null};var d=c.$parent.startMenuModel,e=c.viewModel;c.IE="Microsoft Internet Explorer",c.hasHiddenChildren=function(a){return _.some(a,function(a){return a.view.id.indexOf(":")>-1})};var f;c.viewModel.menuListItemClicked=function(c){d.selectedMenuItem!=c&&(a.publish("shell.navLoading",!0),f=b(function(){d.selectedMenuItem=c}))},c.$on("$destroy",function(a){f&&(b.cancel(f),f=null)}),c.fisNavigationLinkClicked=function(){c.$parent.startMenuModel.closed=!0},c.$watch("$parent.startMenuModel.closed",function(d){e.searchTimeout&&(b.cancel(e.searchTimeout),e.searchTimeout=null),d===!0?(c.alreadyRan===!0&&(c.timeoutDelay=10),_.isUndefined(c.timeoutDelay)&&(c.timeoutDelay=2e3),b(function(){a.publish("shell.suspendWatch",c),c.alreadyRan=!0},c.timeoutDelay)):b(function(){a.publish("shell.resumeWatch",c)},500,!1)}),c.updateFlattenViews=function(a){var b=[];_.each(a,function(a){b.push(a.children)}),c.viewModel.flattenViews=_.flatten(b)},c.$watch("$parent.startMenuModel.menuItems.children",function(a){c.updateFlattenViews(a)})}],link:function(h,i,j){function k(b,c){a.publish("shell.navLoading",!1)}function l(){if(g){var a=document.querySelector(".fis-sitemap"),b=h.viewModel.mason;return!_.isNull(b)&&!_.isUndefined(b)||_.isNull(a)||_.isUndefined(a)||(h.viewModel.mason=new g(a,{columnWidth:260,itemSelector:".fis-navitems",transitionDuration:0}),h.viewModel.mason.on("layoutComplete",k)),h.viewModel.mason}}function m(){n(void 0,!0)}function n(c,d){if(g){c||h.$parent.startMenuModel.selectedMenuItem&&(c=h.$parent.startMenuModel.selectedMenuItem.view.id);var e=h.viewModel.mason;(_.isNull(e)||_.isUndefined(e))&&(e=l()),_.isNull(e)||_.isUndefined(e)||b(function(){if(d&&e.reloadItems(),e.items.length>0){a.publish("shell.navLoading",!0);var b=_.filter(e.items,function(a){return!angular.element(a.element).is('.fis-navitems[data-parent-path="'+c+'"]')}),f=_.filter(e.items,function(a){return angular.element(a.element).is('.fis-navitems[data-parent-path="'+c+'"]')});e.hide(b),e.reveal(f),e.reloadItems(),e.layout()}},0,!1)}}function o(a){var b=[];return _.each(a,function(a){if(_.isUndefined(a.id)||_.isUndefined(a.matched)||b.push(a),a.children){var c=o(a.children);b=_.union(b,c)}}),b}function p(a,b){return!(!_.isUndefined(a.partial)&&a.partial!==b.partial)&&(!(!_.isUndefined(a.controller)&&a.controller!==b.controller)&&(!(!_.isUndefined(a.action)&&a.action!==b.action)&&(!(!_.isUndefined(a.actionController)&&a.actionController!==b.actionController)&&(!(!_.isUndefined(a.args)&&!_.isEqual(a.args,b.args))&&!(!_.isUndefined(a.module)&&a.module!==b.module)))))}function q(){var a=d.getMinSearchCharacters();if(w.length>=a&&0!==w.length){var c=d.strictExtendedSearch(w,u.navMap),e=_.last(u.menuItems.children);e.children=h.$parent.getViewsAsMenuItems(c,_.last(u.menuItems.children).view),angular.forEach(e.children,function(a){h.$parent.isItemInViewToShow(a)}),h.filteredNavs=c,h.$broadcast("fisViewsFiltered",c)}else h.$parent.resetSearch();h.updateFlattenViews(u.menuItems.children),b(function(){n(_.last(u.menuItems.children).view.id,!0),b(function(){F()},0,!1)},0,!1)}function r(a){u.selectedMenuItem=_.last(u.menuItems.children);var c=d.getSearchTimeout();u.searchable&&u.enabled&&(h.viewModel.searchTimeout&&(b.cancel(h.viewModel.searchTimeout),h.viewModel.searchTimeout=null),a?q():(h.$parent.resetSearch(),h.updateFlattenViews(u.menuItems.children),h.filteredNavs=[],h.viewModel.searchTimeout=b(function(){q()},c)))}function s(a){if(!_.isEmpty(h.filteredNavs)){var b=B(h.filteredNavs);_.isUndefined(b)&&(b=C(h.filteredNavs)),_.isUndefined(b)||(h.fisNavigationLinkClicked(),h.open(b.path,a))}}function t(a){for(var b=!1,c=0;c<a.length;c++)if((a[c].view.secondaryNav||a[c].view.partial||a[c].view.action||t(a[c].children))&&"hide"!==a[c].view.cls){b=!0;break}return b}var u=h.$parent.startMenuModel,v=null,w="",x=function(){if(!v||v.length>0&&!$.contains(document.body,v[0])){var a=i.find(".fis-search input");a.length>0&&(v=a)}return v};h.$watch("$parent.startMenuModel.closed",function(a){a===!1&&(m(),F())}),angular.element(window).resize(function(){u.closed||f.isResponsive()||(F(),n())});var y=function(a){if(!h.$parent.startMenuModel.closed&&h.$parent.startMenuModel.closeOnMouseExit===!0){h.viewModel.closingTimeout&&(b.cancel(h.viewModel.closingTimeout),h.viewModel.closingTimeout=null);var c=a.type;u.closeOnMouseExit&&(h.viewModel.closingTimeout=b(function(){h.$parent.startMenuModel.closed="mouseenter"!==c},350))}a.stopPropagation(),h.$apply()},z=function(a){var b=u.menuItems.children,c=b.indexOf(a);return c>0?b[c-1]:a},A=function(a){var b=u.menuItems.children,c=b.indexOf(a);return c+1<b.length?b[c+1]:a},B=function(a){var b=void 0;return _.each(a,function(a){_.isUndefined(b)&&(b=D(a))}),b},C=function(a){if(!_.isUndefined(h.filteredNavs[0])){var b=o(h.filteredNavs),c=_.find(b,function(a,c){var d=_.find(_.rest(b,c),function(b){return!p(a,b)});return!_.isUndefined(d)});return _.isUndefined(c)?b[0]:void 0}},D=function(a){var b=void 0;if(_.isUndefined(a.children)){if(!_.isUndefined(a.matched)&&100===a.matched&&!E(a))return a}else _.isArray(a.children)&&_.each(a.children,function(a){_.isUndefined(b)&&(b=D(a))});return b},E=function(a){var b=!1;return a.label.indexOf(":")!==-1&&(b=!0),b!==!0&&_.each(a.tags,function(a){a.indexOf(":")!==-1&&(b=!0)}),b},F=function(){var a,b,c=angular.element(".app > header"),d=angular.element(".app > nav"),e=angular.element(".app > footer"),g=i,h=g.find(".fis-sitemap"),j=g.find(".fis-start-menu-left"),k=(j.find(".fis-start-menu-list"),h.parents().get()),l=300,m=!1;j.css("max-height","none"),h.css("max-height","none"),h.css("min-height","none"),a=b=h.outerHeight(!0)-h.height(),_.find(k,function(c){var d=$(c);return m||(a+=d.outerHeight(!0)-d.height(),m=d.hasClass("fis-mega-menu")),b+=d.outerHeight(!0)-d.height(),void 0!==d.attr("fis-mega-menu")});var n=f.getHeight(),o=c.outerHeight(!0)+d.outerHeight(!0),p=e.outerHeight(!0),q=20,r=n-o-b-p-q,s=j.outerHeight(!0)-a;s=s>l?s:l,r<s?(s=r,j.css("max-height",s+a)):j.css("max-height","none"),h.css("max-height",r),h.css("min-height",s)};i.bind("mouseenter mouseleave",y),l(),a.subscribe("fisMenuReset",function(){m(),b(function(){F()},0,!1)}),h.$watch("$parent.startMenuModel.closed",function(a){a||b(function(){var a=x();a&&a.select()},0,!1)}),i.click(function(a){var b=x();b&&b.select()}),h.$watch("$parent.startMenuModel.selectedMenuItem",function(a){null!==a&&(n(a.view.id,!0),b(function(){F()},0,!1))}),h.searchKeyUp=function(a){switch(w=$(a.currentTarget).val().trim(),a.keyCode){case 37:return!1;case 38:var b=z(u.selectedMenuItem);u.selectedMenuItem!==b&&(u.selectedMenuItem=b);break;case 39:return!1;case 40:var c=A(u.selectedMenuItem);u.selectedMenuItem!==c&&(u.selectedMenuItem=c);break;case 27:u.closed=!0;break;case 13:_.isEmpty(h.filteredNavs)&&r(!0),s(a);break;default:17!==a.keyCode&&18!==a.keyCode&&9!==a.keyCode&&r(!1)}},h.tooShortTerm=function(){var a=d.getMinSearchCharacters();return u.selectedMenuItem==_.last(u.menuItems.children)&&w.length<a},h.getSearchLabel=function(a){var b=d.getMinSearchCharacters();return a||0!==b?c("interpolate")(e.translate("fisMegaMenu.requiredSearchCharacters","Please enter at least {0} characters to start searching"),Math.max(1,b)):e.translate("fisMegaMenu.search","Search...")},h.isItemInViewToShow=function(a){if("SearchItem"===a.view.id)return!0;if(a.children&&a.children.length>0&&!t(a.children))return!1;if(a.parent&&"hide"===a.parent.cls)return!1;if(a.children&&a.children.length>0){var b=_.filter(a.children,function(a){if("hide"===a.view.cls)return a});if(a.children.length===b.length)return!1}return!0}}}}]),angular.module("fis.megamenu").directive("fisWatchSuspend",["$timeout","fisPubSubService",function(a,b){"use strict";return{restrict:"A",priority:-1,link:function(c,d,e){function f(a){var b=a.$id;_.isUndefined(a.$$suspendedWatches)&&(a.$$suspendedWatches={}),_.isUndefined(a.$$suspendedWatches[b])&&(_.isNull(a.$$watchers)||(a.$$suspendedWatches[b]=a.$$watchers,a.$$watchers=null))}function g(a){var b=a.$id;_.isUndefined(a.$$suspendedWatches[b])||_.isNull(a.$$watchers)&&(a.$$watchers=a.$$suspendedWatches[b],a.$$suspendedWatches[b]=void 0)}function h(a){for(var b,c=a,d=[c.$$childHead];d.length;)for(b=d.shift();b;)f(b),d.push(b.$$childHead),b=b.$$nextSibling}function i(a){for(var b,c=a,d=[c.$$childHead];d.length;)for(b=d.shift();b;)g(b),d.push(b.$$childHead),b=b.$$nextSibling}b.subscribe("shell.suspendWatch",function(b){a(function(){_.isUndefined(b)||(_.isUndefined(b.$$suspendedWatches)&&(b.$$suspendedWatches={}),h(b))})}),b.subscribe("shell.resumeWatch",function(a){_.isUndefined(a)||_.isUndefined(a.$$suspendedWatches)||i(a)})}}}]),angular.module("fis.megamenu").provider("fisMegaMenuSearchService",function(){function a(a){return!_.isUndefined(a.children)&&a.children.length>0&&!a.action}function b(a){return!_.isUndefined(a.quickLinks)&&a.quickLinks.length>0}function c(a){var b=_.clone(a);return b.children=void 0,b.quickLinks=void 0,b}function d(a){return!_.isUndefined(a.id)&&a.id.indexOf(":")===-1}function e(a,b,c){return!_.isUndefined(b.label)&&b.label.toLowerCase().indexOf(a)>=0&&(!c||d(b))}function f(a,b,c){return _.some(b.tags,function(e){return c?e.toLowerCase().indexOf(a)>=0&&d(b):e.toLowerCase().indexOf(a)>=0})}function g(a,b){return b.matched=50,b.label.toLowerCase()===a&&(b.matched=100),_.some(b.tags,function(c){c.toLowerCase()===a&&(b.matched=100)}),b}var h=this;h.searchSetting={searchTimeout:250,minSearchCharacters:0},h.$get=["fisConfigService",function(d){function i(b,d,h,j){var k={};if((e(b,d,h)||f(b,d,h))&&(k=_.clone(d),k=g(b,k),k.children=void 0),a(d)){var l=[];if(_.each(d.children,function(a){var c=i(b,a,h,j);_.isUndefined(c)||l.push(c)}),l&&l.length>0)_.isEmpty(k)&&(k=c(d)),k.children=l;else if(j){var m=!_.isUndefined(d.partial),n=!_.isUndefined(d.action),o=!_.isUndefined(d.secondaryNav);if(!m&&!n&&!o)return}}return _.isEmpty(k)?void 0:k}var j={};return j.searchSettings=h.searchSetting,d.then(function(a){a.menuApi&&a.menuApi.searchTimeout&&(j.searchSettings.searchTimeout=a.menuApi.searchTimeout),a.menuApi&&a.menuApi.minSearchCharacters&&(j.searchSettings.minSearchCharacters=a.menuApi.minSearchCharacters)}),j.search=function(a,c,d,e){var f=!1;_.isUndefined(d)||(f=d);var g=!1;_.isUndefined(e)||(g=e),a=a.toLowerCase();var h=[];return _.each(c,function(c){var d=!0;if(_.isUndefined(c.closeable)||c.closeable!==!1||(d=!1),d){var e=i(a,c,f,g);b(c)&&_.each(c.quickLinks,function(b){var c=i(a,b,f,g);_.isUndefined(c)||(_.isUndefined(e)&&(e={}),_.isUndefined(e.quickLinks)&&(e.quickLinks=[]),e.quickLinks.push(c))}),_.isUndefined(e)||h.push(e)}}),h},j.strictExtendedSearch=function(a,b,c){return j.extendedSearch(a,b,c,!0)},j.extendedSearch=function(a,b,c,d){var e,f=[];for(var g in b)e=j.search(a,b[g],c,d),!_.isUndefined(e)&&e.length>0&&(f=f.concat(e));return f},j.strictSearch=function(a,b,c){return j.search(a,b,c,!0)},j.setSearchTimeout=function(a){a>=0&&(j.searchSettings.searchTimeout=a)},j.setMinSearchCharacters=function(a){a>=0&&(j.searchSettings.minSearchCharacters=a)},j.getSearchTimeout=function(){return j.searchSettings.searchTimeout},j.getMinSearchCharacters=function(){return j.searchSettings.minSearchCharacters},j}]}),angular.module("fis.megamenu").run(["$templateCache",function(a){}]);