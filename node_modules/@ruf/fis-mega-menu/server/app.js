'use strict';

var path = require('path');
var express = require('express');
var app = express();
var env = process.env.NODE_ENV || 'development';
var morgan = require('morgan');

app.use(morgan('[:date[iso]] :method :url :status :res[content-length] :res[location]'));

app.use(express.static(path.resolve('.tmp')));
if (env === 'development') {
  app.use(require('connect-livereload')());
  app.use(express.static(path.resolve('.')));
  var docMiddleware = require('../' + 'doc');
  app.use(docMiddleware);
} else {
  app.use(express.static(path.resolve('demo-dist')));
}

//setup routes
require('./routes')(app);

var server = app.listen(process.env.PORT, 'localhost', function () {

  var host = server.address().address;
  var port = server.address().port;

  console.log('Example app listening at http://%s:%s in %s mode', host, port, env);

});
