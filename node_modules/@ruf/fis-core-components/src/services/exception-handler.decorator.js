export default function ($delegate) {
  'ngInject';

  var doc = '\nSee https://www.csa.sungard.com/wiki/x/9xVMB';
  var interceptors = {};
  var ANY = '_any';

  var handler = function exceptionHandler(exception, cause) {
    var prop;
    for (prop in interceptors) {
      if (prop === ANY || exception.hasOwnProperty(prop)) {
        interceptors[prop](exception, cause);
      }
    }

    $delegate(exception, cause);
  };

  handler.intercept = function intercept(property, cb) {
    if (!property) {
      delete interceptors[ANY];
      return;
    }

    if (angular.isFunction(property)) {
      cb = property;
      property = ANY;
    }

    if (angular.isString(property)) {
      if (angular.isFunction(cb)) {
        interceptors[property] = cb;
      } else {
        delete interceptors[property];
      }
    }
  };

  handler.intercept('userMessage', function (exception) {
    exception.message += doc;
  });

  return handler;
}
