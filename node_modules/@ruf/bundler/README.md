# ruf-bundler

> Transform a couple of files into a web app

The `ruf-bundler` takes in some source files (html, ts, scss, ...) and mounts them into one of its predefined project templates and builds the project. The result is put into a destination of your choosing and is a web app that can be served.

## Install

```
npm install @ruf/bundler
```

Or globally if you wish to run the CLI from anywhere:

```
npm install -g @ruf/bundler
```

## API

### Bundler

```
const Bundler = require('@ruf/bundler');

const options = {
  cachePath: '/path/for/internal/cache' // defaults to $HOME/.ruf-bundler-cache
}

const example = {
  template: 'ruf-demo-workspace',
  title: 'RUF Splitter',
  description: 'This is a quick example',
  tags: ['RUF', 'quick'],
  dependencies: { '@ruf/splitter': 'latest' },
  selector: 'example-component',
  files: {
    'example.module.ts': 'file contents' // the ruf-demo-workspace template requires this file and for it to export an ExampleModule.
  }
};

const bundler = new Bundler(options);

async function createApp() {
  const template = await bundlerInstance.getTemplate(example.template);
  // templates contains an array of available project template names

  const pathToApp = await template.build(example, {
    progress: ([step, total, msg, hash, done]) =>
      console.log(`${step}/${total} ==> ${msg}`),
    destination: '/path/to/output', // will create in a temporary folder if omitted.
    useHashDir: true, // will create a hash of the example and use destination/hash for output.
    returnIfExists: true // if a hash folder is found, don't rebuild and just return it.
  });
}

try {
  createApp();
} catch(err) {
  console.log(err);
}

```

### Finder

```
import { findExamples, Example } from '@ruf/bundler';

async extractExamples(path: string) {
  const results: Example[] = [];

  await findExamples({ cwd: path }, (ex, info) => {
    console.log('Found in', info.dir);
    results.push(ex);
  });

  return results
}

async main() {
  try {
    const examples = await extractExamples('./my-project');
    // do something with examples
  } catch (err) {
    console.log(err);
    console.log(err.details);
  }
}

main();
```

## Templates

### ruf-demo-workspace

This template is based on the output of the `ruf workspace` command. It will mount the provided files into an example folder and is expecting a `example.module.ts` file to be present that exports an `ExampleModule`.

```ts
import { NgModule, Component } from '@angular/core';
import { MyComponent } from './my-component';

// you can import from any library as long as you define the dependency when calling build.
import { KillerModule } from '@ruf/killer';

@NgModule({
  declarations: [MyComponent],
  imports: [KillerModule],
  exports: [MyComponent],
  entryComponents: [],
  providers: []
})
export class ExampleModule {}
```

It also supports theming and typography mixins. To use it, provide a `_example.theme.scss` file that declares a `example-theme` and `example-typography` mixin.

Example for styling a `example-component` element: 

```scss
@import 'node_modules/@ruf/theming/styles/theming/theming';

// a convenience mixin that aggregates all of your component theme mixins
@mixin example-theme($theme) {
  $background: map-get($theme, background);
  $foreground: map-get($theme, foreground);
  $primary: map-get($theme, primary);
  $accent: map-get($theme, accent);
  $emphasis: map-get($theme, emphasis);
  $warn: map-get($theme, warn);

  example-component {
    p {
      color: ruf-color($primary);
    }
  }
}

@mixin example-typography($config) {
  example-component {
    p {
      @include ruf-typography-level-to-styles($config, 'title');
    }
  }
}
```
## CLI

### ruf-bundler
```
  Create a runnable app from provided example files.

  Usage
    $ ruf-bundler [examplePath]

  Options
     --no-progress, -n  Do not show progress
     --open, -o         Start a server and open browser
     --serve, -s        Start a server
     --moduleCache, -mc Path to the node_modules cache
     --cache, -c        Use caching of projects
     --destination, -d  Project build destination
     --version          Prints out the version of this tool
     --help             Usage

  Examples
    $ ruf-bundler example/splitter
      # runs in the example/splitter folder if it contains an example.json file.
    $ ruf-bundler -c --open
      # runs in current folder, serves the resulting app (from cache if already built) 
      # and opens the browser to see it
```

### ruf-example-finder

```
	Usage
	  $ ruf-examples-finder [path]

	Options
    --build, -b     Build all found examples
    --output, -o    Output folder for built apps (default: ./output)
    --defaults, -d  Path to a JSON file containing default TemplateBuildSettings
    --assets        Path to assets files

  Examples
    $ ruf-examples-finder ./my-project
      # runs in the ./my-project folder and finds all examples it contains and prints them.
```
## Development

`npm run watch` to keep things building.
